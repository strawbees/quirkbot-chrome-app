var requirejs,require,define;(function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v=t&&t.split("/"),m=u.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e=v.concat(e);for(h=0;h<e.length;h+=1){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===1&&(e[2]===".."||e[0]===".."))break;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(v)for(p=v.length;p>0;p-=1){i=m[v.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&g&&g[r]&&(f=g[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){var i=l.call(arguments,0);return typeof i[0]!="string"&&i.length===1&&i.push(null),n.apply(e,i.concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("almond",function(){}),define("happy/app/BaseApp",[],function(){var e=function(){var e=this,t=function(){};e.container=document.body,e.setup=t,e.update=t,e.draw=t,e.onKeyUp=t,e.onKeyDown=t,e.onMouseOver=t,e.onMouseOut=t,e.onMouseDown=t,e.onMouseUp=t,e.onMouseMove=t,e.onClick=t,e.onDoubleClick=t,e.onResize=t,e.onReposition=t};return e}),function(){!function(e){e.Parse=e.Parse||{},e.Parse.VERSION="js1.3.0"}(this),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){return e instanceof x?e:this instanceof x?void (this._wrapped=e):new x(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.4";var T=x.each=x.forEach=function(e,t,r){if(null!=e)if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;s>i;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return null==e?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);if(T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)}),!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}if(T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)}),!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){return t.call(n,e,i,s)?(r=e,!0):void 0}),r},x.filter=x.select=function(e,t,n){var r=[];return null==e?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return null==e?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){return(i=i&&t.call(r,e,s,o))?void 0:n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return null==e?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){return i||(i=t.call(r,e,s,o))?n:void 0}),!!i)};x.contains=x.include=function(e,t){return null==e?!1:y&&e.indexOf===y?-1!=e.indexOf(t):C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?null:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-1/0;var r={computed:-1/0,value:-1/0};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return 1/0;var r={computed:1/0,value:1/0};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(r>n||void 0===r)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t||x.identity);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=null==n?x.identity:k(n);for(var i=n.call(r,t),s=0,o=e.length;o>s;){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return null==e?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:u.call(e,0,t)},x.initial=function(e,t,n){return u.call(e,0,e.length-(null==t||n?1:t))},x.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0))},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,null==t||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){(t?r&&o[o.length-1]===n:x.contains(o,n))||(o.push(n),s.push(e[r]))}),s},x.union=function(){return x.uniq(a.apply(r,arguments))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){for(var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=new Array(t),r=0;t>r;r++)n[r]=x.pluck(e,""+r);return n},x.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;i>r;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var i=r?n:e.length;i--;)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);r>i;)s[i++]=e,e+=n;return s},x.bind=function(e,t){if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));var n=u.call(arguments,2);return function(){return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);return 0===t.length&&(t=x.functions(e)),T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,0>=f?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},x.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return 0>=e?t():function(){return--e<1?t.apply(this,arguments):void 0}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&(t[t.length]=n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)null==e[n]&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var O=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=n.length;s--;)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if("[object Array]"==i){if(o=e.length,u=o==t.length)for(;o--&&(u=O(e[o],t[o],n,r)););}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e)if(x.has(e,c)&&(o++,!(u=x.has(t,c)&&O(e[c],t[c],n,r))))break;if(u){for(c in t)if(x.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};x.isEqual=function(e,t){return O(e,t,[],[])},x.isEmpty=function(e){if(null==e)return!0;if(x.isArray(e)||x.isString(e))return 0===e.length;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&1===e.nodeType},x.isArray=w||function(e){return"[object Array]"==f.call(e)},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),"function"!=typeof /./&&(x.isFunction=function(e){return"function"==typeof e}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==f.call(e)},x.isNull=function(e){return null===e},x.isUndefined=function(e){return void 0===e},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){for(var r=Array(e),i=0;e>i;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=x.invert(M.escape);var _={escape:new RegExp("["+x.keys(M.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(M.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return null==t?"":(""+t).replace(_[e],function(t){return M[e][t]})}}),x.result=function(e,t){if(null==e)return null;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),j.call(this,n.apply(x,e))}})};var D=0;x.uniqueId=function(e){var t=++D+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||P).source,(n.interpolate||P).source,(n.evaluate||P).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(B,function(e){return"\\"+H[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var j=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],j.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return j.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),function(e){e.Parse=e.Parse||{};var t=e.Parse;"undefined"!=typeof exports&&exports._?(t._=exports._.noConflict(),t.localStorage=require("localStorage"),t.XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest,exports.Parse=t):(t._=_.noConflict(),"undefined"!=typeof localStorage&&(t.localStorage=localStorage),"undefined"!=typeof XMLHttpRequest&&(t.XMLHttpRequest=XMLHttpRequest)),"undefined"!=typeof $&&(t.$=$);var n=function(){},r=function(e,r,i){var s;return s=r&&r.hasOwnProperty("constructor")?r.constructor:function(){e.apply(this,arguments)},t._.extend(s,e),n.prototype=e.prototype,s.prototype=new n,r&&t._.extend(s.prototype,r),i&&t._.extend(s,i),s.prototype.constructor=s,s.__super__=e.prototype,s};t.serverURL="https://api.parse.com","undefined"!=typeof process&&process.versions&&process.versions.node&&(t._isNode=!0),t.initialize=function(e,n,r){if(r)throw"Parse.initialize() was passed a Master Key, which is only allowed from within Node.js.";t._initialize(e,n)},t._initialize=function(e,n,r){t.applicationId=e,t.javaScriptKey=n,t.masterKey=r,t._useMasterKey=!1},t._isNode&&(t.initialize=t._initialize,t.Cloud=t.Cloud||{},t.Cloud.useMasterKey=function(){t._useMasterKey=!0}),t._getParsePath=function(e){if(!t.applicationId)throw"You need to call Parse.initialize before using Parse.";if(e||(e=""),!t._.isString(e))throw"Tried to get a localStorage path that wasn't a String.";return"/"===e[0]&&(e=e.substring(1)),"Parse/"+t.applicationId+"/"+e},t._installationId=null,t._getInstallationId=function(){if(t._installationId)return t._installationId;var e=t._getParsePath("installationId");if(t._installationId=t.localStorage.getItem(e),!t._installationId||""===t._installationId){var n=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};t._installationId=n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n(),t.localStorage.setItem(e,t._installationId)}return t._installationId},t._parseDate=function(e){var t=new RegExp("^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$"),n=t.exec(e);if(!n)return null;var r=n[1]||0,i=(n[2]||1)-1,s=n[3]||0,o=n[4]||0,u=n[5]||0,a=n[6]||0,f=n[8]||0;return new Date(Date.UTC(r,i,s,o,u,a,f))},t._ajaxIE8=function(e,n,r){var i=new t.Promise,s=new XDomainRequest;return s.onload=function(){var e;try{e=JSON.parse(s.responseText)}catch(t){i.reject(t)}e&&i.resolve(e)},s.onerror=s.ontimeout=function(){var e={responseText:JSON.stringify({code:t.Error.X_DOMAIN_REQUEST,error:"IE's XDomainRequest does not supply error info."})};i.reject(e)},s.onprogress=function(){},s.open(e,n),s.send(r),i},t._useXDomainRequest=function(){return"undefined"!=typeof XDomainRequest?"withCredentials"in new XMLHttpRequest?!1:!0:!1},t._ajax=function(e,n,r,i,s){var o={success:i,error:s};if(t._useXDomainRequest())return t._ajaxIE8(e,n,r)._thenRunCallbacks(o);var u=new t.Promise,a=!1,f=new t.XMLHttpRequest;return f.onreadystatechange=function(){if(4===f.readyState){if(a)return;if(a=!0,f.status>=200&&f.status<300){var e;try{e=JSON.parse(f.responseText)}catch(t){u.reject(t)}e&&u.resolve(e,f.status,f)}else u.reject(f)}},f.open(e,n,!0),f.setRequestHeader("Content-Type","text/plain"),t._isNode&&f.setRequestHeader("User-Agent","Parse/"+t.VERSION+" (NodeJS "+process.versions.node+")"),f.send(r),u._thenRunCallbacks(o)},t._extend=function(e,t){var n=r(this,e,t);return n.extend=this.extend,n},t._request=function(e){var n=e.route,r=e.className,i=e.objectId,s=e.method,o=e.useMasterKey,u=e.sessionToken,a=e.data;if(!t.applicationId)throw"You must specify your applicationId using Parse.initialize.";if(!t.javaScriptKey&&!t.masterKey)throw"You must specify a key using Parse.initialize.";if(!u){var f=t.User.current();f&&f._sessionToken&&(u=f._sessionToken)}if("batch"!==n&&"classes"!==n&&"events"!==n&&"files"!==n&&"functions"!==n&&"login"!==n&&"push"!==n&&"requestPasswordReset"!==n&&"rest_verify_analytics"!==n&&"users"!==n&&"jobs"!==n&&"config"!==n)throw"Bad route: '"+n+"'.";var l=t.serverURL;"/"!==l.charAt(l.length-1)&&(l+="/"),l+="1/"+n,r&&(l+="/"+r),i&&(l+="/"+i),a=t._.clone(a||{}),"POST"!==s&&(a._method=s,s="POST"),t._.isUndefined(o)&&(o=t._useMasterKey),a._ApplicationId=t.applicationId,o?a._MasterKey=t.masterKey:a._JavaScriptKey=t.javaScriptKey,a._ClientVersion=t.VERSION,a._InstallationId=t._getInstallationId(),u&&(a._SessionToken=u);var c=JSON.stringify(a);return t._ajax(s,l,c).then(null,function(e){var n;if(e&&e.responseText)try{var r=JSON.parse(e.responseText);n=new t.Error(r.code,r.error)}catch(i){n=new t.Error(t.Error.INVALID_JSON,"Received an error with invalid JSON from Parse: "+e.responseText)}else n=new t.Error(t.Error.CONNECTION_FAILED,"XMLHttpRequest failed: "+JSON.stringify(e));return t.Promise.error(n)})},t._getValue=function(e,n){return e&&e[n]?t._.isFunction(e[n])?e[n]():e[n]:null},t._encode=function(e,n,r){var i=t._;if(e instanceof t.Object){if(r)throw"Parse.Objects not allowed here";if(!n||i.include(n,e)||!e._hasData)return e._toPointer();if(!e.dirty())return n=n.concat(e),t._encode(e._toFullJSON(n),n,r);throw"Tried to save an object with a pointer to a new, unsaved object."}if(e instanceof t.ACL)return e.toJSON();if(i.isDate(e))return{__type:"Date",iso:e.toJSON()};if(e instanceof t.GeoPoint)return e.toJSON();if(i.isArray(e))return i.map(e,function(e){return t._encode(e,n,r)});if(i.isRegExp(e))return e.source;if(e instanceof t.Relation)return e.toJSON();if(e instanceof t.Op)return e.toJSON();if(e instanceof t.File){if(!e.url())throw"Tried to save an object containing an unsaved file.";return{__type:"File",name:e.name(),url:e.url()}}if(i.isObject(e)){var s={};return t._objectEach(e,function(e,i){s[i]=t._encode(e,n,r)}),s}return e},t._decode=function(e,n){var r=t._;if(!r.isObject(n))return n;if(r.isArray(n))return t._arrayEach(n,function(e,r){n[r]=t._decode(r,e)}),n;if(n instanceof t.Object)return n;if(n instanceof t.File)return n;if(n instanceof t.Op)return n;if(n.__op)return t.Op._decode(n);if("Pointer"===n.__type&&n.className){var i=t.Object._create(n.className);return i._finishFetch({objectId:n.objectId},!1),i}if("Object"===n.__type&&n.className){var s=n.className;delete n.__type,delete n.className;var o=t.Object._create(s);return o._finishFetch(n,!0),o}if("Date"===n.__type)return t._parseDate(n.iso);if("GeoPoint"===n.__type)return new t.GeoPoint({latitude:n.latitude,longitude:n.longitude});if("ACL"===e)return n instanceof t.ACL?n:new t.ACL(n);if("Relation"===n.__type){var u=new t.Relation(null,e);return u.targetClassName=n.className,u}if("File"===n.__type){var a=new t.File(n.name);return a._url=n.url,a}return t._objectEach(n,function(e,r){n[r]=t._decode(r,e)}),n},t._arrayEach=t._.each,t._traverse=function(e,n,r){if(e instanceof t.Object){if(r=r||[],t._.indexOf(r,e)>=0)return;return r.push(e),t._traverse(e.attributes,n,r),n(e)}return e instanceof t.Relation||e instanceof t.File?n(e):t._.isArray(e)?(t._.each(e,function(i,s){var o=t._traverse(i,n,r);o&&(e[s]=o)}),n(e)):t._.isObject(e)?(t._each(e,function(i,s){var o=t._traverse(i,n,r);o&&(e[s]=o)}),n(e)):n(e)},t._objectEach=t._each=function(e,n){var r=t._;r.isObject(e)?r.each(r.keys(e),function(t){n(e[t],t)}):r.each(e,n)},t._isNullOrUndefined=function(e){return t._.isNull(e)||t._.isUndefined(e)}}(this),function(e){e.Parse=e.Parse||{};var t=e.Parse,n=t._;t.Analytics=t.Analytics||{},n.extend(t.Analytics,{track:function(e,r){if(e=e||"",e=e.replace(/^\s*/,""),e=e.replace(/\s*$/,""),0===e.length)throw"A name for the custom event must be provided";return n.each(r,function(e,t){if(!n.isString(t)||!n.isString(e))throw'track() dimensions expects keys and values of type "string".'}),t._request({route:"events",className:e,method:"POST",data:{dimensions:r}})}})}(this),function(e){e.Parse=e.Parse||{};var t=e.Parse,n=t._;t.Config=function(){this.attributes={},this._escapedAttributes={}},t.Config.current=function(){if(t.Config._currentConfig)return t.Config._currentConfig;var e=t.localStorage.getItem(t._getParsePath(t.Config._CURRENT_CONFIG_KEY)),n=new t.Config;return e&&(n._finishFetch(JSON.parse(e)),t.Config._currentConfig=n),n},t.Config.get=function(e){e=e||{};var n=t._request({route:"config",method:"GET"});return n.then(function(e){if(!e||!e.params){var n=new t.Error(t.Error.INVALID_JSON,"Config JSON response invalid.");return t.Promise.error(n)}var r=new t.Config;return r._finishFetch(e),t.Config._currentConfig=r,r})._thenRunCallbacks(e)},t.Config.prototype={escape:function(e){var r=this._escapedAttributes[e];if(r)return r;var i,s=this.attributes[e];return i=t._isNullOrUndefined(s)?"":n.escape(s.toString()),this._escapedAttributes[e]=i,i},get:function(e){return this.attributes[e]},_finishFetch:function(e){this.attributes=t._decode(null,n.clone(e.params)),t.localStorage.setItem(t._getParsePath(t.Config._CURRENT_CONFIG_KEY),JSON.stringify(e))}},t.Config._currentConfig=null,t.Config._CURRENT_CONFIG_KEY="currentConfig"}(this),function(e){e.Parse=e.Parse||{};var t=e.Parse,n=t._;t.Error=function(e,t){this.code=e,this.message=t},n.extend(t.Error,{OTHER_CAUSE:-1,INTERNAL_SERVER_ERROR:1,CONNECTION_FAILED:100,OBJECT_NOT_FOUND:101,INVALID_QUERY:102,INVALID_CLASS_NAME:103,MISSING_OBJECT_ID:104,INVALID_KEY_NAME:105,INVALID_POINTER:106,INVALID_JSON:107,COMMAND_UNAVAILABLE:108,NOT_INITIALIZED:109,INCORRECT_TYPE:111,INVALID_CHANNEL_NAME:112,PUSH_MISCONFIGURED:115,OBJECT_TOO_LARGE:116,OPERATION_FORBIDDEN:119,CACHE_MISS:120,INVALID_NESTED_KEY:121,INVALID_FILE_NAME:122,INVALID_ACL:123,TIMEOUT:124,INVALID_EMAIL_ADDRESS:125,MISSING_CONTENT_TYPE:126,MISSING_CONTENT_LENGTH:127,INVALID_CONTENT_LENGTH:128,FILE_TOO_LARGE:129,FILE_SAVE_ERROR:130,FILE_DELETE_ERROR:153,DUPLICATE_VALUE:137,INVALID_ROLE_NAME:139,EXCEEDED_QUOTA:140,SCRIPT_FAILED:141,VALIDATION_ERROR:142,INVALID_IMAGE_DATA:150,UNSAVED_FILE_ERROR:151,INVALID_PUSH_TIME_ERROR:152,USERNAME_MISSING:200,PASSWORD_MISSING:201,USERNAME_TAKEN:202,EMAIL_TAKEN:203,EMAIL_MISSING:204,EMAIL_NOT_FOUND:205,SESSION_MISSING:206,MUST_CREATE_USER_THROUGH_SIGNUP:207,ACCOUNT_ALREADY_LINKED:208,LINKED_ID_MISSING:250,INVALID_LINKED_SESSION:251,UNSUPPORTED_SERVICE:252,AGGREGATE_ERROR:600,FILE_READ_ERROR:601,X_DOMAIN_REQUEST:602})}(this),function(){var e=this,t=e.Parse||(e.Parse={}),n=/\s+/,r=Array.prototype.slice;t.Events={on:function(e,t,r){var i,s,o,u,a;if(!t)return this;for(e=e.split(n),i=this._callbacks||(this._callbacks={}),s=e.shift();s;)a=i[s],o=a?a.tail:{},o.next=u={},o.context=r,o.callback=t,i[s]={tail:u,next:a?a.next:o},s=e.shift();return this},off:function(e,t,r){var i,s,o,u,a,f;if(s=this._callbacks){if(!(e||t||r))return delete this._callbacks,this;for(e=e?e.split(n):_.keys(s),i=e.shift();i;)if(o=s[i],delete s[i],o&&(t||r)){for(u=o.tail,o=o.next;o!==u;)a=o.callback,f=o.context,(t&&a!==t||r&&f!==r)&&this.on(i,a,f),o=o.next;i=e.shift()}return this}},trigger:function(e){var t,i,s,o,u,a,f;if(!(s=this._callbacks))return this;for(a=s.all,e=e.split(n),f=r.call(arguments,1),t=e.shift();t;){if(i=s[t])for(o=i.tail;(i=i.next)!==o;)i.callback.apply(i.context||this,f);if(i=a)for(o=i.tail,u=[t].concat(f);(i=i.next)!==o;)i.callback.apply(i.context||this,u);t=e.shift()}return this}},t.Events.bind=t.Events.on,t.Events.unbind=t.Events.off}.call(this),function(e){e.Parse=e.Parse||{};var t=e.Parse,n=t._;t.GeoPoint=function(e,r){n.isArray(e)?(t.GeoPoint._validate(e[0],e[1]),this.latitude=e[0],this.longitude=e[1]):n.isObject(e)?(t.GeoPoint._validate(e.latitude,e.longitude),this.latitude=e.latitude,this.longitude=e.longitude):n.isNumber(e)&&n.isNumber(r)?(t.GeoPoint._validate(e,r),this.latitude=e,this.longitude=r):(this.latitude=0,this.longitude=0);var i=this;this.__defineGetter__&&this.__defineSetter__&&(this._latitude=this.latitude,this._longitude=this.longitude,this.__defineGetter__("latitude",function(){return i._latitude}),this.__defineGetter__("longitude",function(){return i._longitude}),this.__defineSetter__("latitude",function(e){t.GeoPoint._validate(e,i.longitude),i._latitude=e}),this.__defineSetter__("longitude",function(e){t.GeoPoint._validate(i.latitude,e),i._longitude=e}))},t.GeoPoint._validate=function(e,t){if(-90>e)throw"Parse.GeoPoint latitude "+e+" < -90.0.";if(e>90)throw"Parse.GeoPoint latitude "+e+" > 90.0.";if(-180>t)throw"Parse.GeoPoint longitude "+t+" < -180.0.";if(t>180)throw"Parse.GeoPoint longitude "+t+" > 180.0."},t.GeoPoint.current=function(e){var n=new t.Promise;return navigator.geolocation.getCurrentPosition(function(e){n.resolve(new t.GeoPoint({latitude:e.coords.latitude,longitude:e.coords.longitude}))},function(e){n.reject(e)}),n._thenRunCallbacks(e)},t.GeoPoint.prototype={toJSON:function(){return t.GeoPoint._validate(this.latitude,this.longitude),{__type:"GeoPoint",latitude:this.latitude,longitude:this.longitude}},radiansTo:function(e){var t=Math.PI/180,n=this.latitude*t,r=this.longitude*t,i=e.latitude*t,s=e.longitude*t,o=n-i,u=r-s,a=Math.sin(o/2),f=Math.sin(u/2),l=a*a+Math.cos(n)*Math.cos(i)*f*f;return l=Math.min(1,l),2*Math.asin(Math.sqrt(l))},kilometersTo:function(e){return 6371*this.radiansTo(e)},milesTo:function(e){return 3958.8*this.radiansTo(e)}}}(this),function(e){e.Parse=e.Parse||{};var t=e.Parse,n=t._,r="*";t.ACL=function(e){var r=this;if(r.permissionsById={},n.isObject(e))if(e instanceof t.User)r.setReadAccess(e,!0),r.setWriteAccess(e,!0);else{if(n.isFunction(e))throw"Parse.ACL() called with a function.  Did you forget ()?";t._objectEach(e,function(e,i){if(!n.isString(i))throw"Tried to create an ACL with an invalid userId.";r.permissionsById[i]={},t._objectEach(e,function(e,t){if("read"!==t&&"write"!==t)throw"Tried to create an ACL with an invalid permission type.";if(!n.isBoolean(e))throw"Tried to create an ACL with an invalid permission value.";r.permissionsById[i][t]=e})})}},t.ACL.prototype.toJSON=function(){return n.clone(this.permissionsById)},t.ACL.prototype._setAccess=function(e,r,i){if(r instanceof t.User?r=r.id:r instanceof t.Role&&(r="role:"+r.getName()),!n.isString(r))throw"userId must be a string.";if(!n.isBoolean(i))throw"allowed must be either true or false.";var s=this.permissionsById[r];if(!s){if(!i)return;s={},this.permissionsById[r]=s}i?this.permissionsById[r][e]=!0:(delete s[e],n.isEmpty(s)&&delete s[r])},t.ACL.prototype._getAccess=function(e,n){n instanceof t.User?n=n.id:n instanceof t.Role&&(n="role:"+n.getName());var r=this.permissionsById[n];return r&&r[e]?!0:!1},t.ACL.prototype.setReadAccess=function(e,t){this._setAccess("read",e,t)},t.ACL.prototype.getReadAccess=function(e){return this._getAccess("read",e)},t.ACL.prototype.setWriteAccess=function(e,t){this._setAccess("write",e,t)},t.ACL.prototype.getWriteAccess=function(e){return this._getAccess("write",e)},t.ACL.prototype.setPublicReadAccess=function(e){this.setReadAccess(r,e)},t.ACL.prototype.getPublicReadAccess=function(){return this.getReadAccess(r)},t.ACL.prototype.setPublicWriteAccess=function(e){this.setWriteAccess(r,e)},t.ACL.prototype.getPublicWriteAccess=function(){return this.getWriteAccess(r)},t.ACL.prototype.getRoleReadAccess=function(e){if(e instanceof t.Role&&(e=e.getName()),n.isString(e))return this.getReadAccess("role:"+e);throw"role must be a Parse.Role or a String"},t.ACL.prototype.getRoleWriteAccess=function(e){if(e instanceof t.Role&&(e=e.getName()),n.isString(e))return this.getWriteAccess("role:"+e);throw"role must be a Parse.Role or a String"},t.ACL.prototype.setRoleReadAccess=function(e,r){if(e instanceof t.Role&&(e=e.getName()),n.isString(e))return void this.setReadAccess("role:"+e,r);throw"role must be a Parse.Role or a String"},t.ACL.prototype.setRoleWriteAccess=function(e,r){if(e instanceof t.Role&&(e=e.getName()),n.isString(e))return void this.setWriteAccess("role:"+e,r);throw"role must be a Parse.Role or a String"}}(this),function(e){e.Parse=e.Parse||{};var t=e.Parse,n=t._;t.Op=function(){this._initialize.apply(this,arguments)},t.Op.prototype={_initialize:function(){}},n.extend(t.Op,{_extend:t._extend,_opDecoderMap:{},_registerDecoder:function(e,n){t.Op._opDecoderMap[e]=n},_decode:function(e){var n=t.Op._opDecoderMap[e.__op];return n?n(e):void 0}}),t.Op._registerDecoder("Batch",function(e){var n=null;return t._arrayEach(e.ops,function(e){e=t.Op._decode(e),n=e._mergeWithPrevious(n)}),n}),t.Op.Set=t.Op._extend({_initialize:function(e){this._value=e},value:function(){return this._value},toJSON:function(){return t._encode(this.value())},_mergeWithPrevious:function(){return this},_estimate:function(){return this.value()}}),t.Op._UNSET={},t.Op.Unset=t.Op._extend({toJSON:function(){return{__op:"Delete"}},_mergeWithPrevious:function(){return this},_estimate:function(){return t.Op._UNSET}}),t.Op._registerDecoder("Delete",function(){return new t.Op.Unset}),t.Op.Increment=t.Op._extend({_initialize:function(e){this._amount=e},amount:function(){return this._amount},toJSON:function(){return{__op:"Increment",amount:this._amount}},_mergeWithPrevious:function(e){if(e){if(e instanceof t.Op.Unset)return new t.Op.Set(this.amount());if(e instanceof t.Op.Set)return new t.Op.Set(e.value()+this.amount());if(e instanceof t.Op.Increment)return new t.Op.Increment(this.amount()+e.amount());throw"Op is invalid after previous op."}return this},_estimate:function(e){return e?e+this.amount():this.amount()}}),t.Op._registerDecoder("Increment",function(e){return new t.Op.Increment(e.amount)}),t.Op.Add=t.Op._extend({_initialize:function(e){this._objects=e},objects:function(){return this._objects},toJSON:function(){return{__op:"Add",objects:t._encode(this.objects())}},_mergeWithPrevious:function(e){if(e){if(e instanceof t.Op.Unset)return new t.Op.Set(this.objects());if(e instanceof t.Op.Set)return new t.Op.Set(this._estimate(e.value()));if(e instanceof t.Op.Add)return new t.Op.Add(e.objects().concat(this.objects()));throw"Op is invalid after previous op."}return this},_estimate:function(e){return e?e.concat(this.objects()):n.clone(this.objects())}}),t.Op._registerDecoder("Add",function(e){return new t.Op.Add(t._decode(void 0,e.objects))}),t.Op.AddUnique=t.Op._extend({_initialize:function(e){this._objects=n.uniq(e)},objects:function(){return this._objects},toJSON:function(){return{__op:"AddUnique",objects:t._encode(this.objects())}},_mergeWithPrevious:function(e){if(e){if(e instanceof t.Op.Unset)return new t.Op.Set(this.objects());if(e instanceof t.Op.Set)return new t.Op.Set(this._estimate(e.value()));if(e instanceof t.Op.AddUnique)return new t.Op.AddUnique(this._estimate(e.objects()));throw"Op is invalid after previous op."}return this},_estimate:function(e){if(e){var r=n.clone(e);return t._arrayEach(this.objects(),function(e){if(e instanceof t.Object&&e.id){var i=n.find(r,function(n){return n instanceof t.Object&&n.id===e.id});if(i){var s=n.indexOf(r,i);r[s]=e}else r.push(e)}else n.contains(r,e)||r.push(e)}),r}return n.clone(this.objects())}}),t.Op._registerDecoder("AddUnique",function(e){return new t.Op.AddUnique(t._decode(void 0,e.objects))}),t.Op.Remove=t.Op._extend({_initialize:function(e){this._objects=n.uniq(e)},objects:function(){return this._objects},toJSON:function(){return{__op:"Remove",objects:t._encode(this.objects())}},_mergeWithPrevious:function(e){if(e){if(e instanceof t.Op.Unset)return e;if(e instanceof t.Op.Set)return new t.Op.Set(this._estimate(e.value()));if(e instanceof t.Op.Remove)return new t.Op.Remove(n.union(e.objects(),this.objects()));throw"Op is invalid after previous op."}return this},_estimate:function(e){if(e){var r=n.difference(e,this.objects());return t._arrayEach(this.objects(),function(e){e instanceof t.Object&&e.id&&(r=n.reject(r,function(n){return n instanceof t.Object&&n.id===e.id}))}),r}return[]}}),t.Op._registerDecoder("Remove",function(e){return new t.Op.Remove(t._decode(void 0,e.objects))}),t.Op.Relation=t.Op._extend({_initialize:function(e,r){this._targetClassName=null;var i=this,s=function(e){if(e instanceof t.Object){if(!e.id)throw"You can't add an unsaved Parse.Object to a relation.";if(i._targetClassName||(i._targetClassName=e.className),i._targetClassName!==e.className)throw"Tried to create a Parse.Relation with 2 different types: "+i._targetClassName+" and "+e.className+".";return e.id}return e};this.relationsToAdd=n.uniq(n.map(e,s)),this.relationsToRemove=n.uniq(n.map(r,s))},added:function(){var e=this;return n.map(this.relationsToAdd,function(n){var r=t.Object._create(e._targetClassName);return r.id=n,r})},removed:function(){var e=this;return n.map(this.relationsToRemove,function(n){var r=t.Object._create(e._targetClassName);return r.id=n,r})},toJSON:function(){var e=null,t=null,r=this,i=function(e){return{__type:"Pointer",className:r._targetClassName,objectId:e}},s=null;return this.relationsToAdd.length>0&&(s=n.map(this.relationsToAdd,i),e={__op:"AddRelation",objects:s}),this.relationsToRemove.length>0&&(s=n.map(this.relationsToRemove,i),t={__op:"RemoveRelation",objects:s}),e&&t?{__op:"Batch",ops:[e,t]}:e||t||{}},_mergeWithPrevious:function(e){if(e){if(e instanceof t.Op.Unset)throw"You can't modify a relation after deleting it.";if(e instanceof t.Op.Relation){if(e._targetClassName&&e._targetClassName!==this._targetClassName)throw"Related object must be of class "+e._targetClassName+", but "+this._targetClassName+" was passed in.";var r=n.union(n.difference(e.relationsToAdd,this.relationsToRemove),this.relationsToAdd),i=n.union(n.difference(e.relationsToRemove,this.relationsToAdd),this.relationsToRemove),s=new t.Op.Relation(r,i);return s._targetClassName=this._targetClassName,s}throw"Op is invalid after previous op."}return this},_estimate:function(e,n,r){if(e){if(e instanceof t.Relation){if(this._targetClassName)if(e.targetClassName){if(e.targetClassName!==this._targetClassName)throw"Related object must be a "+e.targetClassName+", but a "+this._targetClassName+" was passed in."}else e.targetClassName=this._targetClassName;return e}throw"Op is invalid after previous op."}var i=new t.Relation(n,r);i.targetClassName=this._targetClassName}}),t.Op._registerDecoder("AddRelation",function(e){return new t.Op.Relation(t._decode(void 0,e.objects),[])}),t.Op._registerDecoder("RemoveRelation",function(e){return new t.Op.Relation([],t._decode(void 0,e.objects))})}(this),function(e){e.Parse=e.Parse||{};var t=e.Parse,n=t._;t.Relation=function(e,t){this.parent=e,this.key=t,this.targetClassName=null},t.Relation.prototype={_ensureParentAndKey:function(e,t){if(this.parent=this.parent||e,this.key=this.key||t,this.parent!==e)throw"Internal Error. Relation retrieved from two different Objects.";if(this.key!==t)throw"Internal Error. Relation retrieved from two different keys."},add:function(e){n.isArray(e)||(e=[e]);var r=new t.Op.Relation(e,[]);this.parent.set(this.key,r),this.targetClassName=r._targetClassName},remove:function(e){n.isArray(e)||(e=[e]);var r=new t.Op.Relation([],e);this.parent.set(this.key,r),this.targetClassName=r._targetClassName},toJSON:function(){return{__type:"Relation",className:this.targetClassName}},query:function(){var e,n;return this.targetClassName?(e=t.Object._getSubclass(this.targetClassName),n=new t.Query(e)):(e=t.Object._getSubclass(this.parent.className),n=new t.Query(e),n._extraOptions.redirectClassNameForKey=this.key),n._addCondition("$relatedTo","object",this.parent._toPointer()),n._addCondition("$relatedTo","key",this.key),n}}}(this),function(e){e.Parse=e.Parse||{};var t=e.Parse,n=t._;t.Promise=function(){this._resolved=!1,this._rejected=!1,this._resolvedCallbacks=[],this._rejectedCallbacks=[]},n.extend(t.Promise,{_isPromisesAPlusCompliant:!1,is:function(e){return e&&e.then&&n.isFunction(e.then)},as:function(){var e=new t.Promise;return e.resolve.apply(e,arguments),e},error:function(){var e=new t.Promise;return e.reject.apply(e,arguments),e},when:function(e){var n;n=e&&t._isNullOrUndefined(e.length)?arguments:e;var r=n.length,i=!1,s=[],o=[];if(s.length=n.length,o.length=n.length,0===r)return t.Promise.as.apply(this,s);var u=new t.Promise,a=function(){r-=1,0===r&&(i?u.reject(o):u.resolve.apply(u,s))};return t._arrayEach(n,function(e,n){t.Promise.is(e)?e.then(function(e){s[n]=e,a()},function(e){o[n]=e,i=!0,a()}):(s[n]=e,a())}),u},_continueWhile:function(e,n){return e()?n().then(function(){return t.Promise._continueWhile(e,n)}):t.Promise.as()}}),n.extend(t.Promise.prototype,{resolve:function(){if(this._resolved||this._rejected)throw"A promise was resolved even though it had already been "+(this._resolved?"resolved":"rejected")+".";this._resolved=!0,this._result=arguments;var e=arguments;t._arrayEach(this._resolvedCallbacks,function(t){t.apply(this,e)}),this._resolvedCallbacks=[],this._rejectedCallbacks=[]},reject:function(e){if(this._resolved||this._rejected)throw"A promise was rejected even though it had already been "+(this._resolved?"resolved":"rejected")+".";this._rejected=!0,this._error=e,t._arrayEach(this._rejectedCallbacks,function(t){t(e)}),this._resolvedCallbacks=[],this._rejectedCallbacks=[]},then:function(e,n){var r=new t.Promise,i=function(){var n=arguments;if(e)if(t.Promise._isPromisesAPlusCompliant)try{n=[e.apply(this,n)]}catch(i){n=[t.Promise.error(i)]}else n=[e.apply(this,n)];1===n.length&&t.Promise.is(n[0])?n[0].then(function(){r.resolve.apply(r,arguments)},function(e){r.reject(e)}):r.resolve.apply(r,n)},s=function(e){var i=[];if(n){if(t.Promise._isPromisesAPlusCompliant)try{i=[n(e)]}catch(s){i=[t.Promise.error(s)]}else i=[n(e)];1===i.length&&t.Promise.is(i[0])?i[0].then(function(){r.resolve.apply(r,arguments)},function(e){r.reject(e)}):t.Promise._isPromisesAPlusCompliant?r.resolve.apply(r,i):r.reject(i[0])}else r.reject(e)},o=function(e){e.call()};t.Promise._isPromisesAPlusCompliant&&("undefined"!=typeof window&&window.setTimeout?o=function(e){window.setTimeout(e,0)}:"undefined"!=typeof process&&process.nextTick&&(o=function(e){process.nextTick(e)}));var u=this;return this._resolved?o(function(){i.apply(u,u._result)}):this._rejected?o(function(){s(u._error)}):(this._resolvedCallbacks.push(i),this._rejectedCallbacks.push(s)),r},always:function(e){return this.then(e,e)},done:function(e){return this.then(e)},fail:function(e){return this.then(null,e)},_thenRunCallbacks:function(e,r){var i;if(n.isFunction(e)){var s=e;i={success:function(e){s(e,null)},error:function(e){s(null,e)}}}else i=n.clone(e);return i=i||{},this.then(function(e){return i.success?i.success.apply(this,arguments):r&&r.trigger("sync",r,e,i),t.Promise.as.apply(t.Promise,arguments)},function(e){return i.error?n.isUndefined(r)?i.error(e):i.error(r,e):r&&r.trigger("error",r,e,i),t.Promise.error(e)})},_continueWith:function(e){return this.then(function(){return e(arguments,null)},function(t){return e(null,t)})}})}(this),function(e){e.Parse=e.Parse||{};var t=e.Parse,n=t._,r=function(e){if(26>e)return String.fromCharCode(65+e);if(52>e)return String.fromCharCode(97+(e-26));if(62>e)return String.fromCharCode(48+(e-52));if(62===e)return"+";if(63===e)return"/";throw"Tried to encode large digit "+e+" in base64."},i=function(e){var t=[];return t.length=Math.ceil(e.length/3),n.times(t.length,function(n){var i=e[3*n],s=e[3*n+1]||0,o=e[3*n+2]||0,u=3*n+1<e.length,f=3*n+2<e.length;t[n]=[r(i>>2&63),r(i<<4&48|s>>4&15),u?r(s<<2&60|o>>6&3):"=",f?r(63&o):"="].join("")}),t.join("")},s={ai:"application/postscript",aif:"audio/x-aiff",aifc:"audio/x-aiff",aiff:"audio/x-aiff",asc:"text/plain",atom:"application/atom+xml",au:"audio/basic",avi:"video/x-msvideo",bcpio:"application/x-bcpio",bin:"application/octet-stream",bmp:"image/bmp",cdf:"application/x-netcdf",cgm:"image/cgm","class":"application/octet-stream",cpio:"application/x-cpio",cpt:"application/mac-compactpro",csh:"application/x-csh",css:"text/css",dcr:"application/x-director",dif:"video/x-dv",dir:"application/x-director",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",dll:"application/octet-stream",dmg:"application/octet-stream",dms:"application/octet-stream",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",docm:"application/vnd.ms-word.document.macroEnabled.12",dotm:"application/vnd.ms-word.template.macroEnabled.12",dtd:"application/xml-dtd",dv:"video/x-dv",dvi:"application/x-dvi",dxr:"application/x-director",eps:"application/postscript",etx:"text/x-setext",exe:"application/octet-stream",ez:"application/andrew-inset",gif:"image/gif",gram:"application/srgs",grxml:"application/srgs+xml",gtar:"application/x-gtar",hdf:"application/x-hdf",hqx:"application/mac-binhex40",htm:"text/html",html:"text/html",ice:"x-conference/x-cooltalk",ico:"image/x-icon",ics:"text/calendar",ief:"image/ief",ifb:"text/calendar",iges:"model/iges",igs:"model/iges",jnlp:"application/x-java-jnlp-file",jp2:"image/jp2",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/x-javascript",kar:"audio/midi",latex:"application/x-latex",lha:"application/octet-stream",lzh:"application/octet-stream",m3u:"audio/x-mpegurl",m4a:"audio/mp4a-latm",m4b:"audio/mp4a-latm",m4p:"audio/mp4a-latm",m4u:"video/vnd.mpegurl",m4v:"video/x-m4v",mac:"image/x-macpaint",man:"application/x-troff-man",mathml:"application/mathml+xml",me:"application/x-troff-me",mesh:"model/mesh",mid:"audio/midi",midi:"audio/midi",mif:"application/vnd.mif",mov:"video/quicktime",movie:"video/x-sgi-movie",mp2:"audio/mpeg",mp3:"audio/mpeg",mp4:"video/mp4",mpe:"video/mpeg",mpeg:"video/mpeg",mpg:"video/mpeg",mpga:"audio/mpeg",ms:"application/x-troff-ms",msh:"model/mesh",mxu:"video/vnd.mpegurl",nc:"application/x-netcdf",oda:"application/oda",ogg:"application/ogg",pbm:"image/x-portable-bitmap",pct:"image/pict",pdb:"chemical/x-pdb",pdf:"application/pdf",pgm:"image/x-portable-graymap",pgn:"application/x-chess-pgn",pic:"image/pict",pict:"image/pict",png:"image/png",pnm:"image/x-portable-anymap",pnt:"image/x-macpaint",pntg:"image/x-macpaint",ppm:"image/x-portable-pixmap",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppam:"application/vnd.ms-powerpoint.addin.macroEnabled.12",pptm:"application/vnd.ms-powerpoint.presentation.macroEnabled.12",potm:"application/vnd.ms-powerpoint.template.macroEnabled.12",ppsm:"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",ps:"application/postscript",qt:"video/quicktime",qti:"image/x-quicktime",qtif:"image/x-quicktime",ra:"audio/x-pn-realaudio",ram:"audio/x-pn-realaudio",ras:"image/x-cmu-raster",rdf:"application/rdf+xml",rgb:"image/x-rgb",rm:"application/vnd.rn-realmedia",roff:"application/x-troff",rtf:"text/rtf",rtx:"text/richtext",sgm:"text/sgml",sgml:"text/sgml",sh:"application/x-sh",shar:"application/x-shar",silo:"model/mesh",sit:"application/x-stuffit",skd:"application/x-koan",skm:"application/x-koan",skp:"application/x-koan",skt:"application/x-koan",smi:"application/smil",smil:"application/smil",snd:"audio/basic",so:"application/octet-stream",spl:"application/x-futuresplash",src:"application/x-wais-source",sv4cpio:"application/x-sv4cpio",sv4crc:"application/x-sv4crc",svg:"image/svg+xml",swf:"application/x-shockwave-flash",t:"application/x-troff",tar:"application/x-tar",tcl:"application/x-tcl",tex:"application/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",tif:"image/tiff",tiff:"image/tiff",tr:"application/x-troff",tsv:"text/tab-separated-values",txt:"text/plain",ustar:"application/x-ustar",vcd:"application/x-cdlink",vrml:"model/vrml",vxml:"application/voicexml+xml",wav:"audio/x-wav",wbmp:"image/vnd.wap.wbmp",wbmxl:"application/vnd.wap.wbxml",wml:"text/vnd.wap.wml",wmlc:"application/vnd.wap.wmlc",wmls:"text/vnd.wap.wmlscript",wmlsc:"application/vnd.wap.wmlscriptc",wrl:"model/vrml",xbm:"image/x-xbitmap",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xml:"application/xml",xpm:"image/x-xpixmap",xsl:"application/xml",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.12",xltm:"application/vnd.ms-excel.template.macroEnabled.12",xlam:"application/vnd.ms-excel.addin.macroEnabled.12",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.12",xslt:"application/xslt+xml",xul:"application/vnd.mozilla.xul+xml",xwd:"image/x-xwindowdump",xyz:"chemical/x-xyz",zip:"application/zip"},o=function(e,n){var r=new t.Promise;if("undefined"==typeof FileReader)return t.Promise.error(new t.Error(t.Error.FILE_READ_ERROR,"Attempted to use a FileReader on an unsupported browser."));var i=new FileReader;return i.onloadend=function(){if(2!==i.readyState)return void r.reject(new t.Error(t.Error.FILE_READ_ERROR,"Error reading file."));var e=i.result,s=/^data:([^;]*);base64,(.*)$/.exec(e);return s?void r.resolve(s[2],n||s[1]):void r.reject(new t.Error(t.ERROR.FILE_READ_ERROR,"Unable to interpret data URL: "+e))},i.readAsDataURL(e),r};t.File=function(e,r,u){this._name=e;var a=/\.([^.]*)$/.exec(e);a&&(a=a[1].toLowerCase());var l=u||s[a]||"text/plain";if(n.isArray(r))this._source=t.Promise.as(i(r),l);else if(r&&r.base64){var h=/^data:([a-zA-Z]*\/[a-zA-Z+.-]*);(charset=[a-zA-Z0-9\-\/\s]*,)?base64,(\S+)/,p=h.exec(r.base64);this._source=p&&p.length>0?t.Promise.as(4===p.length?p[3]:p[2],p[1]):t.Promise.as(r.base64,l)}else if("undefined"!=typeof File&&r instanceof File)this._source=o(r,u);else if(n.isString(r))throw"Creating a Parse.File from a String is not yet supported."},t.File.prototype={name:function(){return this._name},url:function(){return this._url},save:function(e){e=e||{};var n=this;return n._previousSave||(n._previousSave=n._source.then(function(r,i){var s={base64:r,_ContentType:i};return t._request({route:"files",className:n._name,method:"POST",data:s,useMasterKey:e.useMasterKey})}).then(function(e){return n._name=e.name,n._url=e.url,n})),n._previousSave._thenRunCallbacks(e)}}}(this),function(e){e.Parse=e.Parse||{};var t=e.Parse,n=t._;t.Object=function(e,r){if(n.isString(e))return t.Object._create.apply(this,arguments);e=e||{},r&&r.parse&&(e=this.parse(e));var i=t._getValue(this,"defaults");if(i&&(e=n.extend({},i,e)),r&&r.collection&&(this.collection=r.collection),this._serverData={},this._opSetQueue=[{}],this.attributes={},this._hashedJSON={},this._escapedAttributes={},this.cid=n.uniqueId("c"),this.changed={},this._silent={},this._pending={},!this.set(e,{silent:!0}))throw new Error("Can't create an invalid Parse.Object");this.changed={},this._silent={},this._pending={},this._hasData=!0,this._previousAttributes=n.clone(this.attributes),this.initialize.apply(this,arguments)},t.Object.saveAll=function(e,n){return n=n||{},t.Object._deepSaveAsync(e,{useMasterKey:n.useMasterKey})._thenRunCallbacks(n)},t.Object.destroyAll=function(e,r){r=r||{};var i=function(e){e.trigger("destroy",e,e.collection,r)},s=[],o=function(e){var o=t.Promise.as();return e.length>0&&(o=o.then(function(){return t._request({route:"batch",method:"POST",useMasterKey:r.useMasterKey,data:{requests:n.map(e,function(e){return{method:"DELETE",path:"/1/classes/"+e.className+"/"+e.id}})}})}).then(function(n){t._arrayEach(e,function(e,o){if(n[o].success&&r.wait)i(e);else if(n[o].error){var u=new t.Error(n[o].error.code,n[o].error.error);u.object=e,s.push(u)}})})),o},u=t.Promise.as(),a=[];return t._arrayEach(e,function(t,n){if(t.id&&r.wait||i(t),t.id&&a.push(t),20===a.length||n+1===e.length){var s=a;a=[],u=u.then(function(){return o(s)})}}),u.then(function(){if(0===s.length)return!0;var e=new t.Error(t.Error.AGGREGATE_ERROR,"Error deleting an object in destroyAll");return e.errors=s,t.Promise.error(e)})._thenRunCallbacks(r)},t.Object.fetchAll=function(e,n){return t.Object._fetchAll(e,!0)._thenRunCallbacks(n)},t.Object.fetchAllIfNeeded=function(e,n){return t.Object._fetchAll(e,!1)._thenRunCallbacks(n)},n.extend(t.Object.prototype,t.Events,{_existed:!1,initialize:function(){},toJSON:function(){var e=this._toFullJSON();return t._arrayEach(["__type","className"],function(t){delete e[t]}),e},_toFullJSON:function(e){var r=n.clone(this.attributes);return t._objectEach(r,function(n,i){r[i]=t._encode(n,e)}),t._objectEach(this._operations,function(e,t){r[t]=e}),n.has(this,"id")&&(r.objectId=this.id),n.has(this,"createdAt")&&(r.createdAt=n.isDate(this.createdAt)?this.createdAt.toJSON():this.createdAt),n.has(this,"updatedAt")&&(r.updatedAt=n.isDate(this.updatedAt)?this.updatedAt.toJSON():this.updatedAt),r.__type="Object",r.className=this.className,r},_refreshCache:function(){var e=this;e._refreshingCache||(e._refreshingCache=!0,t._objectEach(this.attributes,function(r,i){r instanceof t.Object?r._refreshCache():n.isObject(r)&&e._resetCacheForKey(i)&&e.set(i,new t.Op.Set(r),{silent:!0})}),delete e._refreshingCache)},dirty:function(e){this._refreshCache();var t=n.last(this._opSetQueue);return e?t[e]?!0:!1:this.id?n.keys(t).length>0?!0:!1:!0},dirtyKeys:function(){return n.keys(n.last(this._opSetQueue))},_toPointer:function(){if(!this.id)throw new Error("Can't serialize an unsaved Parse.Object");return{__type:"Pointer",className:this.className,objectId:this.id}},get:function(e){return this.attributes[e]},relation:function(e){var n=this.get(e);if(n){if(n instanceof t.Relation)return n._ensureParentAndKey(this,e),n;throw"Called relation() on non-relation field "+e}return new t.Relation(this,e)},escape:function(e){var r=this._escapedAttributes[e];if(r)return r;var i,s=this.attributes[e];return i=t._isNullOrUndefined(s)?"":n.escape(s.toString()),this._escapedAttributes[e]=i,i},has:function(e){return!t._isNullOrUndefined(this.attributes[e])},_mergeMagicFields:function(e){var r=this,i=["id","objectId","createdAt","updatedAt"];t._arrayEach(i,function(i){e[i]&&("objectId"===i?r.id=e[i]:r[i]="createdAt"!==i&&"updatedAt"!==i||n.isDate(e[i])?e[i]:t._parseDate(e[i]),delete e[i])})},_copyServerData:function(e){var n={};t._objectEach(e,function(e,r){n[r]=t._decode(r,e)}),this._serverData=n,this._rebuildAllEstimatedData(),this._refreshCache(),this._opSetQueue=[{}],this._rebuildAllEstimatedData()},_mergeFromObject:function(e){e&&(this.id=e.id,this.createdAt=e.createdAt,this.updatedAt=e.updatedAt,this._copyServerData(e._serverData),this._hasData=!0)},_startSave:function(){this._opSetQueue.push({})},_cancelSave:function(){var e=n.first(this._opSetQueue);this._opSetQueue=n.rest(this._opSetQueue);var r=n.first(this._opSetQueue);t._objectEach(e,function(t,n){var i=e[n],s=r[n];i&&s?r[n]=s._mergeWithPrevious(i):i&&(r[n]=i)}),this._saving=this._saving-1},_finishSave:function(e){var r={};t._traverse(this.attributes,function(e){e instanceof t.Object&&e.id&&e._hasData&&(r[e.id]=e)});var i=n.first(this._opSetQueue);this._opSetQueue=n.rest(this._opSetQueue),this._applyOpSet(i,this._serverData),this._mergeMagicFields(e);var s=this;t._objectEach(e,function(e,n){s._serverData[n]=t._decode(n,e);var i=t._traverse(s._serverData[n],function(e){return e instanceof t.Object&&r[e.id]?r[e.id]:void 0});i&&(s._serverData[n]=i)}),this._rebuildAllEstimatedData(),this._saving=this._saving-1},_finishFetch:function(e,t){this._opSetQueue=[{}],this._mergeMagicFields(e),this._copyServerData(e),this._hasData=t},_applyOpSet:function(e,n){var r=this;t._objectEach(e,function(e,i){n[i]=e._estimate(n[i],r,i),n[i]===t.Op._UNSET&&delete n[i]})},_resetCacheForKey:function(e){var r=this.attributes[e];if(!(!n.isObject(r)||r instanceof t.Object||r instanceof t.File)){r=r.toJSON?r.toJSON():r;var i=JSON.stringify(r);if(this._hashedJSON[e]!==i){var s=!!this._hashedJSON[e];return this._hashedJSON[e]=i,s}}return!1},_rebuildEstimatedDataForKey:function(e){var n=this;delete this.attributes[e],this._serverData[e]&&(this.attributes[e]=this._serverData[e]),t._arrayEach(this._opSetQueue,function(r){var i=r[e];i&&(n.attributes[e]=i._estimate(n.attributes[e],n,e),n.attributes[e]===t.Op._UNSET?delete n.attributes[e]:n._resetCacheForKey(e))})},_rebuildAllEstimatedData:function(){var e=this,r=n.clone(this.attributes);this.attributes=n.clone(this._serverData),t._arrayEach(this._opSetQueue,function(n){e._applyOpSet(n,e.attributes),t._objectEach(n,function(t,n){e._resetCacheForKey(n)})}),t._objectEach(r,function(t,n){e.attributes[n]!==t&&e.trigger("change:"+n,e,e.attributes[n],{})}),t._objectEach(this.attributes,function(t,i){n.has(r,i)||e.trigger("change:"+i,e,t,{})})},set:function(e,r,i){var s;if(n.isObject(e)||t._isNullOrUndefined(e)?(s=e,t._objectEach(s,function(e,n){s[n]=t._decode(n,e)}),i=r):(s={},s[e]=t._decode(e,r)),i=i||{},!s)return this;s instanceof t.Object&&(s=s.attributes),i.unset&&t._objectEach(s,function(e,n){s[n]=new t.Op.Unset});var o=n.clone(s),u=this;if(t._objectEach(o,function(e,n){e instanceof t.Op&&(o[n]=e._estimate(u.attributes[n],u,n),o[n]===t.Op._UNSET&&delete o[n])}),!this._validate(s,i))return!1;this._mergeMagicFields(s),i.changes={};var a=this._escapedAttributes;return this._previousAttributes||{},t._arrayEach(n.keys(s),function(e){var r=s[e];r instanceof t.Relation&&(r.parent=u),r instanceof t.Op||(r=new t.Op.Set(r));var o=!0;r instanceof t.Op.Set&&n.isEqual(u.attributes[e],r.value)&&(o=!1),o&&(delete a[e],i.silent?u._silent[e]=!0:i.changes[e]=!0);var l=n.last(u._opSetQueue);l[e]=r._mergeWithPrevious(l[e]),u._rebuildEstimatedDataForKey(e),o?(u.changed[e]=u.attributes[e],i.silent||(u._pending[e]=!0)):(delete u.changed[e],delete u._pending[e])}),i.silent||this.change(i),this},unset:function(e,t){return t=t||{},t.unset=!0,this.set(e,null,t)},increment:function(e,r){return(n.isUndefined(r)||n.isNull(r))&&(r=1),this.set(e,new t.Op.Increment(r))},add:function(e,n){return this.set(e,new t.Op.Add([n]))},addUnique:function(e,n){return this.set(e,new t.Op.AddUnique([n]))},remove:function(e,n){return this.set(e,new t.Op.Remove([n]))},op:function(e){return n.last(this._opSetQueue)[e]},clear:function(e){e=e||{},e.unset=!0;var t=n.extend(this.attributes,this._operations);return this.set(t,e)},_getSaveJSON:function(){var e=n.clone(n.first(this._opSetQueue));return t._objectEach(e,function(t,n){e[n]=t.toJSON()}),e},_canBeSerialized:function(){return t.Object._canBeSerializedAsValue(this.attributes)},fetch:function(e){var n=this;e=e||{};var r=t._request({method:"GET",route:"classes",className:this.className,objectId:this.id,useMasterKey:e.useMasterKey});return r.then(function(e,t,r){return n._finishFetch(n.parse(e,t,r),!0),n})._thenRunCallbacks(e,this)},save:function(e,r,i){var s,o,u;if(n.isObject(e)||t._isNullOrUndefined(e)?(s=e,u=r):(s={},s[e]=r,u=i),!u&&s){var a=n.reject(s,function(e,t){return n.include(["success","error","wait"],t)});if(0===a.length){var f=!0;if(n.has(s,"success")&&!n.isFunction(s.success)&&(f=!1),n.has(s,"error")&&!n.isFunction(s.error)&&(f=!1),f)return this.save(null,s)}}u=n.clone(u)||{},u.wait&&(o=n.clone(this.attributes));var l=n.clone(u)||{};l.wait&&(l.silent=!0);var h;if(l.error=function(e,t){h=t},s&&!this.set(s,l))return t.Promise.error(h)._thenRunCallbacks(u,this);var p=this;p._refreshCache();var d=[],v=[];return t.Object._findUnsavedChildren(p.attributes,d,v),d.length+v.length>0?t.Object._deepSaveAsync(this.attributes,{useMasterKey:u.useMasterKey}).then(function(){return p.save(null,u)},function(e){return t.Promise.error(e)._thenRunCallbacks(u,p)}):(this._startSave(),this._saving=(this._saving||0)+1,this._allPreviousSaves=this._allPreviousSaves||t.Promise.as(),this._allPreviousSaves=this._allPreviousSaves._continueWith(function(){var e=p.id?"PUT":"POST",r=p._getSaveJSON(),i="classes",a=p.className;"_User"!==p.className||p.id||(i="users",a=null);var f=t._request({route:i,className:a,objectId:p.id,method:e,useMasterKey:u.useMasterKey,data:r});return f=f.then(function(e,t,r){var i=p.parse(e,t,r);return u.wait&&(i=n.extend(s||{},i)),p._finishSave(i),u.wait&&p.set(o,l),p},function(e){return p._cancelSave(),t.Promise.error(e)})._thenRunCallbacks(u,p)}),this._allPreviousSaves)},destroy:function(e){e=e||{};var n=this,r=function(){n.trigger("destroy",n,n.collection,e)};if(!this.id)return r();e.wait||r();var i=t._request({route:"classes",className:this.className,objectId:this.id,method:"DELETE",useMasterKey:e.useMasterKey});return i.then(function(){return e.wait&&r(),n})._thenRunCallbacks(e,this)},parse:function(e,r){var i=n.clone(e);return n(["createdAt","updatedAt"]).each(function(e){i[e]&&(i[e]=t._parseDate(i[e]))}),i.updatedAt||(i.updatedAt=i.createdAt),r&&(this._existed=201!==r),i},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.id},change:function(e){e=e||{};var r=this._changing;this._changing=!0;var i=this;t._objectEach(this._silent,function(e){i._pending[e]=!0});var s=n.extend({},e.changes,this._silent);if(this._silent={},t._objectEach(s,function(t,n){i.trigger("change:"+n,i,i.get(n),e)}),r)return this;for(var o=function(e,t){i._pending[t]||i._silent[t]||delete i.changed[t]};!n.isEmpty(this._pending);)this._pending={},this.trigger("change",this,e),t._objectEach(this.changed,o),i._previousAttributes=n.clone(this.attributes);return this._changing=!1,this},existed:function(){return this._existed},hasChanged:function(e){return arguments.length?this.changed&&n.has(this.changed,e):!n.isEmpty(this.changed)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var r={},i=this._previousAttributes;return t._objectEach(e,function(e,t){n.isEqual(i[t],e)||(r[t]=e)}),r},previous:function(e){return arguments.length&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},validate:function(e){if(!n.has(e,"ACL")||e.ACL instanceof t.ACL){var r=!0;return t._objectEach(e,function(e,t){/^[A-Za-z][0-9A-Za-z_]*$/.test(t)||(r=!1)}),r?!1:new t.Error(t.Error.INVALID_KEY_NAME)}return new t.Error(t.Error.OTHER_CAUSE,"ACL must be a Parse.ACL.")},_validate:function(e,t){if(t.silent||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validate(e,t);return r?(t&&t.error?t.error(this,r,t):this.trigger("error",this,r,t),!1):!0},getACL:function(){return this.get("ACL")},setACL:function(e,t){return this.set("ACL",e,t)}}),t.Object._getSubclass=function(e){if(!n.isString(e))throw"Parse.Object._getSubclass requires a string argument.";var r=t.Object._classMap[e];return r||(r=t.Object.extend(e),t.Object._classMap[e]=r),r},t.Object._create=function(e,n,r){var i=t.Object._getSubclass(e);return new i(n,r)},t.Object._toObjectIdArray=function(e,n){if(0===e.length)return t.Promise.as(e);for(var r,i=e[0].className,s=[],o=0;o<e.length;o++){var u=e[o];if(i!==u.className)return r=new t.Error(t.Error.INVALID_CLASS_NAME,"All objects should be of the same class"),t.Promise.error(r);if(!u.id)return r=new t.Error(t.Error.MISSING_OBJECT_ID,"All objects must have an ID"),t.Promise.error(r);n&&u._hasData||s.push(u.id)}return t.Promise.as(s)},t.Object._updateWithFetchedResults=function(e,n,r){var i={};t._arrayEach(n,function(e){i[e.id]=e});for(var s=0;s<e.length;s++){var o=e[s],u=i[o.id];if(!u&&r){var a=new t.Error(t.Error.OBJECT_NOT_FOUND,"All objects must exist on the server");return t.Promise.error(a)}o._mergeFromObject(u)}return t.Promise.as(e)},t.Object._fetchAll=function(e,n){if(0===e.length)return t.Promise.as(e);var r=!n;return t.Object._toObjectIdArray(e,r).then(function(n){var r=e[0].className,i=new t.Query(r);return i.containedIn("objectId",n),i.limit=n.length,i.find()}).then(function(r){return t.Object._updateWithFetchedResults(e,r,n)})},t.Object._classMap={},t.Object._extend=t._extend,t.Object.extend=function(e,r,i){if(!n.isString(e)){if(e&&n.has(e,"className"))return t.Object.extend(e.className,e,r);throw new Error("Parse.Object.extend's first argument should be the className.")}"User"===e&&t.User._performUserRewrite&&(e="_User"),r=r||{},r.className=e;var s=null;if(n.has(t.Object._classMap,e)){var o=t.Object._classMap[e];s=o._extend(r,i)}else s=this._extend(r,i);return s.extend=function(r){if(n.isString(r)||r&&n.has(r,"className"))return t.Object.extend.apply(s,arguments);var i=[e].concat(t._.toArray(arguments));return t.Object.extend.apply(s,i)},t.Object._classMap[e]=s,s},t.Object._findUnsavedChildren=function(e,n,r){t._traverse(e,function(e){return e instanceof t.Object?(e._refreshCache(),void (e.dirty()&&n.push(e))):e instanceof t.File?void (e.url()||r.push(e)):void 0})},t.Object._canBeSerializedAsValue=function(e){if(e instanceof t.Object)return!!e.id;if(e instanceof t.File)return!0;var r=!0;return n.isArray(e)?t._arrayEach(e,function(e){t.Object._canBeSerializedAsValue(e)||(r=!1)}):n.isObject(e)&&t._objectEach(e,function(e){t.Object._canBeSerializedAsValue(e)||(r=!1)}),r},t.Object._deepSaveAsync=function(e,r){var i=[],s=[];t.Object._findUnsavedChildren(e,i,s);var o=t.Promise.as();n.each(s,function(e){o=o.then(function(){return e.save(r)})});var u=n.uniq(i),a=n.uniq(u);return o.then(function(){return t.Promise._continueWhile(function(){return a.length>0},function(){var e=[],i=[];if(t._arrayEach(a,function(t){return e.length>20?void i.push(t):void (t._canBeSerialized()?e.push(t):i.push(t))}),a=i,0===e.length)return t.Promise.error(new t.Error(t.Error.OTHER_CAUSE,"Tried to save a batch with a cycle."));var s=t.Promise.when(n.map(e,function(e){return e._allPreviousSaves||t.Promise.as()})),o=new t.Promise;return t._arrayEach(e,function(e){e._allPreviousSaves=o}),s._continueWith(function(){return t._request({route:"batch",method:"POST",useMasterKey:r.useMasterKey,data:{requests:n.map(e,function(e){var t=e._getSaveJSON(),n="POST",r="/1/classes/"+e.className;return e.id&&(r=r+"/"+e.id,n="PUT"),e._startSave(),{method:n,path:r,body:t}})}}).then(function(n,r,i){var s;return t._arrayEach(e,function(e,t){n[t].success?e._finishSave(e.parse(n[t].success,r,i)):(s=s||n[t].error,e._cancelSave())}),s?t.Promise.error(new t.Error(s.code,s.error)):void 0}).then(function(e){return o.resolve(e),e},function(e){return o.reject(e),t.Promise.error(e)})})})}).then(function(){return e})}}(this),function(e){e.Parse=e.Parse||{};var t=e.Parse,n=t._;t.Role=t.Object.extend("_Role",{constructor:function(e,r){n.isString(e)&&r instanceof t.ACL?(t.Object.prototype.constructor.call(this,null,null),this.setName(e),this.setACL(r)):t.Object.prototype.constructor.call(this,e,r)},getName:function(){return this.get("name")},setName:function(e,t){return this.set("name",e,t)},getUsers:function(){return this.relation("users")},getRoles:function(){return this.relation("roles")},validate:function(e,r){if("name"in e&&e.name!==this.getName()){var i=e.name;if(this.id&&this.id!==e.objectId)return new t.Error(t.Error.OTHER_CAUSE,"A role's name can only be set before it has been saved.");if(!n.isString(i))return new t.Error(t.Error.OTHER_CAUSE,"A role's name must be a String.");if(!/^[0-9a-zA-Z\-_ ]+$/.test(i))return new t.Error(t.Error.OTHER_CAUSE,"A role's name can only contain alphanumeric characters, _, -, and spaces.")}return t.Object.prototype.validate?t.Object.prototype.validate.call(this,e,r):!1}})}(this),function(e){e.Parse=e.Parse||{};var t=e.Parse,n=t._;t.Collection=function(e,t){t=t||{},t.comparator&&(this.comparator=t.comparator),t.model&&(this.model=t.model),t.query&&(this.query=t.query),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,{silent:!0,parse:t.parse})},n.extend(t.Collection.prototype,t.Events,{model:t.Object,initialize:function(){},toJSON:function(){return this.map(function(e){return e.toJSON()})},add:function(e,r){var i,s,o,u,a,f,l={},h={};for(r=r||{},e=n.isArray(e)?e.slice():[e],i=0,o=e.length;o>i;i++){if(e[i]=this._prepareModel(e[i],r),u=e[i],!u)throw new Error("Can't add an invalid model to a collection");if(a=u.cid,l[a]||this._byCid[a])throw new Error("Duplicate cid: can't add the same model to a collection twice");if(f=u.id,!t._isNullOrUndefined(f)&&(h[f]||this._byId[f]))throw new Error("Duplicate id: can't add the same model to a collection twice");h[f]=u,l[a]=u}for(i=0;o>i;i++)(u=e[i]).on("all",this._onModelEvent,this),this._byCid[u.cid]=u,u.id&&(this._byId[u.id]=u);if(this.length+=o,s=t._isNullOrUndefined(r.at)?this.models.length:r.at,this.models.splice.apply(this.models,[s,0].concat(e)),this.comparator&&this.sort({silent:!0}),r.silent)return this;for(i=0,o=this.models.length;o>i;i++)u=this.models[i],l[u.cid]&&(r.index=i,u.trigger("add",u,this,r));return this},remove:function(e,t){var r,i,s,o;for(t=t||{},e=n.isArray(e)?e.slice():[e],r=0,i=e.length;i>r;r++)o=this.getByCid(e[r])||this.get(e[r]),o&&(delete this._byId[o.id],delete this._byCid[o.cid],s=this.indexOf(o),this.models.splice(s,1),this.length--,t.silent||(t.index=s,o.trigger("remove",o,this,t)),this._removeReference(o));return this},get:function(e){return e&&this._byId[e.id||e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},sort:function(e){if(e=e||{},!this.comparator)throw new Error("Cannot sort a set without a comparator");var t=n.bind(this.comparator,this);return 1===this.comparator.length?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("reset",this,e),this},pluck:function(e){return n.map(this.models,function(t){return t.get(e)})},reset:function(e,n){var r=this;return e=e||[],n=n||{},t._arrayEach(this.models,function(e){r._removeReference(e)}),this._reset(),this.add(e,{silent:!0,parse:n.parse}),n.silent||this.trigger("reset",this,n),this},fetch:function(e){e=n.clone(e)||{},void 0===e.parse&&(e.parse=!0);var r=this,i=this.query||new t.Query(this.model);return i.find({useMasterKey:e.useMasterKey}).then(function(t){return e.add?r.add(t,e):r.reset(t,e),r})._thenRunCallbacks(e,this)},create:function(e,t){var r=this;if(t=t?n.clone(t):{},e=this._prepareModel(e,t),!e)return!1;t.wait||r.add(e,t);var i=t.success;return t.success=function(n,s){t.wait&&r.add(n,t),i?i(n,s):n.trigger("sync",e,s,t)},e.save(null,t),e},parse:function(e){return e},chain:function(){return n(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,n){if(e instanceof t.Object)e.collection||(e.collection=this);else{var r=e;n.collection=this,e=new this.model(r,n),e._validate(e.attributes,n)||(e=!1)}return e},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){("add"!==e&&"remove"!==e||n===this)&&("destroy"===e&&this.remove(t,r),t&&"change:objectId"===e&&(delete this._byId[t.previous("objectId")],this._byId[t.id]=t),this.trigger.apply(this,arguments))}});var r=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];t._arrayEach(r,function(e){t.Collection.prototype[e]=function(){return n[e].apply(n,[this.models].concat(n.toArray(arguments)))}}),t.Collection.extend=t._extend}(this),function(e){e.Parse=e.Parse||{};var t=e.Parse,n=t._;t.View=function(e){this.cid=n.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()};var r=/^(\S+)\s*(.*)$/,i=["model","collection","el","id","attributes","className","tagName"];n.extend(t.View.prototype,t.Events,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(e,n,r){var i=document.createElement(e);return n&&t.$(i).attr(n),r&&t.$(i).html(r),i},setElement:function(e,n){return this.$el=t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(e=e||t._getValue(this,"events")){this.undelegateEvents();var i=this;t._objectEach(e,function(t,s){if(n.isFunction(t)||(t=i[e[s]]),!t)throw new Error('Event "'+e[s]+'" does not exist');var o=s.match(r),u=o[1],f=o[2];t=n.bind(t,i),u+=".delegateEvents"+i.cid,""===f?i.$el.bind(u,t):i.$el.delegate(f,u,t)})}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=n.extend({},this.options,e));var t=this;n.each(i,function(n){e[n]&&(t[n]=e[n])}),this.options=e},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var e=t._getValue(this,"attributes")||{};this.id&&(e.id=this.id),this.className&&(e["class"]=this.className),this.setElement(this.make(this.tagName,e),!1)}}}),t.View.extend=t._extend}(this),function(e){e.Parse=e.Parse||{};var t=e.Parse,n=t._;t.User=t.Object.extend("_User",{_isCurrentUser:!1,_mergeFromObject:function(e){e.getSessionToken()&&(this._sessionToken=e.getSessionToken()),t.User.__super__._mergeFromObject.call(this,e)},_mergeMagicFields:function(e){e.sessionToken&&(this._sessionToken=e.sessionToken,delete e.sessionToken),t.User.__super__._mergeMagicFields.call(this,e)},_cleanupAuthData:function(){if(this.isCurrent()){var e=this.get("authData");e&&t._objectEach(this.get("authData"),function(t,n){e[n]||delete e[n]})}},_synchronizeAllAuthData:function(){var e=this.get("authData");if(e){var n=this;t._objectEach(this.get("authData"),function(e,t){n._synchronizeAuthData(t)})}},_synchronizeAuthData:function(e){if(this.isCurrent()){var r;n.isString(e)?(r=e,e=t.User._authProviders[r]):r=e.getAuthType();var i=this.get("authData");if(i&&e){var s=e.restoreAuthentication(i[r]);s||this._unlinkFrom(e)}}},_handleSaveResult:function(e){e&&(this._isCurrentUser=!0),this._cleanupAuthData(),this._synchronizeAllAuthData(),delete this._serverData.password,this._rebuildEstimatedDataForKey("password"),this._refreshCache(),(e||this.isCurrent())&&t.User._saveCurrentUser(this)},_linkWith:function(e,r){var i;if(n.isString(e)?(i=e,e=t.User._authProviders[e]):i=e.getAuthType(),n.has(r,"authData")){var s=this.get("authData")||{};s[i]=r.authData,this.set("authData",s);var o=n.clone(r)||{};return o.success=function(e){e._handleSaveResult(!0),r.success&&r.success.apply(this,arguments)},this.save({authData:s},o)}var u=this,a=new t.Promise;return e.authenticate({success:function(e,t){u._linkWith(e,{authData:t,success:r.success,error:r.error}).then(function(){a.resolve(u)})},error:function(e,t){r.error&&r.error(u,t),a.reject(t)}}),a},_unlinkFrom:function(e,r){var i;n.isString(e)?(i=e,e=t.User._authProviders[e]):i=e.getAuthType();var s=n.clone(r),o=this;return s.authData=null,s.success=function(){o._synchronizeAuthData(e),r.success&&r.success.apply(this,arguments)},this._linkWith(e,s)},_isLinked:function(e){var t;t=n.isString(e)?e:e.getAuthType();var r=this.get("authData")||{};return!!r[t]},_logOutWithAll:function(){var e=this.get("authData");if(e){var n=this;t._objectEach(this.get("authData"),function(e,t){n._logOutWith(t)})}},_logOutWith:function(e){this.isCurrent()&&(n.isString(e)&&(e=t.User._authProviders[e]),e&&e.deauthenticate&&e.deauthenticate())},signUp:function(e,r){var i;r=r||{};var s=e&&e.username||this.get("username");if(!s||""===s)return i=new t.Error(t.Error.OTHER_CAUSE,"Cannot sign up user with an empty name."),r&&r.error&&r.error(this,i),t.Promise.error(i);var o=e&&e.password||this.get("password");if(!o||""===o)return i=new t.Error(t.Error.OTHER_CAUSE,"Cannot sign up user with an empty password."),r&&r.error&&r.error(this,i),t.Promise.error(i);var u=n.clone(r);return u.success=function(e){e._handleSaveResult(!0),r.success&&r.success.apply(this,arguments)},this.save(e,u)},logIn:function(e){var n=this;e=e||{};var r=t._request({route:"login",method:"GET",useMasterKey:e.useMasterKey,data:this.toJSON()});return r.then(function(e,t,r){var i=n.parse(e,t,r);return n._finishFetch(i),n._handleSaveResult(!0),n})._thenRunCallbacks(e,this)},save:function(e,r,i){var s,o;n.isObject(e)||n.isNull(e)||n.isUndefined(e)?(s=e,o=r):(s={},s[e]=r,o=i),o=o||{};var u=n.clone(o);return u.success=function(e){e._handleSaveResult(!1),o.success&&o.success.apply(this,arguments)},t.Object.prototype.save.call(this,s,u)},fetch:function(e){var r=e?n.clone(e):{};return r.success=function(t){t._handleSaveResult(!1),e&&e.success&&e.success.apply(this,arguments)},t.Object.prototype.fetch.call(this,r)},isCurrent:function(){return this._isCurrentUser},getUsername:function(){return this.get("username")},setUsername:function(e,t){return this.set("username",e,t)},setPassword:function(e,t){return this.set("password",e,t)},getEmail:function(){return this.get("email")},setEmail:function(e,t){return this.set("email",e,t)},authenticated:function(){return!!this._sessionToken&&t.User.current()&&t.User.current().id===this.id},getSessionToken:function(){return this._sessionToken}},{_currentUser:null,_currentUserMatchesDisk:!1,_CURRENT_USER_KEY:"currentUser",_authProviders:{},_performUserRewrite:!0,signUp:function(e,n,r,i){r=r||{},r.username=e,r.password=n;var s=t.Object._create("_User");return s.signUp(r,i)},logIn:function(e,n,r){var i=t.Object._create("_User");return i._finishFetch({username:e,password:n}),i.logIn(r)},become:function(e,n){n=n||{};var r=t.Object._create("_User");return t._request({route:"users",className:"me",method:"GET",useMasterKey:n.useMasterKey,sessionToken:e}).then(function(e,t,n){var i=r.parse(e,t,n);return r._finishFetch(i),r._handleSaveResult(!0),r})._thenRunCallbacks(n,r)},logOut:function(){null!==t.User._currentUser&&(t.User._currentUser._logOutWithAll(),t.User._currentUser._isCurrentUser=!1),t.User._currentUserMatchesDisk=!0,t.User._currentUser=null,t.localStorage.removeItem(t._getParsePath(t.User._CURRENT_USER_KEY))},requestPasswordReset:function(e,n){n=n||{};var r=t._request({route:"requestPasswordReset",method:"POST",useMasterKey:n.useMasterKey,data:{email:e}});return r._thenRunCallbacks(n)},current:function(){if(t.User._currentUser)return t.User._currentUser;if(t.User._currentUserMatchesDisk)return t.User._currentUser;t.User._currentUserMatchesDisk=!0;var e=t.localStorage.getItem(t._getParsePath(t.User._CURRENT_USER_KEY));if(!e)return null;t.User._currentUser=t.Object._create("_User"),t.User._currentUser._isCurrentUser=!0;var n=JSON.parse(e);return t.User._currentUser.id=n._id,delete n._id,t.User._currentUser._sessionToken=n._sessionToken,delete n._sessionToken,t.User._currentUser._finishFetch(n),t.User._currentUser._synchronizeAllAuthData(),t.User._currentUser._refreshCache(),t.User._currentUser._opSetQueue=[{}],t.User._currentUser},allowCustomUserClass:function(e){this._performUserRewrite=!e},_saveCurrentUser:function(e){t.User._currentUser!==e&&t.User.logOut(),e._isCurrentUser=!0,t.User._currentUser=e,t.User._currentUserMatchesDisk=!0;var n=e.toJSON();n._id=e.id,n._sessionToken=e._sessionToken,t.localStorage.setItem(t._getParsePath(t.User._CURRENT_USER_KEY),JSON.stringify(n))},_registerAuthenticationProvider:function(e){t.User._authProviders[e.getAuthType()]=e,t.User.current()&&t.User.current()._synchronizeAuthData(e.getAuthType())},_logInWith:function(e,n){var r=t.Object._create("_User");return r._linkWith(e,n)}})}(this),function(e){e.Parse=e.Parse||{};var t=e.Parse,n=t._;t.Query=function(e){n.isString(e)&&(e=t.Object._getSubclass(e)),this.objectClass=e,this.className=e.prototype.className,this._where={},this._include=[],this._limit=-1,this._skip=0,this._extraOptions={}},t.Query.or=function(){var e=n.toArray(arguments),r=null;t._arrayEach(e,function(e){if(n.isNull(r)&&(r=e.className),r!==e.className)throw"All queries must be for the same class"});var i=new t.Query(r);return i._orQuery(e),i},t.Query.prototype={get:function(e,r){var i=this;i.equalTo("objectId",e);var s={};return r&&n.has(r,"useMasterKey")&&(s={useMasterKey:r.useMasterKey}),i.first(s).then(function(e){if(e)return e;var n=new t.Error(t.Error.OBJECT_NOT_FOUND,"Object not found.");return t.Promise.error(n)})._thenRunCallbacks(r,null)},toJSON:function(){var e={where:this._where};return this._include.length>0&&(e.include=this._include.join(",")),this._select&&(e.keys=this._select.join(",")),this._limit>=0&&(e.limit=this._limit),this._skip>0&&(e.skip=this._skip),void 0!==this._order&&(e.order=this._order.join(",")),t._objectEach(this._extraOptions,function(t,n){e[n]=t}),e},find:function(e){var r=this;e=e||{};var i=t._request({route:"classes",className:this.className,method:"GET",useMasterKey:e.useMasterKey,data:this.toJSON()});return i.then(function(e){return n.map(e.results,function(n){var i;return i=e.className?new t.Object(e.className):new r.objectClass,i._finishFetch(n,!0),i})})._thenRunCallbacks(e)},count:function(e){var n=this;e=e||{};var r=this.toJSON();r.limit=0,r.count=1;var i=t._request({route:"classes",className:n.className,method:"GET",useMasterKey:e.useMasterKey,data:r});return i.then(function(e){return e.count})._thenRunCallbacks(e)},first:function(e){var r=this;e=e||{};var i=this.toJSON();i.limit=1;var s=t._request({route:"classes",className:this.className,method:"GET",useMasterKey:e.useMasterKey,data:i});return s.then(function(e){return n.map(e.results,function(e){var t=new r.objectClass;return t._finishFetch(e,!0),t})[0]})._thenRunCallbacks(e)},collection:function(e,r){return r=r||{},new t.Collection(e,n.extend(r,{model:this.objectClass,query:this}))},skip:function(e){return this._skip=e,this},limit:function(e){return this._limit=e,this},equalTo:function(e,r){return n.isUndefined(r)?this.doesNotExist(e):(this._where[e]=t._encode(r),this)},_addCondition:function(e,n,r){return this._where[e]||(this._where[e]={}),this._where[e][n]=t._encode(r),this},notEqualTo:function(e,t){return this._addCondition(e,"$ne",t),this},lessThan:function(e,t){return this._addCondition(e,"$lt",t),this},greaterThan:function(e,t){return this._addCondition(e,"$gt",t),this},lessThanOrEqualTo:function(e,t){return this._addCondition(e,"$lte",t),this},greaterThanOrEqualTo:function(e,t){return this._addCondition(e,"$gte",t),this},containedIn:function(e,t){return this._addCondition(e,"$in",t),this},notContainedIn:function(e,t){return this._addCondition(e,"$nin",t),this},containsAll:function(e,t){return this._addCondition(e,"$all",t),this},exists:function(e){return this._addCondition(e,"$exists",!0),this},doesNotExist:function(e){return this._addCondition(e,"$exists",!1),this},matches:function(e,t,n){return this._addCondition(e,"$regex",t),n||(n=""),t.ignoreCase&&(n+="i"),t.multiline&&(n+="m"),n&&n.length&&this._addCondition(e,"$options",n),this},matchesQuery:function(e,t){var n=t.toJSON();return n.className=t.className,this._addCondition(e,"$inQuery",n),this},doesNotMatchQuery:function(e,t){var n=t.toJSON();return n.className=t.className,this._addCondition(e,"$notInQuery",n),this},matchesKeyInQuery:function(e,t,n){var r=n.toJSON();return r.className=n.className,this._addCondition(e,"$select",{key:t,query:r}),this},doesNotMatchKeyInQuery:function(e,t,n){var r=n.toJSON();return r.className=n.className,this._addCondition(e,"$dontSelect",{key:t,query:r}),this},_orQuery:function(e){var t=n.map(e,function(e){return e.toJSON().where});return this._where.$or=t,this},_quote:function(e){return"\\Q"+e.replace("\\E","\\E\\\\E\\Q")+"\\E"},contains:function(e,t){return this._addCondition(e,"$regex",this._quote(t)),this},startsWith:function(e,t){return this._addCondition(e,"$regex","^"+this._quote(t)),this},endsWith:function(e,t){return this._addCondition(e,"$regex",this._quote(t)+"$"),this},ascending:function(){return this._order=[],this.addAscending.apply(this,arguments)},addAscending:function(){var e=this;return this._order||(this._order=[]),t._arrayEach(arguments,function(t){Array.isArray(t)&&(t=t.join()),e._order=e._order.concat(t.replace(/\s/g,"").split(","))}),this},descending:function(){return this._order=[],this.addDescending.apply(this,arguments)},addDescending:function(){var e=this;return this._order||(this._order=[]),t._arrayEach(arguments,function(t){Array.isArray(t)&&(t=t.join()),e._order=e._order.concat(n.map(t.replace(/\s/g,"").split(","),function(e){return"-"+e}))}),this},near:function(e,n){return n instanceof t.GeoPoint||(n=new t.GeoPoint(n)),this._addCondition(e,"$nearSphere",n),this},withinRadians:function(e,t,n){return this.near(e,t),this._addCondition(e,"$maxDistance",n),this},withinMiles:function(e,t,n){return this.withinRadians(e,t,n/3958.8)},withinKilometers:function(e,t,n){return this.withinRadians(e,t,n/6371)},withinGeoBox:function(e,n,r){return n instanceof t.GeoPoint||(n=new t.GeoPoint(n)),r instanceof t.GeoPoint||(r=new t.GeoPoint(r)),this._addCondition(e,"$within",{$box:[n,r]}),this},include:function(){var e=this;return t._arrayEach(arguments,function(t){n.isArray(t)?e._include=e._include.concat(t):e._include.push(t)}),this},select:function(){var e=this;return this._select=this._select||[],t._arrayEach(arguments,function(t){n.isArray(t)?e._select=e._select.concat(t):e._select.push(t)}),this},each:function(e,r){if(r=r||{},this._order||this._skip||this._limit>=0){var i="Cannot iterate on a query with sort, skip, or limit.";return t.Promise.error(i)._thenRunCallbacks(r)}var s=(new t.Promise,new t.Query(this.objectClass));s._limit=r.batchSize||100,s._where=n.clone(this._where),s._include=n.clone(this._include),s.ascending("objectId");var o={};n.has(r,"useMasterKey")&&(o.useMasterKey=r.useMasterKey);var u=!1;return t.Promise._continueWhile(function(){return!u},function(){return s.find(o).then(function(n){var r=t.Promise.as();return t._.each(n,function(t){r=r.then(function(){return e(t)})}),r.then(function(){n.length>=s._limit?s.greaterThan("objectId",n[n.length-1].id):u=!0})})})._thenRunCallbacks(r)}}}(this),function(e){e.Parse=e.Parse||{};var t,n,r=e.Parse,i=r._,s=!1,o={authenticate:function(e){var n=this;FB.login(function(t){t.authResponse?e.success&&e.success(n,{id:t.authResponse.userID,access_token:t.authResponse.accessToken,expiration_date:(new Date(1e3*t.authResponse.expiresIn+(new Date).getTime())).toJSON()}):e.error&&e.error(n,t)},{scope:t})},restoreAuthentication:function(e){if(e){var t={userID:e.id,accessToken:e.access_token,expiresIn:(r._parseDate(e.expiration_date).getTime()-(new Date).getTime())/1e3},s=i.clone(n);s.authResponse=t,s.status=!1;var o=FB.getAuthResponse();o&&o.userID!==t.userID&&FB.logout(),FB.init(s)}return!0},getAuthType:function(){return"facebook"},deauthenticate:function(){this.restoreAuthentication(null)}};r.FacebookUtils={init:function(e){if("undefined"==typeof FB)throw"The Facebook JavaScript SDK must be loaded before calling init.";if(n=i.clone(e)||{},n.status&&"undefined"!=typeof console){var t=console.warn||console.log||function(){};t.call(console,"The 'status' flag passed into FB.init, when set to true, can interfere with Parse Facebook integration, so it has been suppressed. Please call FB.getLoginStatus() explicitly if you require this behavior.")}n.status=!1,FB.init(n),r.User._registerAuthenticationProvider(o),s=!0},isLinked:function(e){return e._isLinked("facebook")},logIn:function(e,n){if(!e||i.isString(e)){if(!s)throw"You must initialize FacebookUtils before calling logIn.";return t=e,r.User._logInWith("facebook",n)}var o=i.clone(n)||{};return o.authData=e,r.User._logInWith("facebook",o)},link:function(e,n,r){if(!n||i.isString(n)){if(!s)throw"You must initialize FacebookUtils before calling link.";return t=n,e._linkWith("facebook",r)}var o=i.clone(r)||{};return o.authData=n,e._linkWith("facebook",o)},unlink:function(e,t){if(!s)throw"You must initialize FacebookUtils before calling unlink.";return e._unlinkFrom("facebook",t)}}}(this),function(e){e.Parse=e.Parse||{};var t=e.Parse,n=t._;t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl")};var r=/^[#\/]/,i=/msie [\w.]+/;t.History.started=!1,n.extend(t.History.prototype,t.Events,{interval:50,getHash:function(e){var t=e?e.location:window.location,n=t.href.match(/#(.*)$/);return n?n[1]:""},getFragment:function(e,n){if(t._isNullOrUndefined(e))if(this._hasPushState||n){e=window.location.pathname;var i=window.location.search;i&&(e+=i)}else e=this.getHash();return e.indexOf(this.options.root)||(e=e.substr(this.options.root.length)),e.replace(r,"")},start:function(e){if(t.History.started)throw new Error("Parse.history has already been started");t.History.started=!0,this.options=n.extend({},{root:"/"},this.options,e),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var s=this.getFragment(),o=document.documentMode,u=i.exec(navigator.userAgent.toLowerCase())&&(!o||7>=o);u&&(this.iframe=t.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(s)),this._hasPushState?t.$(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!u?t.$(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=window.setInterval(this.checkUrl,this.interval)),this.fragment=s;var a=window.location,f=a.pathname===this.options.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!f?(this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&f&&a.hash&&(this.fragment=this.getHash().replace(r,""),window.history.replaceState({},document.title,a.protocol+"//"+a.host+this.options.root+this.fragment)),this.options.silent?void 0:this.loadUrl())},stop:function(){t.$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),window.clearInterval(this._checkUrlInterval),t.History.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),void (this.loadUrl()||this.loadUrl(this.getHash())))},loadUrl:function(e){var t=this.fragment=this.getFragment(e),r=n.any(this.handlers,function(e){return e.route.test(t)?(e.callback(t),!0):void 0});return r},navigate:function(e,n){if(!t.History.started)return!1;n&&n!==!0||(n={trigger:n});var i=(e||"").replace(r,"");if(this.fragment!==i){if(this._hasPushState){0!==i.indexOf(this.options.root)&&(i=this.options.root+i),this.fragment=i;var s=n.replace?"replaceState":"pushState";window.history[s]({},document.title,i)}else this._wantsHashChange?(this.fragment=i,this._updateHash(window.location,i,n.replace),this.iframe&&i!==this.getFragment(this.getHash(this.iframe))&&(n.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,i,n.replace))):window.location.assign(this.options.root+e);n.trigger&&this.loadUrl(e)}},_updateHash:function(e,t,n){if(n){var r=e.toString().replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash=t}})}(this),function(e){e.Parse=e.Parse||{};var t=e.Parse,n=t._;t.Router=function(e){e=e||{},e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)};var r=/:\w+/g,i=/\*\w+/g,s=/[\-\[\]{}()+?.,\\\^\$\|#\s]/g;n.extend(t.Router.prototype,t.Events,{initialize:function(){},route:function(e,r,i){return t.history=t.history||new t.History,n.isRegExp(e)||(e=this._routeToRegExp(e)),i||(i=this[r]),t.history.route(e,n.bind(function(n){var s=this._extractParameters(e,n);i&&i.apply(this,s),this.trigger.apply(this,["route:"+r].concat(s)),t.history.trigger("route",this,r,s)},this)),this},navigate:function(e,n){t.history.navigate(e,n)},_bindRoutes:function(){if(this.routes){var e=[];for(var t in this.routes)this.routes.hasOwnProperty(t)&&e.unshift([t,this.routes[t]]);for(var n=0,r=e.length;r>n;n++)this.route(e[n][0],e[n][1],this[e[n][1]])}},_routeToRegExp:function(e){return e=e.replace(s,"\\$&").replace(r,"([^/]+)").replace(i,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}}),t.Router.extend=t._extend}(this),function(e){e.Parse=e.Parse||{};var t=e.Parse,n=t._;t.Cloud=t.Cloud||{},n.extend(t.Cloud,{run:function(e,n,r){r=r||{};var i=t._request({route:"functions",className:e,method:"POST",useMasterKey:r.useMasterKey,data:t._encode(n,null,!0)});return i.then(function(e){return t._decode(null,e).result})._thenRunCallbacks(r)}})}(this),function(e){e.Parse=e.Parse||{};var t=e.Parse;t.Installation=t.Object.extend("_Installation"),t.Push=t.Push||{},t.Push.send=function(e,n){if(n=n||{},e.where&&(e.where=e.where.toJSON().where),e.push_time&&(e.push_time=e.push_time.toJSON()),e.expiration_time&&(e.expiration_time=e.expiration_time.toJSON()),e.expiration_time&&e.expiration_interval)throw"Both expiration_time and expiration_interval can't be set";var r=t._request({route:"push",method:"POST",data:e,useMasterKey:n.useMasterKey});return r._thenRunCallbacks(n)}}(this),typeof define!="undefined"?define("libs/parse",[],function(){return Parse}):typeof exports!="undefined"?exports.Parse=Parse:window.Parse=Parse}(),define("happy/_libs/mout/lang/toString",[],function(){function e(e){return e==null?"":e.toString()}return e}),define("happy/_libs/mout/string/replaceAccents",["../lang/toString"],function(e){function t(t){return t=e(t),t.search(/[\xC0-\xFF]/g)>-1&&(t=t.replace(/[\xC0-\xC5]/g,"A").replace(/[\xC6]/g,"AE").replace(/[\xC7]/g,"C").replace(/[\xC8-\xCB]/g,"E").replace(/[\xCC-\xCF]/g,"I").replace(/[\xD0]/g,"D").replace(/[\xD1]/g,"N").replace(/[\xD2-\xD6\xD8]/g,"O").replace(/[\xD9-\xDC]/g,"U").replace(/[\xDD]/g,"Y").replace(/[\xDE]/g,"P").replace(/[\xE0-\xE5]/g,"a").replace(/[\xE6]/g,"ae").replace(/[\xE7]/g,"c").replace(/[\xE8-\xEB]/g,"e").replace(/[\xEC-\xEF]/g,"i").replace(/[\xF1]/g,"n").replace(/[\xF2-\xF6\xF8]/g,"o").replace(/[\xF9-\xFC]/g,"u").replace(/[\xFE]/g,"p").replace(/[\xFD\xFF]/g,"y")),t}return t}),define("happy/_libs/mout/string/removeNonWord",["../lang/toString"],function(e){function t(t){return t=e(t),t.replace(/[^0-9a-zA-Z\xC0-\xFF \-_]/g,"")}return t}),define("happy/_libs/mout/string/upperCase",["../lang/toString"],function(e){function t(t){return t=e(t),t.toUpperCase()}return t}),define("happy/_libs/mout/string/lowerCase",["../lang/toString"],function(e){function t(t){return t=e(t),t.toLowerCase()}return t}),define("happy/_libs/mout/string/camelCase",["../lang/toString","./replaceAccents","./removeNonWord","./upperCase","./lowerCase"],function(e,t,n,r,i){function s(s){return s=e(s),s=t(s),s=n(s).replace(/[\-_]/g," ").replace(/\s[a-z]/g,r).replace(/\s+/g,"").replace(/^[A-Z]/g,i),s}return s}),function(e){function t(e,t,n,r,i){this._listener=t,this._isOnce=n,this.context=r,this._signal=e,this._priority=i||0}function n(e,t){if(typeof e!="function")throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function r(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){r.prototype.dispatch.apply(e,arguments)}}t.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&!!this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},r.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,n,r,i){var s=this._indexOfListener(e,r),o;if(s!==-1){o=this._bindings[s];if(o.isOnce()!==n)throw new Error("You cannot add"+(n?"":"Once")+"() then add"+(n?"Once":"")+"() the same listener without removing the relationship first.")}else o=new t(this,e,n,r,i),this._addBinding(o);return this.memorize&&this._prevParams&&o.execute(this._prevParams),o},_addBinding:function(e){var t=this._bindings.length;do--t;while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){var n=this._bindings.length,r;while(n--){r=this._bindings[n];if(r._listener===e&&r.context===t)return n}return-1},has:function(e,t){return this._indexOfListener(e,t)!==-1},add:function(e,t,r){return n(e,"add"),this._registerListener(e,!1,t,r)},addOnce:function(e,t,r){return n(e,"addOnce"),this._registerListener(e,!0,t,r)},remove:function(e,t){n(e,"remove");var r=this._indexOfListener(e,t);return r!==-1&&(this._bindings[r]._destroy(),this._bindings.splice(r,1)),e},removeAll:function(){var e=this._bindings.length;while(e--)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(!this.active)return;var t=Array.prototype.slice.call(arguments),n=this._bindings.length,r;this.memorize&&(this._prevParams=t);if(!n)return;r=this._bindings.slice(),this._shouldPropagate=!0;do n--;while(r[n]&&this._shouldPropagate&&r[n].execute(t)!==!1)},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var i=r;i.Signal=r,typeof define=="function"&&define.amd?define("happy/_libs/signals",[],function(){return i}):typeof module!="undefined"&&module.exports?module.exports=i:e.signals=i}(this),define("happy/polyfill/console",[],function(){return window.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}}}),define("happy/_libs/mout/array/forEach",[],function(){function e(e,t,n){if(e==null)return;var r=-1,i=e.length;while(++r<i)if(t.call(n,e[r],r,e)===!1)break}return e}),define("happy/_libs/mout/array/indexOf",[],function(){function e(e,t,n){n=n||0;if(e==null)return-1;var r=e.length,i=n<0?r+n:n;while(i<r){if(e[i]===t)return i;i++}return-1}return e}),define("happy/_libs/mout/array/combine",["./indexOf"],function(e){function t(t,n){if(n==null)return t;var r=-1,i=n.length;while(++r<i)e(t,n[r])===-1&&t.push(n[r]);return t}return t}),define("happy/_libs/mout/string/pascalCase",["../lang/toString","./camelCase","./upperCase"],function(e,t,n){function r(r){return r=e(r),t(r).replace(/^[a-z]/,n)}return r}),define("happy/utils/Vendor",["../polyfill/console","../_libs/mout/array/forEach","../_libs/mout/array/combine","../_libs/mout/string/pascalCase"],function(e,t,n,r){var i=["WebKit","Moz","O","Ms"],s=[],o=[];t(i,function(e){s.push(r(e)),o.push(e.toLowerCase())});var u=n(s,o),a=function(){var t=this,n=function(t,n){if(!t)return;var i=r(t);n=n||window;var s=t,o=n[s];if(typeof o=="undefined")for(var a=0;a<u.length;a++){s=u[a]+i,o=n[s];if(typeof o!="undefined")break}if(typeof o=="undefined"){e.log(t+" is not implemented.");return}return{name:s,context:n}},i=function(e,t){var r=n(e,t);if(!r)return;return function(){r.context[r.name].apply(r.context,arguments)}},s=function(e,t){var r=n(e,t);if(!r)return;return r.context[r.name]},o=function(e,t){var r=n(e,t);if(!r)return;return r.name};Object.defineProperty(t,"validateMethod",{value:i}),Object.defineProperty(t,"validateConstructor",{value:s}),Object.defineProperty(t,"validateName",{value:o})};return a}),define("Tree",["happy/_libs/mout/string/camelCase","happy/_libs/signals","happy/utils/Vendor"],function(e,t,n){var r=new n,i=r.validateMethod("requestAnimationFrame"),s=function(){var n=this,r={},s={},o,u,a,f,l,c,h=function(){o=new t,u=new t,a=new t,f=new t,l=new t,o.add(v),u.add(v),a.add(v),f.add(v),l.add(v),p()},p=function(){i(p);for(var e in r){if(typeof r[e]=="undefined"||!r[e]){delete r[e];continue}s[e]?(r[e]._x!=s[e]._x||r[e]._y!=s[e]._y)&&l.dispatch(e,r[e]._x,r[e]._y):(o.dispatch(e),l.dispatch(e,r[e]._x,r[e]._y))}for(var e in s){if(typeof s[e]=="undefined"||!s[e]){delete s[e];continue}if(!r[e]){for(var t in s[e].inputs)f.dispatch({to:e+"."+t,from:s[e].inputs[t]});for(var n in r)for(var t in r[n].inputs){var c=r[n].inputs[t];c==e+".out"&&(delete r[n].inputs[t],f.dispatch({to:n+"."+t,from:e+".out"}))}u.dispatch(e)}}for(var e in r)if(!s[e])for(var t in r[e].inputs)a.dispatch({to:e+"."+t,from:r[e].inputs[t]});else{for(var t in r[e].inputs)s[e].inputs||(s[e].inputs={}),s[e].inputs[t]?JSON.stringify(s[e].inputs[t])!=JSON.stringify(r[e].inputs[t])&&(f.dispatch({to:e+"."+t,from:s[e].inputs[t]}),a.dispatch({to:e+"."+t,from:r[e].inputs[t]})):a.dispatch({to:e+"."+t,from:r[e].inputs[t]});for(var t in s[e].inputs)r[e].inputs||(r[e].inputs={}),r[e].inputs[t]||f.dispatch({to:e+"."+t,from:s[e].inputs[t]})}s=JSON.parse(JSON.stringify(r))},d=function(t){var n=e(t),i=n,s=1;while(r[i])s++,i=n+s;return s>1?i:n},v=function(){localStorage.setItem("QuirkbotAutoSaveTree",JSON.stringify(r))},m=function(){var e=localStorage.getItem("QuirkbotAutoSaveTree");r=e?JSON.parse(e):{}},g=function(){return r},y=function(e){e&&(r=e)},b=function(){return o},w=function(){return u},E=function(){return a},S=function(){return f},x=function(){return l};Object.defineProperty(n,"data",{get:g,set:y}),Object.defineProperty(n,"nodeAdded",{get:b}),Object.defineProperty(n,"nodeRemoved",{get:w}),Object.defineProperty(n,"connectionAdded",{get:E}),Object.defineProperty(n,"connectionRemoved",{get:S}),Object.defineProperty(n,"nodePositionUpdated",{get:x}),Object.defineProperty(n,"generateSafeNodeId",{value:d}),Object.defineProperty(n,"save",{value:v}),Object.defineProperty(n,"load",{value:m}),h()},o=new s;return o}),define("happy/utils/Network",[],function(){var e=function(){var e=this,t=function(e){if(!e)return;if(!e.url){e.onError&&e.onError.apply(e.context,["No url was provided."]);return}e.method=e.method||"GET",e.headers=e.headers||{};var t;if(window.XMLHttpRequest)t=new XMLHttpRequest;else if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(n){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(n){}}if(!t){e.onError&&e.onError.apply(e.context,["Couldn't create request"]);return}t.onload=function(){t.status===200?e.onSuccess&&e.onSuccess.apply(e.context,[t]):e.onError&&e.onError.apply(e.context,[t])},t.onerror=function(){e.onError&&e.onError.apply(e.context,[t])},t.onabort=function(){e.onError&&e.onError.apply(e.context,[t])},t.ontimeout=function(){e.onError&&e.onError.apply(e.context,[t])},e.responseType&&(t.responseType=e.responseType),t.open(e.method,e.url);for(key in e.headers)t.setRequestHeader(key,e.headers[key]);t.send(e.data)};Object.defineProperty(e,"ajax",{value:t})};return e}),define("Promise",[],function(){return!function(){var e,t,n,r;!function(){var i={},s={};e=function(e,t,n){i[e]={deps:t,callback:n}},r=n=t=function(e){function n(t){if("."!==t.charAt(0))return t;for(var n=t.split("/"),r=e.split("/").slice(0,-1),i=0,s=n.length;s>i;i++){var o=n[i];if(".."===o)r.pop();else{if("."===o)continue;r.push(o)}}return r.join("/")}if(r._eak_seen=i,s[e])return s[e];if(s[e]={},!i[e])throw new Error("Could not find module "+e);for(var o,u=i[e],a=u.deps,l=u.callback,c=[],h=0,p=a.length;p>h;h++)"exports"===a[h]?c.push(o={}):c.push(t(n(a[h])));var v=l.apply(this,c);return s[e]=o||v}}(),e("promise/all",["./utils","exports"],function(e,t){function n(e){var t=this;if(!r(e))throw new TypeError("You must pass an array to all.");return new t(function(t,n){function r(e){return function(t){s(e,t)}}function s(e,n){u[e]=n,0===--f&&t(u)}var o,u=[],f=e.length;0===f&&t([]);for(var l=0;l<e.length;l++)o=e[l],o&&i(o.then)?o.then(r(l),n):s(l,o)})}var r=e.isArray,i=e.isFunction;t.all=n}),e("promise/asap",["exports"],function(e){function t(){return function(){process.nextTick(i)}}function n(){var e=0,t=new a(i),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function r(){return function(){f.setTimeout(i,1)}}function i(){for(var e=0;e<l.length;e++){var t=l[e],n=t[0],r=t[1];n(r)}l=[]}function s(e,t){var n=l.push([e,t]);1===n&&o()}var o,u="undefined"!=typeof window?window:{},a=u.MutationObserver||u.WebKitMutationObserver,f="undefined"!=typeof global?global:this,l=[];o="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?t():a?n():r(),e.asap=s}),e("promise/cast",["exports"],function(e){function t(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=this;return new t(function(t){t(e)})}e.cast=t}),e("promise/config",["exports"],function(e){function t(e,t){return 2!==arguments.length?n[e]:(n[e]=t,void 0)}var n={instrument:!1};e.config=n,e.configure=t}),e("promise/polyfill",["./promise","./utils","exports"],function(e,t,n){function r(){var e="Promise"in window&&"cast"in window.Promise&&"resolve"in window.Promise&&"reject"in window.Promise&&"all"in window.Promise&&"race"in window.Promise&&function(){var e;return new window.Promise(function(t){e=t}),s(e)}();e||(window.Promise=i)}var i=e.Promise,s=t.isFunction;n.polyfill=r}),e("promise/promise",["./config","./utils","./cast","./all","./race","./resolve","./reject","./asap","exports"],function(e,t,n,r,i,s,o,u,a){function f(e){if(!S(e))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof f))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],l(e,this)}function l(e,t){function n(e){v(t,e)}function r(e){g(t,e)}try{e(n,r)}catch(i){r(i)}}function c(e,t,n,r){var i,s,o,u,a=S(n);if(a)try{i=n(r),o=!0}catch(f){u=!0,s=f}else i=r,o=!0;d(t,i)||(a&&o?v(t,i):u?g(t,s):e===M?v(t,i):e===_&&g(t,i))}function h(e,t,n,r){var i=e._subscribers,s=i.length;i[s]=t,i[s+M]=n,i[s+_]=r}function p(e,t){for(var n,r,i=e._subscribers,s=e._detail,o=0;o<i.length;o+=3)n=i[o],r=i[o+t],c(t,n,r,s);e._subscribers=null}function d(e,t){var n,r=null;try{if(e===t)throw new TypeError("A promises callback cannot return that same promise.");if(E(t)&&(r=t.then,S(r)))return r.call(t,function(r){return n?!0:(n=!0,t!==r?v(e,r):m(e,r),void 0)},function(t){return n?!0:(n=!0,g(e,t),void 0)}),!0}catch(i){return n?!0:(g(e,i),!0)}return!1}function v(e,t){e===t?m(e,t):d(e,t)||m(e,t)}function m(e,t){e._state===A&&(e._state=O,e._detail=t,w.async(y,e))}function g(e,t){e._state===A&&(e._state=O,e._detail=t,w.async(b,e))}function y(e){p(e,e._state=M)}function b(e){p(e,e._state=_)}var w=e.config,E=(e.configure,t.objectOrFunction),S=t.isFunction,x=(t.now,n.cast),T=r.all,N=i.race,C=s.resolve,k=o.reject,L=u.asap;w.async=L;var A=void 0,O=0,M=1,_=2;f.prototype={constructor:f,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(e,t){var n=this,r=new this.constructor(function(){});if(this._state){var i=arguments;w.async(function(){c(n._state,r,i[n._state-1],n._detail)})}else h(this,r,e,t);return r},"catch":function(e){return this.then(null,e)}},f.all=T,f.cast=x,f.race=N,f.resolve=C,f.reject=k,a.Promise=f}),e("promise/race",["./utils","exports"],function(e,t){function n(e){var t=this;if(!r(e))throw new TypeError("You must pass an array to race.");return new t(function(t,n){for(var r,i=0;i<e.length;i++)r=e[i],r&&"function"==typeof r.then?r.then(t,n):t(r)})}var r=e.isArray;t.race=n}),e("promise/reject",["exports"],function(e){function t(e){var t=this;return new t(function(t,n){n(e)})}e.reject=t}),e("promise/resolve",["exports"],function(e){function t(e){var t=this;return new t(function(t){t(e)})}e.resolve=t}),e("promise/utils",["exports"],function(e){function t(e){return n(e)||"object"==typeof e&&null!==e}function n(e){return"function"==typeof e}function r(e){return"[object Array]"===Object.prototype.toString.call(e)}var i=Date.now||function(){return(new Date).getTime()};e.objectOrFunction=t,e.isFunction=n,e.isArray=r,e.now=i}),t("promise/polyfill").polyfill()}(),Promise}),define("Definitions",["happy/utils/Network","Promise"],function(e,t){var n=new e,r=function(){var e=this,r={},i=function(e){return new t(function(t,n){o(e).then(function(e){return s(e)}).then(function(e){r=e,t(e)}).catch(function(e){n(e)})})},s=function(e){var n=[];for(var r in e)(function(r){var i=new t(function(t,n){o(e[r]).then(function(n){n.type=r,e[r]=n,t(n)}).catch(function(e){n(e)})});n.push(i)})(r);return new t(function(r,i){t.all(n).then(function(){r(e)}).catch(function(e){i(e)})})},o=function(e){return new t(function(t,r){n.ajax({url:e,onSuccess:function(e){t(JSON.parse(e.responseText))},onError:r})})},u=function(){return r};Object.defineProperty(e,"data",{get:u}),Object.defineProperty(e,"load",{value:i})},i=new r;return i}),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){if(e instanceof x)return e;if(!(this instanceof x))return new x(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.5.1";var T=x.each=x.forEach=function(e,t,r){if(e==null)return;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return e==null?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r.push(t.call(n,e,i,s))}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},x.filter=x.select=function(e,t,n){var r=[];return e==null?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&r.push(e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return e==null?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return e==null?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};x.contains=x.include=function(e,t){return e==null?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?void 0:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-Infinity;var r={computed:-Infinity,value:-Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return Infinity;var r={computed:Infinity,value:Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t==null?x.identity:t);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=n==null?x.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return e==null?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,0,t):e[0]},x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},x.last=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return t&&x.every(e,x.isArray)?a.apply(n,e):(T(e,function(e){x.isArray(e)||x.isArguments(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n)};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){if(t?!r||o[o.length-1]!==n:!x.contains(o,n))o.push(n),s.push(e[r])}),s},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){var e=x.max(x.pluck(arguments,"length").concat(0)),t=new Array(e);for(var n=0;n<e;n++)t[n]=x.pluck(arguments,""+n);return t},x.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var O=function(){};x.bind=function(e,t){var n,r;if(S&&e.bind===S)return S.apply(e,u.call(arguments,1));if(!x.isFunction(e))throw new TypeError;return n=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=e.prototype;var i=new O;O.prototype=null;var s=e.apply(i,n.concat(u.call(arguments)));return Object(s)===s?s:i}return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);if(t.length===0)throw new Error("bindAll must be passed function names");return T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:new Date,o=null,s=e.apply(r,i)};return function(){var f=new Date;!u&&n.leading===!1&&(u=f);var l=t-(f-u);return r=this,i=arguments,l<=0?(clearTimeout(o),o=null,u=f,s=e.apply(r,i)):!o&&n.trailing!==!1&&(o=setTimeout(a,l)),s}},x.debounce=function(e,t,n){var r,i=null;return function(){var s=this,o=arguments,u=function(){i=null,n||(r=e.apply(s,o))},a=n&&!i;return clearTimeout(i),i=setTimeout(u,t),a&&(r=e.apply(s,o)),r}},x.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&t.push(n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]===void 0&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;var o=e.constructor,u=t.constructor;if(o!==u&&!(x.isFunction(o)&&o instanceof o&&x.isFunction(u)&&u instanceof u))return!1;n.push(e),r.push(t);var a=0,l=!0;if(i=="[object Array]"){a=e.length,l=a==t.length;if(l)while(a--)if(!(l=M(e[a],t[a],n,r)))break}else{for(var c in e)if(x.has(e,c)){a++;if(!(l=x.has(t,c)&&M(e[c],t[c],n,r)))break}if(l){for(c in t)if(x.has(t,c)&&!(a--))break;l=!a}}return n.pop(),r.pop(),l};x.isEqual=function(e,t){return M(e,t,[],[])},x.isEmpty=function(e){if(e==null)return!0;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&e.nodeType===1},x.isArray=w||function(e){return f.call(e)=="[object Array]"},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),typeof /./!="function"&&(x.isFunction=function(e){return typeof e=="function"}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||f.call(e)=="[object Boolean]"},x.isNull=function(e){return e===null},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){var r=Array(Math.max(0,e));for(var i=0;i<e;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};_.unescape=x.invert(_.escape);var D={escape:new RegExp("["+x.keys(_.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(_.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return t==null?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),x.result=function(e,t){if(e==null)return void 0;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(x,e))}})};var P=0;x.uniqueId=function(e){var t=++P+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(j,function(e){return"\\"+B[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var F=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],F.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this);var Backbone=Backbone||{};(function(){var e=[],t=e.slice,n=/\s+/,r=function(e,t,n){var r,i=-1,s=t.length;switch(n.length){case 0:while(++i<s)(r=t[i]).callback.call(r.ctx);return;case 1:while(++i<s)(r=t[i]).callback.call(r.ctx,n[0]);return;case 2:while(++i<s)(r=t[i]).callback.call(r.ctx,n[0],n[1]);return;case 3:while(++i<s)(r=t[i]).callback.call(r.ctx,n[0],n[1],n[2]);return;default:while(++i<s)(r=t[i]).callback.apply(r.ctx,n)}},i=Backbone.Events={on:function(e,t,n){this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){var r=this,i=_.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n),this},off:function(e,t,n){var r,i,s,o,u,a,f,l;if(!this._events)return this;if(!e&&!t&&!n)return this._events={},this;o=e?[e]:_.keys(this._events);for(u=0,a=o.length;u<a;u++){e=o[u];if(r=this._events[e]){s=[];if(t||n)for(f=0,l=r.length;f<l;f++)i=r[f],(t&&t!==(i.callback._callback||i.callback)||n&&n!==i.context)&&s.push(i);this._events[e]=s}}return this},trigger:function(e){if(!this._events)return this;var n=t.call(arguments,1),i=this._events[e],s=this._events.all;return i&&r(this,i,n),s&&r(this,s,arguments),this},listenTo:function(e,t,n){var r=this._listeners||(this._listeners={}),i=e._listenerId||(e._listenerId=_.uniqueId("l"));return r[i]=e,e.on(t,n||this,this),this},stopListening:function(e,t,n){var r=this._listeners;if(!r)return;if(e)e.off(t,n,this),!t&&!n&&delete r[e._listenerId];else{for(var i in r)r[i].off(null,null,this);this._listeners={}}return this}};i.bind=i.on,i.unbind=i.off,typeof exports!="undefined"&&(typeof module!="undefined"&&module.exports&&(exports=module.exports=i),exports.Backbone=exports.Backbone||Backbone)})(),function(){function i(n,r){var i=(new Date).getTime(),s=Math.max(0,16-(i-t)),o=e.setTimeout(function(){n(i+s)},s);return t=i+s,o}var e=this,t=0,n=["ms","moz","webkit","o"];if(typeof exports!="undefined"){typeof module!="undefined"&&module.exports&&(exports=module.exports=i),exports.requestAnimationFrame=i;return}for(var r=0;r<n.length&&!e.requestAnimationFrame;++r)e.requestAnimationFrame=e[n[r]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[n[r]+"CancelAnimationFrame"]||e[n[r]+"CancelRequestAnimationFrame"];e.requestAnimationFrame||(e.requestAnimationFrame=i),e.cancelAnimationFrame||(e.cancelAnimationFrame=function(e){clearTimeout(e)})}(),function(){function O(){var e=document.body.getBoundingClientRect(),t=this.width=e.width,n=this.height=e.height;this.renderer.setSize(t,n,this.ratio),this.trigger(m.Events.resize,t,n)}function M(){return(e.performance&&e.performance.now?e.performance:Date).now()}var e=this,t=e.Two||{},n=Math.sin,r=Math.cos,i=Math.atan2,s=Math.sqrt,o=Math.round,u=Math.abs,a=Math.PI,f=a*2,l=a/2,c=Math.pow,h=Math.min,p=Math.max,d=0,v={hasEventListeners:_.isFunction(e.addEventListener),bind:function(e,t,n,r){return this.hasEventListeners?e.addEventListener(t,n,!!r):e.attachEvent("on"+t,n),this},unbind:function(e,t,n,r){return this.hasEventListeners?e.removeEventListeners(t,n,!!r):e.detachEvent("on"+t,n),this}},m=e.Two=function(t){var n=_.defaults(t||{},{fullscreen:!1,width:640,height:480,type:m.Types.svg,autostart:!1});_.each(n,function(e,t){if(t==="fullscreen"||t==="width"||t==="height"||t==="autostart")return;this[t]=e},this),_.isElement(n.domElement)&&(this.type=m.Types[n.domElement.tagName.toLowerCase()]),this.renderer=new m[this.type](this),m.Utils.setPlaying.call(this,n.autostart),this.frameCount=0;if(n.fullscreen){var r=_.bind(O,this);_.extend(document.body.style,{overflow:"hidden",margin:0,padding:0,top:0,left:0,right:0,bottom:0,position:"fixed"}),_.extend(this.renderer.domElement.style,{display:"block",top:0,left:0,right:0,bottom:0,position:"fixed"}),v.bind(e,"resize",r),r()}else _.isElement(n.domElement)||(this.renderer.setSize(n.width,n.height,this.ratio),this.width=n.width,this.height=n.height);this.scene=this.renderer.scene,m.Instances.push(this)};_.extend(m,{Array:e.Float32Array||Array,Types:{webgl:"WebGLRenderer",svg:"SVGRenderer",canvas:"CanvasRenderer"},Version:"v0.4.0",Identifier:"two_",Properties:{hierarchy:"hierarchy",demotion:"demotion"},Events:{play:"play",pause:"pause",update:"update",render:"render",resize:"resize",change:"change",remove:"remove",insert:"insert"},Commands:{move:"M",line:"L",curve:"C",close:"Z"},Resolution:8,Instances:[],noConflict:function(){return e.Two=t,this},uniqueId:function(){var e=d;return d++,e},Utils:{release:function(e){if(!_.isObject(e))return;_.isFunction(e.unbind)&&e.unbind(),e.vertices&&(_.isFunction(e.vertices.unbind)&&e.vertices.unbind(),_.each(e.vertices,function(e){_.isFunction(e.unbind)&&e.unbind()})),e.children&&_.each(e.children,function(e){m.Utils.release(e)})},Curve:{CollinearityEpsilon:c(10,-30),RecursionLimit:16,CuspLimit:0,Tolerance:{distance:.25,angle:0,epsilon:.01},abscissas:[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],weights:[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]]},devicePixelRatio:e.devicePixelRatio||1,getBackingStoreRatio:function(e){return e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1},getRatio:function(e){return m.Utils.devicePixelRatio/N(e)},setPlaying:function(e){return this.playing=!!e,this},getComputedMatrix:function(e,t){t=t&&t.identity()||new m.Matrix;var n=e,r=[];while(n&&n._matrix)r.push(n._matrix),n=n.parent;return r.reverse(),_.each(r,function(e){var n=e.elements;t.multiply(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9])}),t},deltaTransformPoint:function(e,t,n){var r=t*e.a+n*e.c+0,i=t*e.b+n*e.d+0;return new m.Vector(r,i)},decomposeMatrix:function(e){var t=m.Utils.deltaTransformPoint(e,0,1),n=m.Utils.deltaTransformPoint(e,1,0),r=180/Math.PI*Math.atan2(t.y,t.x)-90,i=180/Math.PI*Math.atan2(n.y,n.x);return{translateX:e.e,translateY:e.f,scaleX:Math.sqrt(e.a*e.a+e.b*e.b),scaleY:Math.sqrt(e.c*e.c+e.d*e.d),skewX:r,skewY:i,rotation:r}},applySvgAttributes:function(e,t){var n={},r={},i,s,o,u;if(getComputedStyle){var a=getComputedStyle(e);i=a.length;while(i--)s=a[i],o=a[s],o!==undefined&&(r[s]=o)}i=e.attributes.length;while(i--)u=e.attributes[i],n[u.nodeName]=u.value;_.isUndefined(r.opacity)||(r["stroke-opacity"]=r.opacity,r["fill-opacity"]=r.opacity),_.extend(r,n),r.visible=!_.isUndefined(r.display)||r.display!=="none"||_.isUndefined(r.visibility)&&r.visibility==="hidden";for(s in r){o=r[s];switch(s){case"transform":if(o==="none")break;var f=e.getCTM();if(f===null)break;var l=m.Utils.decomposeMatrix(e.getCTM());t.translation.set(l.translateX,l.translateY),t.rotation=l.rotation,t.scale=l.scaleX,r.x&&(t.translation.x=r.x),r.y&&(t.translation.y=r.y);break;case"visible":t.visible=o;break;case"stroke-linecap":t.cap=o;break;case"stroke-linejoin":t.join=o;break;case"stroke-miterlimit":t.miter=o;break;case"stroke-width":t.linewidth=parseFloat(o);break;case"stroke-opacity":case"fill-opacity":case"opacity":t.opacity=parseFloat(o);break;case"fill":case"stroke":t[s]=o==="none"?"transparent":o;break;case"id":t.id=o;break;case"class":t.classList=o.split(" ")}}return t},read:{svg:function(){return m.Utils.read.g.apply(this,arguments)},g:function(e){var t=new m.Group;m.Utils.applySvgAttributes(e,t);for(var n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n],s=i.nodeName;if(!s)return;var o=s.replace(/svg\:/ig,"").toLowerCase();if(o in m.Utils.read){var u=m.Utils.read[o].call(this,i);t.add(u)}}return t},polygon:function(e,t){var n=e.getAttribute("points"),r=[];n.replace(/(-?[\d\.?]+),(-?[\d\.?]+)/g,function(e,t,n){r.push(new m.Anchor(parseFloat(t),parseFloat(n)))});var i=(new m.Polygon(r,!t)).noStroke();return i.fill="black",m.Utils.applySvgAttributes(e,i)},polyline:function(e){return m.Utils.read.polygon(e,!0)},path:function(e){var t=e.getAttribute("d"),n=new m.Anchor,r,i,s=!1,o=!1,u=t.match(/[a-df-z][^a-df-z]*/ig),a=u.length-1;_.each(u.slice(0),function(e,t){var n=e[0],r=n.toLowerCase(),i=e.slice(1).trim().split(/[\s,]+|(?=\s?[+\-])/),s,o,a=[],f;t<=0&&(u=[]);switch(r){case"h":case"v":i.length>1&&(f=1);break;case"m":case"l":case"t":i.length>2&&(f=2);break;case"s":case"q":i.length>4&&(f=4);break;case"c":i.length>6&&(f=6);break;case"a":}if(f){for(var l=0,c=i.length,h=0;l<c;l+=f){var p=n;if(h>0)switch(n){case"m":p="l";break;case"M":p="L"}a.push([p].concat(i.slice(l,l+f)).join(" ")),h++}u=Array.prototype.concat.apply(u,a)}else u.push(e)});var f=_.flatten(_.map(u,function(e,t){var u,f,l,h=e[0],p=h.toLowerCase();i=e.slice(1).trim(),i=i.replace(/(-?\d+(?:\.\d*)?)[eE]([+\-]?\d+)/g,function(e,t,n){return parseFloat(t)*c(10,n)}),i=i.split(/[\s,]+|(?=\s?[+\-])/),o=h===p;var d,v,g,y,b,w,E,S,x;switch(p){case"z":t>=a?s=!0:(f=n.x,l=n.y,u=new m.Anchor(f,l,undefined,undefined,undefined,undefined,m.Commands.close));break;case"m":case"l":f=parseFloat(i[0]),l=parseFloat(i[1]),u=new m.Anchor(f,l,undefined,undefined,undefined,undefined,p==="m"?m.Commands.move:m.Commands.line),o&&u.addSelf(n),n=u;break;case"h":case"v":var T=p==="h"?"x":"y",N=T==="x"?"y":"x";u=new m.Anchor(undefined,undefined,undefined,undefined,undefined,undefined,m.Commands.line),u[T]=parseFloat(i[0]),u[N]=n[N],o&&(u[T]+=n[T]),n=u;break;case"c":case"s":d=n.x,v=n.y,r||(r=new m.Vector),p==="c"?(g=parseFloat(i[0]),y=parseFloat(i[1]),b=parseFloat(i[2]),w=parseFloat(i[3]),E=parseFloat(i[4]),S=parseFloat(i[5])):(x=A(n,r,o),g=x.x,y=x.y,b=parseFloat(i[0]),w=parseFloat(i[1]),E=parseFloat(i[2]),S=parseFloat(i[3])),o&&(g+=d,y+=v,b+=d,w+=v,E+=d,S+=v),_.isObject(n.controls)||m.Anchor.AppendCurveProperties(n),n.controls.right.set(g-n.x,y-n.y),u=new m.Anchor(E,S,b-E,w-S,undefined,undefined,m.Commands.curve),n=u,r=u.controls.left;break;case"t":case"q":d=n.x,v=n.y,r||(r=new m.Vector),r.isZero()?(g=d,y=v):(g=r.x,v=r.y),p==="q"?(b=parseFloat(i[0]),w=parseFloat(i[1]),E=parseFloat(i[1]),S=parseFloat(i[2])):(x=A(n,r,o),b=x.x,w=x.y,E=parseFloat(i[0]),S=parseFloat(i[1])),o&&(g+=d,y+=v,b+=d,w+=v,E+=d,S+=v),_.isObject(n.controls)||m.Anchor.AppendCurveProperties(n),n.controls.right.set(g-n.x,y-n.y),u=new m.Anchor(E,S,b-E,w-S,undefined,undefined,m.Commands.curve),n=u,r=u.controls.left;break;case"a":throw new m.Utils.Error("not yet able to interpret Elliptical Arcs.")}return u}));if(f.length<=1)return;f=_.compact(f);var l=(new m.Polygon(f,s,undefined,!0)).noStroke();return l.fill="black",m.Utils.applySvgAttributes(e,l)},circle:function(e){var t=parseFloat(e.getAttribute("cx")),i=parseFloat(e.getAttribute("cy")),s=parseFloat(e.getAttribute("r")),o=m.Resolution,u=_.map(_.range(o),function(e){var t=e/o,i=t*f,u=s*r(i),a=s*n(i);return new m.Anchor(u,a)},this),a=(new m.Polygon(u,!0,!0)).noStroke();return a.translation.set(t,i),a.fill="black",m.Utils.applySvgAttributes(e,a)},ellipse:function(e){var t=parseFloat(e.getAttribute("cx")),i=parseFloat(e.getAttribute("cy")),s=parseFloat(e.getAttribute("rx")),o=parseFloat(e.getAttribute("ry")),u=m.Resolution,a=_.map(_.range(u),function(e){var t=e/u,i=t*f,a=s*r(i),l=o*n(i);return new m.Anchor(a,l)},this),l=(new m.Polygon(a,!0,!0)).noStroke();return l.translation.set(t,i),l.fill="black",m.Utils.applySvgAttributes(e,l)},rect:function(e){var t=parseFloat(e.getAttribute("x")),n=parseFloat(e.getAttribute("y")),r=parseFloat(e.getAttribute("width")),i=parseFloat(e.getAttribute("height")),s=r/2,o=i/2,u=[new m.Anchor(s,o),new m.Anchor(-s,o),new m.Anchor(-s,-o),new m.Anchor(s,-o)],a=(new m.Polygon(u,!0)).noStroke();return a.translation.set(t+s,n+o),a.fill="black",m.Utils.applySvgAttributes(e,a)},line:function(e){var t=parseFloat(e.getAttribute("x1")),n=parseFloat(e.getAttribute("y1")),r=parseFloat(e.getAttribute("x2")),i=parseFloat(e.getAttribute("y2")),s=r-t,o=i-n,u=s/2,a=o/2,f=[new m.Anchor(-u,-a),new m.Anchor(u,a)],l=(new m.Polygon(f)).noFill();return l.translation.set(t+u,n+a),m.Utils.applySvgAttributes(e,l)}},subdivide:function(e,t,n,r,i,s,o,u,a){a=a||m.Utils.Curve.RecursionLimit;var f=a+1;return e===o&&t===u?[new m.Anchor(o,u)]:_.map(_.range(0,f),function(a){var l=a/f,c=C(l,e,n,i,o),h=C(l,t,r,s,u);return new m.Anchor(c,h)})},getPointOnCubicBezier:function(e,t,n,r,i){var s=1-e;return s*s*s*t+3*s*s*e*n+3*s*e*e*r+e*e*e*i},getCurveLength:function(e,t,n,r,i,o,u,a,f){if(e===n&&t===r&&i===u&&o===a){var l=u-e,c=a-t;return s(l*l+c*c)}var h=9*(n-i)+3*(u-e),p=6*(e+i)-12*n,d=3*(n-e),v=9*(r-o)+3*(a-t),g=6*(t+o)-12*r,y=3*(r-t),b=function(e){var t=(h*e+p)*e+d,n=(v*e+g)*e+y;return s(t*t+n*n)};return L(b,0,1,f||m.Utils.Curve.RecursionLimit)},integrate:function(e,t,n,r){var i=m.Utils.Curve.abscissas[r-2],s=m.Utils.Curve.weights[r-2],o=.5*(n-t),u=o+t,a=0,f=r+1>>1,l=r&1?s[a++]*e(u):0;while(a<f){var c=o*i[a];l+=s[a++]*(e(u+c)+e(u-c))}return o*l},getCurveFromPoints:function(e,t){var n=e.length,r=n-1;for(var i=0;i<n;i++){var s=e[i];_.isObject(s.controls)||m.Anchor.AppendCurveProperties(s);var o=t?T(i-1,n):p(i-1,0),u=t?T(i+1,n):h(i+1,r),a=e[o],f=s,l=e[u];w(a,f,l),f._command=i===0?m.Commands.move:m.Commands.curve,f.controls.left.x=_.isNumber(f.controls.left.x)?f.controls.left.x:f.x,f.controls.left.y=_.isNumber(f.controls.left.y)?f.controls.left.y:f.y,f.controls.right.x=_.isNumber(f.controls.right.x)?f.controls.right.x:f.x,f.controls.right.y=_.isNumber(f.controls.right.y)?f.controls.right.y:f.y}},getControlPoints:function(e,t,i){var s=b(e,t),o=b(i,t),u=g(e,t),f=g(i,t),c=(s+o)/2;return t.u=_.isObject(t.controls.left)?t.controls.left:new m.Vector(0,0),t.v=_.isObject(t.controls.right)?t.controls.right:new m.Vector(0,0),u<1e-4||f<1e-4?(t._relative||(t.controls.left.copy(t),t.controls.right.copy(t)),t):(u*=.33,f*=.33,o<s?c+=l:c-=l,t.controls.left.x=r(c)*u,t.controls.left.y=n(c)*u,c-=a,t.controls.right.x=r(c)*f,t.controls.right.y=n(c)*f,t._relative||(t.controls.left.x+=t.x,t.controls.left.y+=t.y,t.controls.right.x+=t.x,t.controls.right.y+=t.y),t)},getReflection:function(e,t,n){return new m.Vector(2*e.x-(t.x+e.x)-(n?e.x:0),2*e.y-(t.y+e.y)-(n?e.y:0))},angleBetween:function(e,t){var n,r;return arguments.length>=4?(n=arguments[0]-arguments[2],r=arguments[1]-arguments[3],i(r,n)):(n=e.x-t.x,r=e.y-t.y,i(r,n))},distanceBetweenSquared:function(e,t){var n=e.x-t.x,r=e.y-t.y;return n*n+r*r},distanceBetween:function(e,t){return s(y(e,t))},toFixed:function(e){return Math.floor(e*1e3)/1e3},mod:function(e,t){while(e<0)e+=t;return e%t},Collection:function(){Array.call(this),arguments.length>1?Array.prototype.push.apply(this,arguments):arguments[0]&&Array.isArray(arguments[0])&&Array.prototype.push.apply(this,arguments[0])},Error:function(e){this.name="two.js",this.message=e}}}),m.Utils.Error.prototype=new Error,m.Utils.Error.prototype.constructor=m.Utils.Error,m.Utils.Collection.prototype=new Array,m.Utils.Collection.constructor=m.Utils.Collection,_.extend(m.Utils.Collection.prototype,Backbone.Events,{pop:function(){var e=Array.prototype.pop.apply(this,arguments);return this.trigger(m.Events.remove,[e]),e},shift:function(){var e=Array.prototype.shift.apply(this,arguments);return this.trigger(m.Events.remove,[e]),e},push:function(){var e=Array.prototype.push.apply(this,arguments);return this.trigger(m.Events.insert,arguments),e},unshift:function(){var e=Array.prototype.unshift.apply(this,arguments);return this.trigger(m.Events.insert,arguments),e},splice:function(){var e=Array.prototype.splice.apply(this,arguments),t;return this.trigger(m.Events.remove,e),arguments.length>2&&(t=this.slice(arguments[0],arguments.length-2),this.trigger(m.Events.insert,t)),e}});var g=m.Utils.distanceBetween,y=m.Utils.distanceBetweenSquared,b=m.Utils.angleBetween,w=m.Utils.getControlPoints,E=m.Utils.getCurveFromPoints,S=m.Utils.solveSegmentIntersection,x=m.Utils.decoupleShapes,T=m.Utils.mod,N=m.Utils.getBackingStoreRatio,C=m.Utils.getPointOnCubicBezier,k=m.Utils.getCurveLength,L=m.Utils.integrate,A=m.Utils.getReflection;_.extend(m.prototype,Backbone.Events,{appendTo:function(e){return e.appendChild(this.renderer.domElement),this},play:function(){return m.Utils.setPlaying.call(this,!0),this.trigger(m.Events.play)},pause:function(){return this.playing=!1,this.trigger(m.Events.pause)},update:function(){var e=!!this._lastFrame,t=M();this.frameCount++,e&&(this.timeDelta=parseFloat((t-this._lastFrame).toFixed(3))),this._lastFrame=t;var n=this.width,r=this.height,i=this.renderer;return(n!==i.width||r!==i.height)&&i.setSize(n,r,this.ratio),this.trigger(m.Events.update,this.frameCount,this.timeDelta),this.render()},render:function(){return this.renderer.render(),this.trigger(m.Events.render,this.frameCount)},add:function(e){var t=e;return _.isArray(e)||(t=_.toArray(arguments)),this.scene.add(t),this},remove:function(e){var t=e;return _.isArray(e)||(t=_.toArray(arguments)),this.scene.remove(t),this},clear:function(){return this.scene.remove(_.toArray(this.scene.children)),this},makeLine:function(e,t,n,r){var i=n-e,s=r-t,o=i/2,u=s/2,a=[new m.Anchor(-o,-u),new m.Anchor(o,u)],f=(new m.Polygon(a)).noFill();return f.translation.set(e+o,t+u),this.scene.add(f),f},makeRectangle:function(e,t,n,r){var i=n/2,s=r/2,o=[new m.Anchor(-i,-s),new m.Anchor(i,-s),new m.Anchor(i,s),new m.Anchor(-i,s)],u=new m.Polygon(o,!0);return u.translation.set(e,t),this.scene.add(u),u},makeCircle:function(e,t,n){return this.makeEllipse(e,t,n,n)},makeEllipse:function(e,t,i,s){var o=m.Resolution,u=_.map(_.range(o),function(e){var t=e/o,u=t*f,a=i*r(u),l=s*n(u);return new m.Anchor(a,l)},this),a=new m.Polygon(u,!0,!0);return a.translation.set(e,t),this.scene.add(a),a},makeCurve:function(e){var t=arguments.length,n=e;if(!_.isArray(e)){n=[];for(var r=0;r<t;r+=2){var i=arguments[r];if(!_.isNumber(i))break;var s=arguments[r+1];n.push(new m.Anchor(i,s))}}var o=arguments[t-1],u=new m.Polygon(n,_.isBoolean(o)?!o:!undefined,!0),a=u.getBoundingClientRect(),f=a.left+a.width/2,l=a.top+a.height/2;return _.each(u.vertices,function(e){e.x-=f,e.y-=l}),u.translation.set(f,l),this.scene.add(u),u},makePolygon:function(e){var t=arguments.length,n=e;if(!_.isArray(e)){n=[];for(var r=0;r<t;r+=2){var i=arguments[r];if(!_.isNumber(i))break;var s=arguments[r+1];n.push(new m.Anchor(i,s))}}var o=arguments[t-1],u=new m.Polygon(n,_.isBoolean(o)?!o:!undefined),a=u.getBoundingClientRect();return u.center().translation.set(a.left+a.width/2,a.top+a.height/2),this.scene.add(u),u},makeGroup:function(e){var t=e;_.isArray(e)||(t=_.toArray(arguments));var n=new m.Group;return this.scene.add(n),n.add(t),n},interpret:function(e,t){var n=e.tagName.toLowerCase();if(n in m.Utils.read){var r=m.Utils.read[n].call(this,e);return t&&r instanceof m.Group?this.add(_.values(r.children)):this.add(r),r}return null}}),function(){requestAnimationFrame(arguments.callee),m.Instances.forEach(function(e){e.playing&&e.update()})}(),typeof define=="function"&&define.amd?define("libs/two",[],function(){return m}):typeof module!="undefined"&&module.exports&&(module.exports=m)}(),function(e){var t=e.Vector=function(e,t){this.x=e||0,this.y=t||0};_.extend(t,{zero:new e.Vector}),_.extend(t.prototype,Backbone.Events,{set:function(e,t){return this.x=e,this.y=t,this},copy:function(e){return this.x=e.x,this.y=e.y,this},clear:function(){return this.x=0,this.y=0,this},clone:function(){return new t(this.x,this.y)},add:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addSelf:function(e){return this.x+=e.x,this.y+=e.y,this},sub:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},subSelf:function(e){return this.x-=e.x,this.y-=e.y,this},multiplySelf:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){return e?(this.x/=e,this.y/=e):this.set(0,0),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSquared:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},setLength:function(e){return this.normalize().multiplyScalar(e)},equals:function(e){return this.distanceTo(e)<1e-4},lerp:function(e,t){var n=(e.x-this.x)*t+this.x,r=(e.y-this.y)*t+this.y;return this.set(n,r)},isZero:function(){return this.length()<1e-4},toString:function(){return this.x+","+this.y},toObject:function(){return{x:this.x,y:this.y}}});var n={set:function(t,n){return this._x=t,this._y=n,this.trigger(e.Events.change)},copy:function(t){return this._x=t.x,this._y=t.y,this.trigger(e.Events.change)},clear:function(){return this._x=0,this._y=0,this.trigger(e.Events.change)},clone:function(){return new t(this._x,this._y)},add:function(t,n){return this._x=t.x+n.x,this._y=t.y+n.y,this.trigger(e.Events.change)},addSelf:function(t){return this._x+=t.x,this._y+=t.y,this.trigger(e.Events.change)},sub:function(t,n){return this._x=t.x-n.x,this._y=t.y-n.y,this.trigger(e.Events.change)},subSelf:function(t){return this._x-=t.x,this._y-=t.y,this.trigger(e.Events.change)},multiplySelf:function(t){return this._x*=t.x,this._y*=t.y,this.trigger(e.Events.change)},multiplyScalar:function(t){return this._x*=t,this._y*=t,this.trigger(e.Events.change)},divideScalar:function(t){return t?(this._x/=t,this._y/=t,this.trigger(e.Events.change)):this.clear()},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this._x*e.x+this._y*e.y},lengthSquared:function(){return this._x*this._x+this._y*this._y},length:function(){return Math.sqrt(this.lengthSquared())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this._x-e.x,n=this._y-e.y;return t*t+n*n},setLength:function(e){return this.normalize().multiplyScalar(e)},equals:function(e){return this.distanceTo(e)<1e-4},lerp:function(e,t){var n=(e.x-this._x)*t+this._x,r=(e.y-this._y)*t+this._y;return this.set(n,r)},isZero:function(){return this.length()<1e-4},toString:function(){return this._x+","+this._y},toObject:function(){return{x:this._x,y:this._y}}},r={get:function(){return this._x},set:function(t){this._x=t,this.trigger(e.Events.change,"x")}},i={get:function(){return this._y},set:function(t){this._y=t,this.trigger(e.Events.change,"y")}};e.Vector.prototype.bind=e.Vector.prototype.on=function(){return this._bound||(this._x=this.x,this._y=this.y,Object.defineProperty(this,"x",r),Object.defineProperty(this,"y",i),_.extend(this,n),this._bound=!0),Backbone.Events.bind.apply(this,arguments),this}}(Two),function(e){var t=e.Commands,n=e.Anchor=function(r,i,s,o,u,a,f){e.Vector.call(this,r,i),this._broadcast=_.bind(function(){this.trigger(e.Events.change)},this),this._command=f||t.move,this._relative=!0;if(!f)return this;n.AppendCurveProperties(this),_.isNumber(s)&&(this.controls.left.x=s),_.isNumber(o)&&(this.controls.left.y=o),_.isNumber(u)&&(this.controls.right.x=u),_.isNumber(a)&&(this.controls.right.y=a)};_.extend(n,{AppendCurveProperties:function(t){t.controls={left:new e.Vector(0,0),right:new e.Vector(0,0)}}});var r={listen:function(){return _.isObject(this.controls)||n.AppendCurveProperties(this),this.controls.left.bind(e.Events.change,this._broadcast),this.controls.right.bind(e.Events.change,this._broadcast),this},ignore:function(){return this.controls.left.unbind(e.Events.change,this._broadcast),this.controls.right.unbind(e.Events.change,this._broadcast),this},clone:function(){var t=this.controls,n=new e.Anchor(this.x,this.y,t&&t.left.x,t&&t.left.y,t&&t.right.x,t&&t.right.y,this.command);return n.relative=this._relative,n},toObject:function(){var e={x:this.x,y:this.y};return this._command&&(e.command=this._command),this._relative&&(e.relative=this._relative),this.controls&&(e.controls={left:this.controls.left.toObject(),right:this.controls.right.toObject()}),e}};Object.defineProperty(n.prototype,"command",{get:function(){return this._command},set:function(r){return this._command=r,this._command===t.curve&&!_.isObject(this.controls)&&n.AppendCurveProperties(this),this.trigger(e.Events.change)}}),Object.defineProperty(n.prototype,"relative",{get:function(){return this._relative},set:function(t){return this._relative==t?this:(this._relative=!!t,this.trigger(e.Events.change))}}),_.extend(n.prototype,e.Vector.prototype,r),e.Anchor.prototype.bind=e.Anchor.prototype.on=function(){e.Vector.prototype.bind.apply(this,arguments),_.extend(this,r)},e.Anchor.prototype.unbind=e.Anchor.prototype.off=function(){e.Vector.prototype.unbind.apply(this,arguments),_.extend(this,r)}}(Two),function(e){var t=Math.cos,n=Math.sin,r=Math.tan,i=e.Matrix=function(t,n,r,i,s,o){this.elements=new e.Array(9);var u=t;_.isArray(u)||(u=_.toArray(arguments)),this.identity().set(u)};_.extend(i,{Identity:[1,0,0,0,1,0,0,0,1],Multiply:function(t,n,r){if(n.length<=3){var i,s,o,u=t,a=n[0]||0,f=n[1]||0,l=n[2]||0;return i=u[0]*a+u[1]*f+u[2]*l,s=u[3]*a+u[4]*f+u[5]*l,o=u[6]*a+u[7]*f+u[8]*l,{x:i,y:s,z:o}}var c=t[0],h=t[1],p=t[2],d=t[3],v=t[4],m=t[5],g=t[6],y=t[7],b=t[8],w=n[0],E=n[1],S=n[2],x=n[3],T=n[4],N=n[5],C=n[6],k=n[7],L=n[8];return r=r||new e.Array(9),r[0]=c*w+h*x+p*C,r[1]=c*E+h*T+p*k,r[2]=c*S+h*N+p*L,r[3]=d*w+v*x+m*C,r[4]=d*E+v*T+m*k,r[5]=d*S+v*N+m*L,r[6]=g*w+y*x+b*C,r[7]=g*E+y*T+b*k,r[8]=g*S+y*N+b*L,r}}),_.extend(i.prototype,Backbone.Events,{set:function(t){var n=t;return _.isArray(n)||(n=_.toArray(arguments)),_.extend(this.elements,n),this.trigger(e.Events.change)},identity:function(){return this.set(i.Identity),this},multiply:function(t,n,r,i,s,o,u,a,f){var l=arguments,c=l.length;if(c<=1)return _.each(this.elements,function(e,n){this.elements[n]=e*t},this),this.trigger(e.Events.change);if(c<=3){var h,p,d;return t=t||0,n=n||0,r=r||0,s=this.elements,h=s[0]*t+s[1]*n+s[2]*r,p=s[3]*t+s[4]*n+s[5]*r,d=s[6]*t+s[7]*n+s[8]*r,{x:h,y:p,z:d}}var v=this.elements,m=l,g=v[0],y=v[1],b=v[2],w=v[3],E=v[4],S=v[5],x=v[6],T=v[7],N=v[8],C=m[0],k=m[1],L=m[2],A=m[3],O=m[4],M=m[5],D=m[6],P=m[7],H=m[8];return this.elements[0]=g*C+y*A+b*D,this.elements[1]=g*k+y*O+b*P,this.elements[2]=g*L+y*M+b*H,this.elements[3]=w*C+E*A+S*D,this.elements[4]=w*k+E*O+S*P,this.elements[5]=w*L+E*M+S*H,this.elements[6]=x*C+T*A+N*D,this.elements[7]=x*k+T*O+N*P,this.elements[8]=x*L+T*M+N*H,this.trigger(e.Events.change)},inverse:function(t){var n=this.elements;t=t||new e.Matrix;var r=n[0],i=n[1],s=n[2],o=n[3],u=n[4],a=n[5],f=n[6],l=n[7],c=n[8],h=c*u-a*l,p=-c*o+a*f,d=l*o-u*f,v=r*h+i*p+s*d;return v?(v=1/v,t.elements[0]=h*v,t.elements[1]=(-c*i+s*l)*v,t.elements[2]=(a*i-s*u)*v,t.elements[3]=p*v,t.elements[4]=(c*r-s*f)*v,t.elements[5]=(-a*r+s*o)*v,t.elements[6]=d*v,t.elements[7]=(-l*r+i*f)*v,t.elements[8]=(u*r-i*o)*v,t):null},scale:function(e,t){var n=arguments.length;return n<=1&&(t=e),this.multiply(e,0,0,0,t,0,0,0,1)},rotate:function(e){var r=t(e),i=n(e);return this.multiply(r,-i,0,i,r,0,0,0,1)},translate:function(e,t){return this.multiply(1,0,e,0,1,t,0,0,1)},skewX:function(e){var t=r(e);return this.multiply(1,t,0,0,1,0,0,0,1)},skewY:function(e){var t=r(e);return this.multiply(1,0,0,t,1,0,0,0,1)},toString:function(e){var t=[];return this.toArray(e,t),t.join(" ")},toArray:function(e,t){var n=this.elements,r=!!t,i=parseFloat(n[0].toFixed(3)),s=parseFloat(n[1].toFixed(3)),o=parseFloat(n[2].toFixed(3)),u=parseFloat(n[3].toFixed(3)),a=parseFloat(n[4].toFixed(3)),f=parseFloat(n[5].toFixed(3));if(!!e){var l=parseFloat(n[6].toFixed(3)),c=parseFloat(n[7].toFixed(3)),h=parseFloat(n[8].toFixed(3));if(r){t[0]=i,t[1]=u,t[2]=l,t[3]=s,t[4]=a,t[5]=c,t[6]=o,t[7]=f,t[8]=h;return}return[i,u,l,s,a,c,o,f,h]}if(r){t[0]=i,t[1]=u,t[2]=s,t[3]=a,t[4]=o,t[5]=f;return}return[i,u,s,a,o,f]},clone:function(){var t,n,r,i,s,o,u,a,f;return t=this.elements[0],n=this.elements[1],r=this.elements[2],i=this.elements[3],s=this.elements[4],o=this.elements[5],u=this.elements[6],a=this.elements[7],f=this.elements[8],new e.Matrix(t,n,r,i,s,o,u,a,f)}})}(Two),function(e){var t=e.Utils.mod,n=e.Utils.toFixed,r={version:1.1,ns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",createElement:function(e,t){var n=e,i=document.createElementNS(this.ns,n);return n==="svg"&&(t=_.defaults(t||{},{version:this.version})),_.isObject(t)&&r.setAttributes(i,t),i},setAttributes:function(e,t){for(var n in t)e.setAttribute(n,t[n]);return this},removeAttributes:function(e,t){for(var n in t)e.removeAttribute(n);return this},toString:function(r,i){var s=r.length,o=s-1,u,a="";for(var f=0;f<s;f++){var l=r[f],c,h=i?t(f-1,s):Math.max(f-1,0),p=i?t(f+1,s):Math.min(f+1,o),d=r[h],v=r[p],m,g,y,b,w,E,S,x,T=n(l._x),N=n(l._y);switch(l._command){case e.Commands.close:c=e.Commands.close;break;case e.Commands.curve:w=d.controls&&d.controls.right||d,E=l.controls&&l.controls.left||l,d._relative?(m=n(w.x+d.x),g=n(w.y+d.y)):(m=n(w.x),g=n(w.y)),l._relative?(y=n(E.x+l.x),b=n(E.y+l.y)):(y=n(E.x),b=n(E.y)),c=(f===0?e.Commands.move:e.Commands.curve)+" "+m+" "+g+" "+y+" "+b+" "+T+" "+N;break;case e.Commands.move:u=l,c=e.Commands.move+" "+T+" "+N;break;default:c=l._command+" "+T+" "+N}f>=o&&i&&(l._command===e.Commands.curve&&(v=u,S=l.controls&&l.controls.right||l,x=v.controls&&v.controls.left||v,l._relative?(m=n(S.x+l.x),g=n(S.y+l.y)):(m=n(S.x),g=n(S.y)),v._relative?(y=n(x.x+v.x),b=n(x.y+v.y)):(y=n(x.x),b=n(x.y)),T=n(v.x),N=n(v.y),c+=" C "+m+" "+g+" "+y+" "+b+" "+T+" "+N),c+=" Z"),a+=c+" "}return a},getClip:function(e){clip=e._renderer.clip;if(!clip){root=e;while(root.parent)root=root.parent;clip=e._renderer.clip=r.createElement("clipPath"),root.defs.appendChild(clip)}return clip},group:{appendChild:function(e){var t=this.domElement.querySelector("#"+e);if(!t)return;var n=t.nodeName;if(!n)return;var r=n.replace(/svg\:/ig,"").toLowerCase();if(/clippath/.test(r))return;this.elem.appendChild(t)},removeChild:function(e){var t=this.domElement.querySelector("#"+e);if(!t)return;var n=t.nodeName;if(!n)return;var r=n.replace(/svg\:/ig,"").toLowerCase();if(/clippath/.test(r))return;this.elem.removeChild(t)},renderChild:function(e){r[e._renderer.type].render.call(e,this)},render:function(e){this._update();if(this._opacity===0&&!this._flagOpacity)return this;this._renderer.elem||(this._renderer.elem=r.createElement("g",{id:this.id}),e.appendChild(this._renderer.elem));var t=this._matrix.manual||this._flagMatrix,n={domElement:e,elem:this._renderer.elem};t&&this._renderer.elem.setAttribute("transform","matrix("+this._matrix.toString()+")");for(var i in this.children){var s=this.children[i];r[s._renderer.type].render.call(s,e)}return this._flagOpacity&&this._renderer.elem.setAttribute("opacity",this._opacity),this._flagAdditions&&_.each(this.additions,r.group.appendChild,n),this._flagSubtractions&&_.each(this.subtractions,r.group.removeChild,n),this._flagMask&&(this._mask?this._renderer.elem.setAttribute("clip-path","url(#"+this._mask.id+")"):this._renderer.elem.removeAttribute("clip-path")),this.flagReset()}},polygon:{render:function(e){this._update();if(this._opacity===0&&!this._flagOpacity)return this;var t={},n=this._matrix.manual||this._flagMatrix;n&&(t.transform="matrix("+this._matrix.toString()+")");if(this._flagVertices){var i=r.toString(this._vertices,this._closed);t.d=i}return this._flagFill&&(t.fill=this._fill),this._flagStroke&&(t.stroke=this._stroke),this._flagLinewidth&&(t["stroke-width"]=this._linewidth),this._flagOpacity&&(t["stroke-opacity"]=this._opacity,t["fill-opacity"]=this._opacity),this._flagVisible&&(t.visibility=this._visible?"visible":"hidden"),this._flagCap&&(t["stroke-linecap"]=this._cap),this._flagJoin&&(t["stroke-linejoin"]=this._join),this._flagMiter&&(t["stroke-miterlimit"]=this.miter),this._renderer.elem?r.setAttributes(this._renderer.elem,t):(t.id=this.id,this._renderer.elem=r.createElement("path",t),e.appendChild(this._renderer.elem)),this._flagClip&&(clip=r.getClip(this),elem=this._renderer.elem,this._clip?(elem.removeAttribute("id"),clip.setAttribute("id",this.id),clip.appendChild(elem)):(clip.removeAttribute("id"),elem.setAttribute("id",this.id),this.parent._renderer.elem.appendChild(elem))),this.flagReset()}}},i=e[e.Types.svg]=function(t){this.domElement=t.domElement||r.createElement("svg"),this.scene=new e.Group,this.scene.parent=this,this.defs=r.createElement("defs"),this.domElement.appendChild(this.defs)};_.extend(i,{Utils:r}),_.extend(i.prototype,Backbone.Events,{setSize:function(e,t){return this.width=e,this.height=t,r.setAttributes(this.domElement,{width:e,height:t}),this},render:function(){return r.group.render.call(this.scene,this.domElement),this}})}(Two),function(e){function o(e){e.setTransform(1,0,0,1,0,0)}var t=e.Utils.mod,n=e.Utils.toFixed,r=e.Utils.getRatio,i={group:{renderChild:function(e){i[e._renderer.type].render.call(e,this.ctx,!0,this.clip)},render:function(e){this._update();var t=this._matrix.elements,n=this.parent;this._renderer.opacity=this._opacity*(n&&n._renderer?n._renderer.opacity:1);var r=this._mask;return this._renderer.context||(this._renderer.context={}),this._renderer.context.ctx=e,e.save(),e.transform(t[0],t[3],t[1],t[4],t[2],t[5]),r&&i[r._renderer.type].render.call(r,e,!0),_.each(this.children,i.group.renderChild,this._renderer.context),e.restore(),this.flagReset()}},polygon:{render:function(r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,D,P,H,B;return this._update(),o=this._matrix.elements,u=this._stroke,a=this._linewidth,f=this._fill,l=this._opacity*this.parent._renderer.opacity,c=this._visible,h=this._cap,p=this._join,d=this._miter,v=this._closed,m=this._vertices,g=m.length,y=g-1,B=this._clip,!i&&(!c||B)?this:(r.save(),o&&r.transform(o[0],o[3],o[1],o[4],o[2],o[5]),f&&(r.fillStyle=f),u&&(r.strokeStyle=u),a&&(r.lineWidth=a),d&&(r.miterLimit=d),p&&(r.lineJoin=p),h&&(r.lineCap=h),_.isNumber(l)&&(r.globalAlpha=l),r.beginPath(),m.forEach(function(i,s){D=n(i.x),P=n(i.y);switch(i._command){case e.Commands.close:r.closePath();break;case e.Commands.curve:w=v?t(s-1,g):Math.max(s-1,0),b=v?t(s+1,g):Math.min(s+1,y),E=m[w],S=m[b],L=E.controls&&E.controls.right||E,A=i.controls&&i.controls.left||i,E._relative?(C=L.x+n(E.x),k=L.y+n(E.y)):(C=n(L.x),k=n(L.y)),i._relative?(T=A.x+n(i.x),N=A.y+n(i.y)):(T=n(A.x),N=n(A.y)),r.bezierCurveTo(C,k,T,N,D,P),s>=y&&v&&(S=x,O=i.controls&&i.controls.right||i,M=S.controls&&S.controls.left||S,i._relative?(C=O.x+n(i.x),k=O.y+n(i.y)):(C=n(O.x),k=n(O.y)),S._relative?(T=M.x+n(S.x),N=M.y+n(S.y)):(T=n(M.x),N=n(M.y)),D=n(S.x),P=n(S.y),r.bezierCurveTo(C,k,T,N,D,P));break;case e.Commands.line:r.lineTo(D,P);break;case e.Commands.move:x=i,r.moveTo(D,P)}}),v&&r.closePath(),!B&&!s&&(r.fill(),r.stroke()),r.restore(),B&&!s&&r.clip(),this.flagReset())}}},s=e[e.Types.canvas]=function(t){this.domElement=t.domElement||document.createElement("canvas"),this.ctx=this.domElement.getContext("2d"),this.overdraw=t.overdraw||!1,this.scene=new e.Group,this.scene.parent=this};_.extend(s,{Utils:i}),_.extend(s.prototype,Backbone.Events,{setSize:function(e,t,n){return this.width=e,this.height=t,this.ratio=_.isUndefined(n)?r(this.ctx):n,this.domElement.width=e*this.ratio,this.domElement.height=t*this.ratio,_.extend(this.domElement.style,{width:e+"px",height:t+"px"}),this},render:function(){var e=this.ratio===1;return e||(this.ctx.save(),this.ctx.scale(this.ratio,this.ratio)),this.overdraw||this.ctx.clearRect(0,0,this.width,this.height),i.group.render.call(this.scene,this.ctx),e||this.ctx.restore(),this}})}(Two),function(e){var t=e.Matrix.Multiply,n=e.Utils.mod,r=[1,0,0,0,1,0,0,0,1],i=new e.Array(9),s=e.Utils.getRatio,o=e.Utils.toFixed,u={canvas:document.createElement("canvas"),uv:new e.Array([0,0,1,0,0,1,0,1,1,0,1,1]),group:{renderChild:function(e){u[e._renderer.type].render.call(e,this.gl,this.program)},render:function(n,r){this._update();var s=this.parent,o=s._matrix&&s._matrix.manual||s._flagMatrix,a=this._matrix.manual||this._flagMatrix;if(o||a)this._renderer.matrix||(this._renderer.matrix=new e.Array(9)),this._matrix.toArray(!0,i),t(i,s._renderer.matrix,this._renderer.matrix),this._renderer.scale=this._scale*s._renderer.scale,o&&(this._flagMatrix=!0);return this._mask&&(n.enable(n.STENCIL_TEST),n.stencilFunc(n.ALWAYS,1,1),n.colorMask(!1,!1,!1,!0),n.stencilOp(n.KEEP,n.KEEP,n.INCR),u[this._mask._renderer.type].render.call(this._mask,n,r,this),n.colorMask(!0,!0,!0,!0),n.stencilFunc(n.NOTEQUAL,0,1),n.stencilOp(n.KEEP,n.KEEP,n.KEEP)),this._flagOpacity=s._flagOpacity||this._flagOpacity,this._renderer.opacity=this._opacity*(s&&s._renderer?s._renderer.opacity:1),_.each(this.children,u.group.renderChild,{gl:n,program:r}),this._mask&&(n.colorMask(!1,!1,!1,!1),n.stencilOp(n.KEEP,n.KEEP,n.DECR),u[this._mask._renderer.type].render.call(this._mask,n,r,this),n.colorMask(!0,!0,!0,!0),n.stencilFunc(n.NOTEQUAL,0,1),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.disable(n.STENCIL_TEST)),this.flagReset()}},polygon:{render:function(n,r,s){if(!this._visible||!this._opacity)return this;var o=this.parent,a=o._matrix.manual||o._flagMatrix,f=this._matrix.manual||this._flagMatrix,l=this._flagVertices||this._flagFill||this._flagStroke||this._flagLinewidth||this._flagOpacity||o._flagOpacity||this._flagVisible||this._flagCap||this._flagJoin||this._flagMiter||this._flagScale;this._update();if(a||f)this._renderer.matrix||(this._renderer.matrix=new e.Array(9)),this._matrix.toArray(!0,i),t(i,o._renderer.matrix,this._renderer.matrix),this._renderer.scale=this._scale*o._renderer.scale;l&&(this._renderer.rect||(this._renderer.rect={}),this._renderer.triangles||(this._renderer.triangles=new e.Array(12)),this._renderer.opacity=this._opacity*o._renderer.opacity,u.getBoundingClientRect(this._vertices,this._linewidth,this._renderer.rect),u.getTriangles(this._renderer.rect,this._renderer.triangles),u.updateBuffer(n,this,r),u.updateTexture(n,this));if(this._clip&&!s)return;return n.bindBuffer(n.ARRAY_BUFFER,this._renderer.textureCoordsBuffer),n.vertexAttribPointer(r.textureCoords,2,n.FLOAT,!1,0,0),n.bindTexture(n.TEXTURE_2D,this._renderer.texture),n.uniformMatrix3fv(r.matrix,!1,this._renderer.matrix),n.bindBuffer(n.ARRAY_BUFFER,this._renderer.buffer),n.vertexAttribPointer(r.position,2,n.FLOAT,!1,0,0),n.drawArrays(n.TRIANGLES,0,6),this.flagReset()}},getBoundingClientRect:function(e,t,n){var r=Infinity,i=-Infinity,s=Infinity,o=-Infinity,u,a;e.forEach(function(e){var t=e.x,n=e.y,u=e.controls,a,f,l,c,h,p;s=Math.min(n,s),r=Math.min(t,r),i=Math.max(t,i),o=Math.max(n,o);if(!e.controls)return;h=u.left,p=u.right;if(!h||!p)return;a=e._relative?h.x+t:h.x,f=e._relative?h.y+n:h.y,l=e._relative?p.x+t:p.x,c=e._relative?p.y+n:p.y;if(!a||!f||!l||!c)return;s=Math.min(f,c,s),r=Math.min(a,l,r),i=Math.max(a,l,i),o=Math.max(f,c,o)}),_.isNumber(t)&&(s-=t,r-=t,i+=t,o+=t),u=i-r,a=o-s,n.top=s,n.left=r,n.right=i,n.bottom=o,n.width=u,n.height=a,n.centroid||(n.centroid={}),n.centroid.x=-r,n.centroid.y=-s},getTriangles:function(e,t){var n=e.top,r=e.left,i=e.right,s=e.bottom;t[0]=r,t[1]=n,t[2]=i,t[3]=n,t[4]=r,t[5]=s,t[6]=r,t[7]=s,t[8]=i,t[9]=n,t[10]=i,t[11]=s},updateCanvas:function(t){var r=t._vertices,i=this.canvas,s=this.ctx,u=t._renderer.scale,a=t._stroke,f=t._linewidth*u,l=t._fill,c=t._renderer.opacity||t._opacity,h=t._cap,p=t._join,d=t._miter,v=t._closed,m=r.length,g=m-1;i.width=Math.max(Math.ceil(t._renderer.rect.width*u),1),i.height=Math.max(Math.ceil(t._renderer.rect.height*u),1);var y=t._renderer.rect.centroid,b=y.x*u,w=y.y*u;s.clearRect(0,0,i.width,i.height),l&&(s.fillStyle=l),a&&(s.strokeStyle=a),f&&(s.lineWidth=f),d&&(s.miterLimit=d),p&&(s.lineJoin=p),h&&(s.lineCap=h),_.isNumber(c)&&(s.globalAlpha=c);var E;s.beginPath(),r.forEach(function(t,i){var a,f,l,c,h,p,d,y,S,x,T,N,C,k;C=o(t.x*u+b),k=o(t.y*u+w);switch(t._command){case e.Commands.close:s.closePath();break;case e.Commands.curve:f=v?n(i-1,m):Math.max(i-1,0),a=v?n(i+1,m):Math.min(i+1,g),l=r[f],c=r[a],S=l.controls&&l.controls.right||l,x=t.controls&&t.controls.left||t,l._relative?(d=o((S.x+l.x)*u+b),y=o((S.y+l.y)*u+w)):(d=o(S.x*u+b),y=o(S.y*u+w)),t._relative?(h=o((x.x+t.x)*u+b),p=o((x.y+t.y)*u+w)):(h=o(x.x*u+b),p=o(x.y*u+w)),s.bezierCurveTo(d,y,h,p,C,k),i>=g&&v&&(c=E,T=t.controls&&t.controls.right||t,N=c.controls&&c.controls.left||c,t._relative?(d=o((T.x+t.x)*u+b),y=o((T.y+t.y)*u+w)):(d=o(T.x*u+b),y=o(T.y*u+w)),c._relative?(h=o((N.x+c.x)*u+b),p=o((N.y+c.y)*u+w)):(h=o(N.x*u+b),p=o(N.y*u+w)),C=o(c.x*u+b),k=o(c.y*u+w),s.bezierCurveTo(d,y,h,p,C,k));break;case e.Commands.line:s.lineTo(C,k);break;case e.Commands.move:E=t,s.moveTo(C,k)}}),v&&s.closePath(),s.fill(),s.stroke()},updateTexture:function(e,t){this.updateCanvas(t),t._renderer.texture&&e.deleteTexture(t._renderer.texture),e.bindBuffer(e.ARRAY_BUFFER,t._renderer.textureCoordsBuffer),t._renderer.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,t._renderer.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR);if(this.canvas.width<=0||this.canvas.height<=0)return;e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.canvas)},updateBuffer:function(e,t,n){_.isObject(t._renderer.buffer)&&e.deleteBuffer(t._renderer.buffer),t._renderer.buffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t._renderer.buffer),e.enableVertexAttribArray(n.position),e.bufferData(e.ARRAY_BUFFER,t._renderer.triangles,e.STATIC_DRAW),_.isObject(t._renderer.textureCoordsBuffer)&&e.deleteBuffer(t._renderer.textureCoordsBuffer),t._renderer.textureCoordsBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t._renderer.textureCoordsBuffer),e.enableVertexAttribArray(n.textureCoords),e.bufferData(e.ARRAY_BUFFER,this.uv,e.STATIC_DRAW)},program:{create:function(t,n){var r,i,s;r=t.createProgram(),_.each(n,function(e){t.attachShader(r,e)}),t.linkProgram(r),i=t.getProgramParameter(r,t.LINK_STATUS);if(!i)throw s=t.getProgramInfoLog(r),t.deleteProgram(r),new e.Utils.Error("unable to link program: "+s);return r}},shaders:{create:function(t,n,r){var i,s,o;i=t.createShader(t[r]),t.shaderSource(i,n),t.compileShader(i),s=t.getShaderParameter(i,t.COMPILE_STATUS);if(!s)throw o=t.getShaderInfoLog(i),t.deleteShader(i),new e.Utils.Error("unable to compile shader "+i+": "+o);return i},types:{vertex:"VERTEX_SHADER",fragment:"FRAGMENT_SHADER"},vertex:["attribute vec2 a_position;","attribute vec2 a_textureCoords;","","uniform mat3 u_matrix;","uniform vec2 u_resolution;","","varying vec2 v_textureCoords;","","void main() {","   vec2 projected = (u_matrix * vec3(a_position, 1.0)).xy;","   vec2 normal = projected / u_resolution;","   vec2 clipspace = (normal * 2.0) - 1.0;","","   gl_Position = vec4(clipspace * vec2(1.0, -1.0), 0.0, 1.0);","   v_textureCoords = a_textureCoords;","}"].join("\n"),fragment:["precision mediump float;","","uniform sampler2D u_image;","varying vec2 v_textureCoords;","","void main() {","  gl_FragColor = texture2D(u_image, v_textureCoords);","}"].join("\n")}};u.ctx=u.canvas.getContext("2d");var a=e[e.Types.webgl]=function(t){var n,i,s,o;this.domElement=t.domElement||document.createElement("canvas"),this.scene=new e.Group,this.scene.parent=this,this._renderer={matrix:new e.Array(r),scale:1,opacity:1},this._flagMatrix=!0,n=_.defaults(t||{},{antialias:!1,alpha:!0,premultipliedAlpha:!0,stencil:!0,preserveDrawingBuffer:!0,overdraw:!1}),this.overdraw=n.overdraw,i=this.ctx=this.domElement.getContext("webgl",n)||this.domElement.getContext("experimental-webgl",n);if(!this.ctx)throw new e.Utils.Error("unable to create a webgl context. Try using another renderer.");s=u.shaders.create(i,u.shaders.vertex,u.shaders.types.vertex),o=u.shaders.create(i,u.shaders.fragment,u.shaders.types.fragment),this.program=u.program.create(i,[s,o]),i.useProgram(this.program),this.program.position=i.getAttribLocation(this.program,"a_position"),this.program.matrix=i.getUniformLocation(this.program,"u_matrix"),this.program.textureCoords=i.getAttribLocation(this.program,"a_textureCoords"),i.disable(i.DEPTH_TEST),i.enable(i.BLEND),i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD),i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA)};_.extend(a.prototype,Backbone.Events,{setSize:function(e,t,n){this.width=e,this.height=t,this.ratio=_.isUndefined(n)?s(this.ctx):n,this.domElement.width=e*this.ratio,this.domElement.height=t*this.ratio,_.extend(this.domElement.style,{width:e+"px",height:t+"px"}),e*=this.ratio,t*=this.ratio,this._renderer.matrix[0]=this._renderer.matrix[4]=this._renderer.scale=this.ratio,this._flagMatrix=!0,this.ctx.viewport(0,0,e,t);var r=this.ctx.getUniformLocation(this.program,"u_resolution");return this.ctx.uniform2f(r,e,t),this},render:function(){var e=this.ctx;return this.overdraw||e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),u.group.render.call(this.scene,e,this.program),this._flagMatrix=!1,this}})}(Two),function(e){var t=e.Shape=function(){this._renderer={},this.id=e.Identifier+e.uniqueId(),this.classList=[],this._matrix=new e.Matrix,this.translation=new e.Vector,this.translation.bind(e.Events.change,_.bind(t.FlagMatrix,this)),this.rotation=0,this.scale=1};_.extend(t,Backbone.Events,{FlagMatrix:function(){this._flagMatrix=!0},MakeObservable:function(e){Object.defineProperty(e,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e,this._flagMatrix=!0}}),Object.defineProperty(e,"scale",{get:function(){return this._scale},set:function(e){this._scale=e,this._flagMatrix=!0,this._flagScale=!0}})}}),_.extend(t.prototype,{_flagMatrix:!0,_rotation:0,_scale:1,addTo:function(e){return e.add(this),this},clone:function(){var e=new t;return e.translation.copy(this.translation),e.rotation=this.rotation,e.scale=this.scale,_.each(t.Properties,function(t){e[t]=this[t]},this),e._update()},replaceParent:function(e){var t=this.id,n;return this.parent&&(delete this.parent.children[t],n=_.indexOf(parent.additions,t),n>=0&&this.parent.additions.splice(n,1),this.parent.subtractions.push(t),this._flagSubtractions=!0),e?(e.children[t]=this,this.parent=e,e.additions.push(t),e._flagAdditions=!0):delete this.parent,this},_update:function(e){return!this._matrix.manual&&this._flagMatrix&&this._matrix.identity().translate(this.translation.x,this.translation.y).scale(this.scale).rotate(this.rotation),e&&this.parent&&this.parent._update&&this.parent._update(),this},flagReset:function(){return this._flagMatrix=this._flagScale=!1,this}}),t.MakeObservable(t.prototype)}(Two),function(e){function u(t,n,r){var i,s,o,u,a,f,l,c,h=n.controls&&n.controls.right,p=t.controls&&t.controls.left;return i=n.x,a=n.y,s=(h||n).x,f=(h||n).y,o=(p||t).x,l=(p||t).y,u=t.x,c=t.y,h&&n._relative&&(s+=n.x,f+=n.y),p&&t._relative&&(o+=t.x,l+=t.y),e.Utils.getCurveLength(i,a,s,f,o,l,u,c,r)}function a(t,n,r){var i,s,o,u,a,f,l,c,h=n.controls&&n.controls.right,p=t.controls&&t.controls.left;return i=n.x,a=n.y,s=(h||n).x,f=(h||n).y,o=(p||t).x,l=(p||t).y,u=t.x,c=t.y,h&&n._relative&&(s+=n.x,f+=n.y),p&&t._relative&&(o+=t.x,l+=t.y),e.Utils.subdivide(i,a,s,f,o,l,u,c,r)}var t=Math.min,n=Math.max,r=Math.round,i=e.Utils.getComputedMatrix,s={};_.each(e.Commands,function(e,t){s[t]=new RegExp(e)});var o=e.Polygon=function(t,n,r,i){e.Shape.call(this),this._renderer.type="polygon",this._closed=!!n,this._curved=!!r,this.beginning=0,this.ending=1,this.fill="#fff",this.stroke="#000",this.linewidth=1,this.opacity=1,this.visible=!0,this.cap="butt",this.join="miter",this.miter=4,this._vertices=[],this.vertices=t,this.automatic=!i};_.extend(o,{Properties:["fill","stroke","linewidth","opacity","visible","cap","join","miter","closed","curved","automatic","beginning","ending"],FlagVertices:function(){this._flagVertices=!0,this._flagLength=!0},MakeObservable:function(r){e.Shape.MakeObservable(r),_.each(o.Properties.slice(0,8),function(e){var t="_"+e,n="_flag"+e.charAt(0).toUpperCase()+e.slice(1);Object.defineProperty(r,e,{get:function(){return this[t]},set:function(e){this[t]=e,this[n]=!0}})}),Object.defineProperty(r,"length",{get:function(){return this._flagLength&&this._updateLength(),this._length}}),Object.defineProperty(r,"closed",{get:function(){return this._closed},set:function(e){this._closed=!!e,this._flagVertices=!0}}),Object.defineProperty(r,"curved",{get:function(){return this._curved},set:function(e){this._curved=!!e,this._flagVertices=!0}}),Object.defineProperty(r,"automatic",{get:function(){return this._automatic},set:function(e){if(e===this._automatic)return;this._automatic=!!e;var t=this._automatic?"ignore":"listen";_.each(this.vertices,function(e){e[t]()})}}),Object.defineProperty(r,"beginning",{get:function(){return this._beginning},set:function(e){this._beginning=t(n(e,0),this._ending),this._flagVertices=!0}}),Object.defineProperty(r,"ending",{get:function(){return this._ending},set:function(e){this._ending=t(n(e,this._beginning),1),this._flagVertices=!0}}),Object.defineProperty(r,"vertices",{get:function(){return this._collection},set:function(t){var n=_.bind(o.FlagVertices,this),r=_.bind(function(t){var r=t.length;while(r--)t[r].bind(e.Events.change,n);n()},this),i=_.bind(function(t){_.each(t,function(t){t.unbind(e.Events.change,n)},this),n()},this);this._collection&&this._collection.unbind(),this._collection=new e.Utils.Collection(t.slice(0)),this._collection.bind(e.Events.insert,r),this._collection.bind(e.Events.remove,i),r(this._collection)}}),Object.defineProperty(r,"clip",{get:function(){return this._clip},set:function(e){this._clip=e,this._flagClip=!0}})}}),_.extend(o.prototype,e.Shape.prototype,{_flagVertices:!0,_flagLength:!0,_flagFill:!0,_flagStroke:!0,_flagLinewidth:!0,_flagOpacity:!0,_flagVisible:!0,_flagCap:!0,_flagJoin:!0,_flagMiter:!0,_flagClip:!1,_length:0,_fill:"#fff",_stroke:"#000",_linewidth:1,_opacity:1,_visible:!0,_cap:"round",_join:"round",_miter:4,_closed:!0,_curved:!1,_automatic:!0,_beginning:0,_ending:1,_clip:!1,clone:function(t){t=t||this.parent;var n=_.map(this.vertices,function(e){return e.clone()}),r=new o(n,this.closed,this.curved,!this.automatic);return _.each(e.Shape.Properties,function(e){r[e]=this[e]},this),r.translation.copy(this.translation),r.rotation=this.rotation,r.scale=this.scale,t.add(r),r},toObject:function(){var t={vertices:_.map(this.vertices,function(e){return e.toObject()})};return _.each(e.Shape.Properties,function(e){t[e]=this[e]},this),t.translation=this.translation.toObject,t.rotation=this.rotation,t.scale=this.scale,t},noFill:function(){return this.fill="transparent",this},noStroke:function(){return this.stroke="transparent",this},corner:function(){var e=this.getBoundingClientRect(!0);return e.centroid={x:e.left+e.width/2,y:e.top+e.height/2},_.each(this.vertices,function(t){t.addSelf(e.centroid)}),this},center:function(){var e=this.getBoundingClientRect(!0);return e.centroid={x:e.left+e.width/2,y:e.top+e.height/2},_.each(this.vertices,function(t){t.subSelf(e.centroid)}),this},remove:function(){return this.parent?(this.parent.remove(this),this):this},getBoundingClientRect:function(e){this._update(!0);var r=e?this._matrix:i(this),s=this.linewidth/2,o,u,a=Infinity,f=-Infinity,l=Infinity,c=-Infinity;return _.each(this._vertices,function(e){o=e.x,u=e.y,e=r.multiply(o,u,1),l=t(e.y-s,l),a=t(e.x-s,a),f=n(e.x+s,f),c=n(e.y+s,c)}),{top:l,left:a,right:f,bottom:c,width:f-a,height:c-l}},getPointAt:function(t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v=this.length*Math.min(Math.max(t,0),1),m=this.vertices.length,g=m-1,y=null,b=null;for(var w=0,E=this._lengths.length,S=0;w<E;w++){if(S+this._lengths[w]>v){y=this.vertices[this.closed?e.Utils.mod(w,m):w],b=this.vertices[Math.min(Math.max(w-1,0),g)],v-=S,t=v/this._lengths[w];break}S+=this._lengths[w]}return _.isNull(y)||_.isNull(b)?null:(d=b.controls&&b.controls.right,p=y.controls&&y.controls.left,i=b.x,f=b.y,s=(d||b).x,l=(d||b).y,o=(p||y).x,c=(p||y).y,u=y.x,h=y.y,d&&b._relative&&(s+=b.x,l+=b.y),p&&y._relative&&(o+=y.x,c+=y.y),r=e.Utils.getPointOnCubicBezier(t,i,s,o,u),a=e.Utils.getPointOnCubicBezier(t,f,l,c,h),_.isObject(n)?(n.x=r,n.y=a,n):new e.Vector(r,a))},plot:function(){if(this.curved)return e.Utils.getCurveFromPoints(this._vertices,this.closed),this;for(var t=0;t<this._vertices.length;t++)this._vertices[t]._command=t===0?e.Commands.move:e.Commands.line;return this},subdivide:function(t){this._update();var n=this.vertices.length-1,r=this.vertices[n],i=this._closed||this.vertices[n]._command===e.Commands.close,s=[];return _.each(this.vertices,function(o,u){if(u<=0&&!i){r=o;return}if(o.command===e.Commands.move){s.push(new e.Anchor(r.x,r.y)),u>0&&(s[s.length-1].command=e.Commands.line),r=o;return}var f=a(o,r,t);s=s.concat(f),_.each(f,function(t,n){n<=0&&r.command===e.Commands.move?t.command=e.Commands.move:t.command=e.Commands.line}),u>=n&&(this._closed&&this._automatic?(r=o,f=a(o,r,t),s=s.concat(f),_.each(f,function(t,n){n<=0&&r.command===e.Commands.move?t.command=e.Commands.move:t.command=e.Commands.line})):i&&s.push(new e.Anchor(o.x,o.y)),s[s.length-1].command=i?e.Commands.close:e.Commands.line),r=o},this),this._automatic=!1,this._curved=!1,this.vertices=s,this},_updateLength:function(t){this._update();var n=this.vertices.length-1,r=this.vertices[n],i=this._closed||this.vertices[n]._command===e.Commands.close,s=0;return _.isUndefined(this._lengths)&&(this._lengths=[]),_.each(this.vertices,function(o,a){if(a<=0&&!i||o.command===e.Commands.move){r=o,this._lengths[a]=0;return}this._lengths[a]=u(o,r,t),s+=this._lengths[a],a>=n&&i&&(r=o,this._lengths[a+1]=u(o,r,t),s+=this._lengths[a+1]),r=o},this),this._length=s,this},_update:function(){if(this._flagVertices){var t=this.vertices.length,n=t-1,i,s=r(this._beginning*n),o=r(this._ending*n);this._vertices.length=0;for(var u=s;u<o+1;u++)i=this.vertices[u],this._vertices.push(i);this._automatic&&this.plot()}return e.Shape.prototype._update.call(this),this},flagReset:function(){return this._flagVertices=this._flagFill=this._flagStroke=this._flagLinewidth=this._flagOpacity=this._flagVisible=this._flagCap=this._flagJoin=this._flagMiter=this._flagClip=!1,e.Shape.prototype.flagReset.call(this),this}}),o.MakeObservable(o.prototype)}(Two),function(e){var t=Math.min,n=Math.max,r=e.Group=function(){e.Shape.call(this,!0),this._renderer.type="group",this.additions=[],this.subtractions=[],this.children={}};_.extend(r,{MakeObservable:function(t){var n=e.Polygon.Properties.slice(0),i=_.indexOf(n,"opacity");i>=0&&(n.splice(i,1),Object.defineProperty(t,"opacity",{get:function(){return this._opacity},set:function(e){this._opacity=e,this._flagOpacity=!0}})),e.Shape.MakeObservable(t),r.MakeGetterSetters(t,n),Object.defineProperty(t,"mask",{get:function(){return this._mask},set:function(e){this._mask=e,this._flagMask=!0,e.clip||(e.clip=!0)}})},MakeGetterSetters:function(e,t){_.isArray(t)||(t=[t]),_.each(t,function(t){r.MakeGetterSetter(e,t)})},MakeGetterSetter:function(e,t){var n="_"+t;Object.defineProperty(e,t,{get:function(){return this[n]},set:function(e){this[n]=e,_.each(this.children,function(n){n[t]=e})}})}}),_.extend(r.prototype,e.Shape.prototype,{_flagAdditions:!1,_flagSubtractions:!1,_flagOpacity:!0,_flagMask:!1,_fill:"#fff",_stroke:"#000",_linewidth:1,_opacity:1,_visible:!0,_cap:"round",_join:"round",_miter:4,_closed:!0,_curved:!1,_automatic:!0,_beginning:0,_ending:1,_mask:null,clone:function(e){e=e||this.parent;var t=new r;e.add(t);var n=_.map(this.children,function(e){return e.clone(t)});return t.translation.copy(this.translation),t.rotation=this.rotation,t.scale=this.scale,t},toObject:function(){var e={children:{},translation:this.translation.toObject(),rotation:this.rotation,scale:this.scale};return _.each(this.children,function(t,n){e.children[n]=t.toObject()},this),e},corner:function(){var e=this.getBoundingClientRect(!0),t={x:e.left,y:e.top};return _.each(this.children,function(e){e.translation.subSelf(t)}),this},center:function(){var e=this.getBoundingClientRect(!0);return e.centroid={x:e.left+e.width/2,y:e.top+e.height/2},_.each(this.children,function(t){t.translation.subSelf(e.centroid)}),this},getById:function(e){var t=function(e,n){if(e.id===n)return e;for(var r in e.children){var i=t(e.children[r],n);if(i)return i}};return t(this,e)||null},getByClassName:function(e){var t=[],n=function(e,r){e.classList.indexOf(r)!=-1&&t.push(e);for(var i in e.children)n(e.children[i],r);return t};return n(this,e)},getByType:function(t){var n=[],r=function(t,i){for(var s in t.children)t.children[s]instanceof i?n.push(t.children[s]):t.children[s]instanceof e.Group&&r(t.children[s],i);return n};return r(this,t)},add:function(e){var t=arguments.length,n=this.children,r=this.parent,i=this.additions,s,o,u;return _.isArray(e)||(e=_.toArray(arguments)),_.each(e,function(e){if(!e)return;s=e.id,o=e.parent,_.isUndefined(n[s])&&(o&&(delete o.children[s],u=_.indexOf(o.additions,s),u>=0&&o.additions.splice(u,1)),n[s]=e,e.parent=this,i.push(s),this._flagAdditions=!0)},this),this},remove:function(e){var t=arguments.length,n=this.children,r=this.parent,i=this.subtractions,s,o,u,a;return t<=0&&r?(r.remove(this),this):(_.isArray(e)||(e=_.toArray(arguments)),_.each(e,function(e){s=e.id,a=e.children,o=e.parent;if(!(s in n))return;delete n[s],delete e.parent,u=_.indexOf(o.additions,s),u>=0&&o.additions.splice(u,1),i.push(s),this._flagSubtractions=!0},this),this)},getBoundingClientRect:function(){var e;this._update(!0);var r=Infinity,i=-Infinity,s=Infinity,o=-Infinity;return _.each(this.children,function(u){e=u.getBoundingClientRect();if(!_.isNumber(e.top)||!_.isNumber(e.left)||!_.isNumber(e.right)||!_.isNumber(e.bottom))return;s=t(e.top,s),r=t(e.left,r),i=n(e.right,i),o=n(e.bottom,o)},this),{top:s,left:r,right:i,bottom:o,width:i-r,height:o-s}},noFill:function(){return _.each(this.children,function(e){e.noFill()}),this},noStroke:function(){return _.each(this.children,function(e){e.noStroke()}),this},subdivide:function(){var e=arguments;return _.each(this.children,function(t){t.subdivide.apply(t,e)}),this},flagReset:function(){return this._flagAdditions&&(this.additions.length=0,this._flagAdditions=!1),this._flagSubtractions&&(this.subtractions.length=0,this._flagSubtractions=!1),this._flagMask=this._flagOpacity=!1,e.Shape.prototype.flagReset.call(this),this}}),r.MakeObservable(r.prototype)}(Two),define("happy/utils/DOM",[],function(){var e=function(){var e=this,t=function(e,t){return typeof e.classList=="undefined"?e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)")):e.classList.contains(t)},n=function(e,t){typeof e.classList=="undefined"?this.hasClass(e,t)||(e.className+=" "+t):e.classList.add(t)},r=function(e,n){if(typeof e.classList=="undefined"){if(t(e,n)){var r=new RegExp("(\\s|^)"+n+"(\\s|$)");e.className=e.className.replace(r," ")}}else e.classList.remove(n)},i=function(e){while(e.lastChild)e.removeChild(e.lastChild)},s=function(e){var t=e.offsetWidth,n=e.offsetHeight;return{width:t,height:n}},o=function(e){var t=0,n=0;if(e&&e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return{x:t,y:n}};Object.defineProperty(e,"hasClass",{value:t}),Object.defineProperty(e,"addClass",{value:n}),Object.defineProperty(e,"removeClass",{value:r}),Object.defineProperty(e,"empty",{value:i}),Object.defineProperty(e,"measure",{value:s}),Object.defineProperty(e,"calculatePosition",{value:o})};return e}),define("SVGDrawing",["libs/two","happy/utils/DOM"],function(e,t){var n=new t,r=function(){var t=this,r,i,s=function(t){i=t;var s=n.measure(i);r=new e({width:s.width,height:s.height}),r.appendTo(i)},o=function(){if(!i)return;var e=n.measure(i);r.width=e.width,r.height=e.height,u()},u=function(){if(!r)return;r.update()};Object.defineProperty(t,"init",{value:s}),Object.defineProperty(t,"resize",{value:o}),Object.defineProperty(t,"update",{value:u}),Object.defineProperty(t,"two",{get:function(){return r}})},i=new r;return i}),define("EventsManager",[],function(){var e=function(){var e=this,t=[],n=function(e,t,n){i("add","remove",e,null,t,n)},r=function(e,t,n){i("addEventListener","removeEventListener",e,t,n)},i=function(e,n,r,i,s,o){var u={add:e,remove:n,object:r,e:i,fnc:s};typeof o=="undefined"&&(o=0),t.push(u),i?u.object[u.add](u.e,u.fnc):u.object[u.add](u.fnc,this,o)},s=function(){t.forEach(function(e){e.e?e.object[e.remove](e.e,e.fnc):e.object[e.remove](e.fnc)}),t=[]};Object.defineProperty(e,"add",{value:n}),Object.defineProperty(e,"addEventListener",{value:r}),Object.defineProperty(e,"destroy",{value:s})};return e}),define("ui/Menu",["happy/_libs/signals","EventsManager"],function(e,t){var n=function(){var n=this,r,i,s=new t,o=function(){i=document.createElement("div"),i.classList.add("ui-menu"),u();var e=document.createElement("div");e.id="upload",e.innerHTML="upload",i.appendChild(e)},u=function(){var t=document.createElement("div");t.classList.add("tabs"),i.appendChild(t);var n=document.createElement("input");n.name="tab",n.type="radio",n.value="visual",n.classList.add("tab"),n.classList.add("visual"),s.addEventListener(n,"click",function(){r.dispatch(n.value)}),t.appendChild(n);var o=document.createElement("input");o.name="tab",o.type="radio",o.value="code",o.classList.add("tab"),o.classList.add("code"),s.addEventListener(o,"click",function(){r.dispatch(o.value)}),t.appendChild(o);var u=document.createElement("input");u.name="tab",u.type="radio",u.value="serial",u.classList.add("tab"),u.classList.add("serial"),s.addEventListener(u,"click",function(){r.dispatch(u.value)}),t.appendChild(u),r=new e,setTimeout(function(){var e=localStorage.getItem("QuirkbotCurrentTab")||"visual",t;switch(e){case"visual":t=n;break;case"code":t=o;break;case"serial":t=u}t.checked=!0,r.dispatch(e)},0),s.add(r,function(e){localStorage.setItem("QuirkbotCurrentTab",e)})};Object.defineProperty(n,"container",{get:function(){return i}}),Object.defineProperty(n,"tabChanged",{get:function(){return r}}),o()};return n}),define("Cloud",["happy/_libs/signals","libs/parse","Promise"],function(e,t,n){Parse.initialize("oSSqARDBD4wxYVkkDSCwZNufdtl3D1h6peWmHEWG","uouLxvF7McUHQGMuTev72aC88LtGfNIuQYiqrfzh");var r=Parse.Object.extend("Program",{defaults:{name:"Untitled Program",tree:""},initialize:function(){this.get("name")||this.set({name:this.defaults.name})}}),i=Parse.Collection.extend({model:r,nextOrder:function(){return this.length?this.last().get("order")+1:1},comparator:function(e){return e.get("order")}}),s=function(){var t=this,r,i,s=function(){r=new e,i=new e,setTimeout(function(){p()?r.dispatch(Parse.User.current()):i.dispatch()},100)},o=function(e,t,i){return new n(function(n,s){Parse.User.signUp(t,i,{email:e,ACL:new Parse.ACL},{success:function(e){n(e),r.dispatch(e)},error:function(e,t){s(t)}})})},u=function(e,t){return new n(function(n,i){Parse.User.logIn(e,t,{success:function(e){n(e),r.dispatch(e)},error:function(e,t){i(t)}})})},a=function(){Parse.User.current()&&Parse.User.logOut()},f=function(e,t){},l=function(e){},c=function(e){},h=function(e){},p=function(){return!0};Object.defineProperty(t,"signUp",{value:o}),Object.defineProperty(t,"logIn",{value:u}),Object.defineProperty(t,"logOut",{value:a}),Object.defineProperty(t,"user",{get:p}),Object.defineProperty(t,"loggedIn",{get:function(){return r}}),Object.defineProperty(t,"loggedOut",{get:function(){return i}}),s()},o=new s;return o}),define("ui/Authentication",["Cloud","EventsManager"],function(e,t){var n=new t,r=function(){var t=this,r,i=function(){r=document.createElement("div"),r.classList.add("ui-authentication");var t=document.createElement("div");t.classList.add("inner"),r.appendChild(t);var i=document.createElement("h1");i.classList.add("heading"),i.innerHTML="Quirkbot",t.appendChild(i),s(t),o(t),e.user?f():a(),n.add(e.loggedIn,f),n.add(e.loggedOut,a)},s=function(t){var r=document.createElement("div");r.classList.add("wrapper"),r.classList.add("login"),t.appendChild(r);var i=document.createElement("h3");i.classList.add("title"),i.innerHTML="Log in",r.appendChild(i);var s=document.createElement("div");s.classList.add("message"),r.appendChild(s);var o=document.createElement("input");o.classList.add("user"),o.type="text",o.placeholder="E-mail",r.appendChild(o);var u=document.createElement("input");u.classList.add("password"),u.type="password",u.placeholder="Password",r.appendChild(u);var a=document.createElement("a");a.href="#",a.classList.add("button"),a.innerHTML="Log in",r.appendChild(a);var f=function(){s.classList.add("error");if(!o.value){s.innerHTML="Username missing.";return}if(!u.value){s.innerHTML="Password missing.";return}s.classList.remove("error"),s.innerHTML="Loading...",e.logIn(o.value,u.value).then(function(e){s.innerHTML="",console.log(e)}).catch(function(e){s.classList.add("error"),s.innerHTML="Invalid username or password."})};n.addEventListener(a,"click",f),n.addEventListener(r,"keypress",function(e){if(e.keyCode==13)return f(),!1})},o=function(t){var r=document.createElement("div");r.classList.add("wrapper"),r.classList.add("signup"),t.appendChild(r);var i=document.createElement("h3");i.classList.add("title"),i.innerHTML="Registration",r.appendChild(i);var s=document.createElement("div");s.classList.add("message"),r.appendChild(s);var o=document.createElement("input");o.classList.add("email"),o.type="email",o.placeholder="E-mail",r.appendChild(o);var u=document.createElement("input");u.classList.add("password"),u.type="password",u.placeholder="Password",r.appendChild(u);var a=document.createElement("input");a.classList.add("password"),a.type="password",a.placeholder="Confirm Password",r.appendChild(a);var f=document.createElement("a");f.href="#",f.classList.add("button"),f.innerHTML="Register",r.appendChild(f);var l=function(){s.classList.add("error");if(!o.value){s.innerHTML="E-mail missing.";return}if(!u.value){s.innerHTML="Password missing.";return}if(u.value!==a.value){s.innerHTML="Password missmatch.";return}s.classList.remove("error"),s.innerHTML="Loading...",e.signUp(o.value,o.value,u.value).then(function(e){console.log(e),s.innerHTML=""}).catch(function(e){s.classList.add("error"),s.innerHTML=e.message})};n.addEventListener(f,"click",l),n.addEventListener(r,"keypress",function(e){if(e.keyCode==13)return l(),!1})},u=function(){},a=function(){r.style.display=""},f=function(){r.style.display="none"};Object.defineProperty(t,"show",{value:a}),Object.defineProperty(t,"hide",{value:f}),Object.defineProperty(t,"update",{value:u}),Object.defineProperty(t,"container",{get:function(){return r}}),i()};return r}),define("ui/DefinitionItem",["Tree"],function(e){var t=function(t){var n=this,r,i=function(){r=document.createElement("div"),r.classList.add("definition-item");var n=document.createElement("div");n.classList.add("insert"),n.addEventListener("click",function(){var n=e.generateSafeNodeId(t.name);e.data[n]={type:t.type}}),r.appendChild(n);var i=document.createElement("h5");i.classList.add("title"),i.innerHTML=t.name,r.appendChild(i),i.addEventListener("click",function(){r.dataset.expanded?delete r.dataset.expanded:r.dataset.expanded=!0});var s=document.createElement("div");s.classList.add("description"),s.innerHTML=t.description,r.appendChild(s)};Object.defineProperty(n,"container",{get:function(){return r}}),i()};return t}),define("ui/DefinitionList",["ui/DefinitionItem","Definitions"],function(e,t){var n=function(){var n=this,r,i=function(){r=document.createElement("div"),r.classList.add("ui-definition-list");var n=Object.keys(t.data);n.sort(s);var i={};n.forEach(function(n){var s=t.data[n];if(!Array.isArray(s.groups)||!s.groups.length)s.groups=["Other"];s.groups.forEach(function(t){if(!i[t]){var n=document.createElement("div");n.classList.add("definition-group"),n.dataset.expanded=!0,r.appendChild(n);var o=document.createElement("div");o.innerHTML=t,o.classList.add("label"),n.appendChild(o),o.addEventListener("click",function(){n.dataset.expanded?delete n.dataset.expanded:n.dataset.expanded=!0});var u=document.createElement("div");u.classList.add("inner"),n.appendChild(u),i[t]={container:n,label:o,inner:u}}var a=new e(s);i[t].inner.appendChild(a.container)})})},s=function(e,n){var r=t.data[e],i=t.data[n];return r.name<i.name?-1:r.name>i.name?1:(0,0)},o=function(e,n){var r=t.data[e],i=t.data[n];return r.group<i.group?-1:r.group>i.group?1:(0,0)},u=function(e,n){var r=t.data[e],i=t.data[n];if(r.out&&i.out){if(e<n)return-1;if(e>n)return 1}return r.out?-1:i.out?1:0};Object.defineProperty(n,"container",{get:function(){return r}}),i()};return n}),function(){function mt(){}function gt(e){return!!e&&typeof e=="object"&&(/object|function/.test(typeof Element)?e instanceof Element:e.nodeType===1&&typeof e.nodeName=="string")}function yt(e){return e instanceof Object}function bt(e){return e instanceof Array}function wt(e){return typeof e=="function"}function Et(e){return typeof e=="number"}function St(e){return typeof e=="boolean"}function xt(e){return typeof e=="string"}function Tt(e,t){for(var n in t)e[n]=t[n];return e}function Nt(e){var t=Tt({},e),n;t.constructor=e.constructor;if(e.touches){t.touches=[],t.changedTouches=[];for(n=0;n<e.touches.length;n++)t.touches.push(Tt({},e.touches[n]));for(n=0;n<e.touches.length;n++)t.changedTouches.push(Tt({},e.changedTouches[n]))}return t}function Ct(e,t){At(t,C),e.pageX=C.x,e.pageY=C.y,Ot(t,C),e.clientX=C.x,e.clientY=C.y,e.timeStamp=(new Date).getTime()}function kt(e,t,n){e.pageX=n.pageX-t.pageX,e.pageY=n.pageY-t.pageY,e.clientX=n.clientX-t.clientX,e.clientY=n.clientY-t.clientY,e.timeStamp=(new Date).getTime()-t.timeStamp;var r=Math.max(e.timeStamp/1e3,.001);e.pageSpeed=c(e.pageX,e.pageY)/r,e.pageVX=e.pageX/r,e.pageVY=e.pageY/r,e.clientSpeed=c(e.clientX,e.pageY)/r,e.clientVX=e.clientX/r,e.clientVY=e.clientY/r}function Lt(e,t,n){var r,i,s;return n=n||{},e=e||"page",/touch/.test(t.type)&&t.touches?(r=t.touches.length?t.touches[0]:t.changedTouches[0],i=r[e+"X"],s=r[e+"Y"]):(i=t[e+"X"],s=t[e+"Y"]),n.x=i,n.y=s,n}function At(t,n){return n=n||{},t instanceof on?/inertiastart/.test(t.type)?(At(k.pointerUp,n),n.x+=k.sx,n.y+=k.sy):(n.x=t.pageX,n.y=t.pageY):ot?(Lt("screen",t,n),n.x+=window.scrollX,n.y+=window.scrollY):/gesture|inertia/i.test(t.type)?(Lt("client",t,n),n.x+=e.documentElement.scrollLeft,n.y+=e.documentElement.scrollTop):Lt("page",t,n),n}function Ot(e,t){return t=t||{},e instanceof on?/inertiastart/.test(e.type)?(Ot(k.pointerUp,t),t.x+=k.sx,t.y+=k.sy):(t.x=e.clientX,t.y=e.clientY):Lt(ot?"screen":"client",e,t),t}function Mt(){return{x:window.scrollX||e.documentElement.scrollLeft,y:window.scrollY||e.documentElement.scrollTop}}function _t(e){var t=/ipad|iphone|ipod/i.test(navigator.userAgent)?{x:0,y:0}:Mt(),r=e instanceof n?e.getBoundingClientRect():e.getClientRects()[0];return r&&{left:r.left+t.x,right:r.right+t.x,top:r.top+t.y,bottom:r.bottom+t.y,width:r.width||r.right-r.left,height:r.heigh||r.bottom-r.top}}function Dt(e){var t=[];return bt(e)?(t[0]=e[0],t[1]=e[1]):e.type==="touchend"?e.touches.length===1?(t[0]=e.touches[0],t[1]=e.changedTouches[0]):e.touches.length===0&&(t[0]=e.changedTouches[0],t[1]=e.changedTouches[1]):(t[0]=e.touches[0],t[1]=e.touches[1]),t}function Pt(e){var t=Dt(e);return{pageX:(t[0].pageX+t[1].pageX)/2,pageY:(t[0].pageY+t[1].pageY)/2,clientX:(t[0].clientX+t[1].clientX)/2,clientY:(t[0].clientY+t[1].clientY)/2}}function Ht(e){if((!e.touches||!e.touches.length)&&!g.length)return;var t=Dt(e),n=Math.min(t[0].pageX,t[1].pageX),r=Math.min(t[0].pageY,t[1].pageY),i=Math.max(t[0].pageX,t[1].pageX),s=Math.max(t[0].pageY,t[1].pageY);return{x:n,y:r,left:n,top:r,width:i-n,height:s-r}}function Bt(e){var t=(H&&H.options||q).deltaSource,n=t+"X",r=t+"Y",i=Dt(e),s=i[0][n]-i[1][n],o=i[0][r]-i[1][r];return c(s,o)}function jt(e,t){var n=(H&&H.options||q).deltaSource,r=n+"X",i=n+"Y",s=Dt(e),o=s[0][r]-s[1][r],u=s[0][i]-s[1][i],a=180*Math.atan(u/o)/Math.PI;if(Et(t)){var f=a-t,l=f%360;l>315?a-=360+a/360|0:l>135?a-=180+a/360|0:l<-315?a+=360+a/360|0:l<-135&&(a+=180+a/360|0)}return a}function Ft(e,t){e=e||H;var n=e?e.options.origin:q.origin;return t=t||e._element,n==="parent"?n=t.parentNode:n==="self"&&(n=t),gt(n)?(n=_t(n),n.x=n.left,n.y=n.top):wt(n)&&(n=n(e&&t)),n}function It(e){var t=e.target.options.inertia,n=t.resistance,r=-Math.log(t.endSpeed/e.v0)/n;e.x0=w.pageX,e.y0=w.pageY,e.t0=e.startEvent.timeStamp/1e3,e.sx=e.sy=0,e.modifiedXe=e.xe=(e.vx0-r)/n,e.modifiedYe=e.ye=(e.vy0-r)/n,e.te=r,e.lambda_v0=n/e.v0,e.one_ve_v0=1-t.endSpeed/e.v0}function qt(){var e=k.target.options.inertia,t=e.resistance,n=(new Date).getTime()/1e3-k.t0;if(n<k.te){var r=1-(Math.exp(-t*n)-k.lambda_v0)/k.one_ve_v0;if(k.modifiedXe===k.xe&&k.modifiedYe===k.ye)k.sx=k.xe*r,k.sy=k.ye*r;else{var i=zt(0,0,k.xe,k.ye,k.modifiedXe,k.modifiedYe,r);k.sx=i.x,k.sy=i.y}mn(k.startEvent),k.i=ft(qt)}else k.sx=k.modifiedXe,k.sy=k.modifiedYe,mn(k.startEvent),k.active=!1,Mn(k.startEvent)}function Rt(){var e=(new Date).getTime()-k.t0,t=k.target.options.inertia.smoothEndDuration;e<t?(k.sx=Wt(e,0,k.xe,t),k.sy=Wt(e,0,k.ye,t),mn(k.startEvent),k.i=ft(Rt)):(k.active=!1,k.smoothEnd=!1,mn(k.startEvent),Mn(k.startEvent))}function Ut(e,t,n,r){var i=1-e;return i*i*t+2*i*e*n+e*e*r}function zt(e,t,n,r,i,s,o){return{x:Ut(o,e,n,i),y:Ut(o,t,r,s)}}function Wt(e,t,n,r){return e/=r,-n*e*(e-2)+t}function Xt(e,t){while(t=t.parentNode)if(t===e)return!0;return!1}function Vt(t,n){return t._context===e||Xt(t._context,n)}function $t(e,t){var n=e.options.ignoreFrom;return!n||!gt(t)||t===e._element.parentNode?!1:xt(n)?Rn(t,n)||$t(e,t.parentNode):gt(n)?t===n||Xt(n,t):!1}function Jt(e,t){var n=e.options.allowFrom;return n?!gt(t)||t===e._element.parentNode?!1:xt(n)?Rn(t,n)||Jt(e,t.parentNode):gt(n)?t===n||Xt(n,t):!1:!0}function Kt(e,t){if(!t)return;var n=t.options,r=n.preventDefault;if(r==="auto"&&!/^input$|^textarea$/i.test(H._element.nodeName)){if(/down|start/i.test(e.type)&&tt==="drag"&&n.dragAxis!=="xy")return;e.preventDefault();return}if(r===!0){e.preventDefault();return}}function Qt(e,t){if(!t)return!1;var n=t.options.dragAxis;return e==="xy"||n==="xy"||n===e}function Gt(e,t){var n=e.options;return t=t||tt,/^resize/.test(t)&&(t="resize"),n.snapEnabled&&qn(n.snap.actions,t)}function Yt(e,t){var n=e.options;return t=t||tt,/^resize/.test(t)&&(t="resize"),n.restrictEnabled&&n.restrict[t]}function Zt(e){var t=[],n=[],r;e=e||H._element;for(r=0;r<O.length;r++){var i=O[r];if(gt(i.options.accept)&&i.options.accept!==e||xt(i.options.accept)&&!Rn(e,i.options.accept))continue;i.selector&&(i._dropElements=i._context.querySelectorAll(i.selector));for(var s=0,o=i._dropElements.length;s<o;s++){var u=i._dropElements[s];if(u===e)continue;t.push(i),n.push(u)}}return{dropzones:t,elements:n}}function en(e){var t,n,r,i;for(t=0;t<M.dropzones.length;t++)n=M.dropzones[t],r=M.elements[t],r!==i&&(e.target=r,n.fire(e)),i=r}function tn(t){var i,o=t[0],u=o?0:-1,a,f=[],l=[],c,h,p;for(h=1;h<t.length;h++){i=t[h];if(!i||i===o)continue;if(!o){o=i,u=h;continue}if(i.parentNode===e)continue;if(o.parentNode===e){o=i,u=h;continue}if(!f.length){a=o;while(a.parentNode&&a.parentNode!==e)f.unshift(a),a=a.parentNode}if(o instanceof s&&i instanceof n&&!(i instanceof r)){if(i===o.parentNode)continue;a=i.ownerSVGElement}else a=i;l=[];while(a.parentNode!==e)l.unshift(a),a=a.parentNode;p=0;while(l[p]&&l[p]===f[p])p++;var d=[l[p-1],l[p],f[p]];c=d[0].lastChild;while(c){if(c===d[1]){o=i,u=h,f=[];break}if(c===d[2])break;c=c.previousSibling}}return u}function nn(e){var t=Zt(e,!0);M.dropzones=t.dropzones,M.elements=t.elements,M.rects=[];for(var n=0;n<M.dropzones.length;n++)M.rects[n]=M.dropzones[n].getRect(M.elements[n])}function rn(e,t){var n=[];Q&&nn(t);for(var r=0;r<M.dropzones.length;r++){var i=M.dropzones[r],s=M.elements[r],o=M.rects[r];n.push(i.dropCheck(e,H,t,o)?s:null)}var u=tn(n),a=M.dropzones[u]||null,f=M.elements[u]||null;return a&&a.selector&&(a._element=f),{dropzone:a,element:f}}function sn(e,t){var n=null,r=null,i=null,s=null,o=null,u=null;return j!==I&&(F&&(n=new on(e,"drag","leave",I,t.target),t.dragLeave=I),B&&(r=new on(e,"drag","enter",j,t.target),t.dragEnter=j)),t.type==="dragend"&&B&&(u=new on(e,"drop",null,j,t.target)),t.type==="dragstart"&&(i=new on(e,"drop","activate",null,t.target)),t.type==="dragend"&&(s=new on(e,"drop","deactivate",null,t.target)),t.type==="dragmove"&&B&&(o={target:j,relatedTarget:t.target,dragmove:t,type:"dropmove",timeStamp:t.timeStamp}),{enter:r,leave:n,activate:i,deactivate:s,move:o,drop:u}}function on(e,t,n,r,i){var s,o,a=(H&&H.options||q).deltaSource,f=a+"X",l=a+"Y",h=H?H.options:q,p=Ft(H,r),m=n==="start",b=n==="end";r=r||H._element;if(t==="gesture"){var E=Pt(g);o={x:E.pageX-p.x,y:E.pageY-p.y},s={x:E.clientX-p.x,y:E.clientY-p.y}}else o=At(e),s=Ot(e),o.x-=p.x,o.y-=p.y,s.x-=p.x,s.y-=p.y,Gt(H)&&(!m||!h.snap.elementOrigin)&&(this.snap={range:R.range,locked:R.locked,x:R.snappedX,y:R.snappedY,realX:R.realX,realY:R.realY,dx:R.dx,dy:R.dy},R.locked&&(o.x+=R.dx,o.y+=R.dy,s.x+=R.dx,s.y+=R.dy));Yt(H)&&(!m||!h.restrict.elementRect)&&U.restricted&&(o.x+=U.dx,o.y+=U.dy,s.x+=U.dx,s.y+=U.dy,this.restrict={dx:U.dx,dy:U.dy}),this.pageX=o.x,this.pageY=o.y,this.clientX=s.x,this.clientY=s.y,this.x0=d.pageX,this.y0=d.pageY,this.clientX0=d.clientX,this.clientY0=d.clientY,this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.button=e.button,this.target=r,this.t0=y,this.type=t+(n||""),this.interactable=H,k.active&&(this.detail="inertia"),i&&(this.relatedTarget=i),b||t==="drop"?a==="client"?(this.dx=s.x-d.clientX,this.dy=s.y-d.clientY):(this.dx=o.x-d.pageX,this.dy=o.y-d.pageY):n==="inertiastart"?(this.dx=w.dx,this.dy=w.dy):a==="client"?(this.dx=s.x-w.clientX,this.dy=s.y-w.clientY):(this.dx=o.x-w.pageX,this.dy=o.y-w.pageY),w&&w.detail==="inertia"&&!k.active&&h.inertia.zeroResumeDelta&&(k.resumeDx+=this.dx,k.resumeDy+=this.dy,this.dx=this.dy=0),t==="resize"?h.squareResize||e.shiftKey?(Y==="y"?this.dx=this.dy:this.dy=this.dx,this.axes="xy"):(this.axes=Y,Y==="x"?this.dy=0:Y==="y"&&(this.dx=0)):t==="gesture"&&(this.touches=u?[g[0],g[1]]:e.touches,m?(this.distance=Bt(g),this.box=Ht(g),this.scale=1,this.ds=0,this.angle=jt(g),this.da=0):b||e instanceof on?(this.distance=w.distance,this.box=w.box,this.scale=w.scale,this.ds=this.scale-1,this.angle=w.angle,this.da=this.angle-L.startAngle):(this.distance=Bt(g),this.box=Ht(g),this.scale=this.distance/L.startDistance,this.angle=jt(g,L.prevAngle),this.ds=this.scale-L.prevScale,this.da=this.angle-L.prevAngle));if(m)this.timeStamp=y,this.dt=0,this.duration=0,this.speed=0,this.velocityX=0,this.velocityY=0;else if(n==="inertiastart")this.timeStamp=(new Date).getTime(),this.dt=w.dt,this.duration=w.duration,this.speed=w.speed,this.velocityX=w.velocityX,this.velocityY=w.velocityY;else{this.timeStamp=(new Date).getTime(),this.dt=this.timeStamp-w.timeStamp,this.duration=this.timeStamp-y;var S,x,T;b||e instanceof on?(T=Math.max((b?this.duration:this.dt)/1e3,.001),S=this[f]-w[f],x=this[l]-w[l],this.snap&&this.snap.locked&&(S-=this.snap.dx,x-=this.snap.dy),this.restrict&&(S-=this.restrict.dx,x-=this.restrict.dy),w.snap&&w.snap.locked&&(S-=w[f]-w.snap.dx,x-=w[l]-w.snap.dy),w.restrict&&(S+=w.restrict.dx,x+=w.restrict.dy),this.speed=c(S,x)/T,this.velocityX=S/T,this.velocityY=x/T):(this.speed=v[a+"Speed"],this.velocityX=v[a+"VX"],this.velocityY=v[a+"VY"])}if((b||n==="inertiastart")&&w.speed>600&&this.timeStamp-w.timeStamp<150){var N=180*Math.atan2(w.velocityY,w.velocityX)/Math.PI,C=22.5;N<0&&(N+=360);var A=135-C<=N&&N<225+C,O=225-C<=N&&N<315+C,M=!A&&(315-C<=N||N<45+C),_=!O&&45-C<=N&&N<135+C;this.swipe={up:O,down:_,left:A,right:M,angle:N,speed:w.speed,velocity:{x:w.velocityX,y:w.velocityY}}}}function un(){this.originalEvent.preventDefault()}function an(e,t,n){var r={},i;Tt(r,e),r.preventDefault=un,r.stopPropagation=on.prototype.stopPropagation,r.stopImmediatePropagation=on.prototype.stopImmediatePropagation,r.timeStamp=(new Date).getTime(),r.originalEvent=e,r.dt=r.timeStamp-y,r.type="tap";var s=r.timeStamp-E,o=S&&S.type!=="doubletap"&&S.target===r.target&&s<500;E=r.timeStamp;for(i=0;i<t.length;i++){var u=Ft(t[i],n[i]);r.pageX-=u.x,r.pageY-=u.y,r.clientX-=u.x,r.clientY-=u.y,r.currentTarget=n[i],t[i].fire(r);if(r.immediatePropagationStopped||r.propagationStopped&&t[i+1]!==r.currentTarget)break}if(o){var a={};Tt(a,r),a.dt=s,a.type="doubletap";for(i=0;i<t.length;i++){a.currentTarget=n[i],t[i].fire(a);if(a.immediatePropagationStopped||a.propagationStopped&&t[i+1]!==a.currentTarget)break}S=a}else S=r}function fn(t){function u(t,i,u){var a=at?u.querySelectorAll(i):undefined;o!==e&&Vt(t,o)&&!$t(t,s)&&Jt(t,s)&&Rn(o,i,a)&&(n.push(t),r.push(o))}if(b)if($||!(t instanceof b.constructor)||b.target!==t.target)return;var n=[],r=[],s=t.target instanceof i?t.target.correspondingUseElement:t.target,o=s;while(o)Hn.isSet(o)&&(n.push(Hn(o)),r.push(o)),A.forEachSelector(u),o=o.parentNode;n.length&&an(t,n,r)}function ln(e){var t=this.getRect(),n,r,i=null,s=At(e),o=this.options;return t?(et.resize&&o.resizable&&(n=o.resizeAxis!=="y"&&s.x>t.right-X,r=o.resizeAxis!=="x"&&s.y>t.bottom-X),Y=(n?"x":"")+(r?"y":""),i=Y?"resize"+Y:et.drag&&o.draggable?"drag":null,et.gesture&&m.length>=2&&!K&&!G&&(i="gesture"),i):null}function cn(e,t){if(!xt(e))return null;t=t||H;var n=e.search("resize")!==-1?"resize":e,r=(t||H).options;if((n==="resize"&&r.resizable||e==="drag"&&r.draggable||e==="gesture"&&r.gesturable)&&et[n]){if(e==="resize"||e==="resizeyx")e="resizexy";return e}return null}function hn(t){function o(e,t,i){var s=at?i.querySelectorAll(t):undefined;Vt(e,r)&&!$t(e,n)&&Jt(e,n)&&Rn(r,t,s)&&(e._element=r,_.push(e))}if(tt&&b&&t.type!==b.type){Kt(t,H);return}if(b&&t.type==="mousedown"&&b.type==="touchstart"&&t.timeStamp-b.timeStamp<300)return;V=!0;var n=t.target instanceof i?t.target.correspondingUseElement:t.target,r=n,s;gn(t);if(k.active&&H.selector)while(r&&r!==e){if(r===k.targetElement&&cn(H.getAction(t))===tt){lt(k.i),k.active=!1,gn(t,D);return}r=r.parentNode}if(K||G||J)return;if(_.length&&/mousedown|pointerdown/i.test(t.type))s=kn(t,_);else while(r&&r!==e&&!s)_=[],A.forEachSelector(o),s=kn(t,_),r=r.parentNode;if(s)return tt=s,pn(t,s);y=(new Date).getTime(),b=Nt(t),Ct(h,t),$=!1}function pn(t,n){if(!n&&V&&b&&t.type!==b.type){Kt(t,H);return}V=!0,gn(t);if((t.touches&&t.touches.length<2||m&&m.length<2)&&!H||!tt){var r=A.get(t.currentTarget);!$t(r,t.target)&&Jt(r,t.target)&&(H=r)}var i=H&&H.options;if(H&&!(K||G||J)){var s=cn(n||H.getAction(t));Ct(d,t),u&&t instanceof u&&(H._gesture.target||(H._gesture.target=H._element),gn(t,H._gesture));if(!s)return t;i.styleCursor&&(e.documentElement.style.cursor=Z[s].cursor),Y=s==="resizexy"?"xy":s==="resizex"?"x":s==="resizey"?"y":"",s==="gesture"&&(t.touches&&t.touches.length<2||u&&m.length<2)&&(s=null),tt=s,R.snappedX=R.snappedY=U.restrictedX=U.restrictedY=NaN,y=(new Date).getTime(),b=Nt(t),Ct(h,t),$=!1,Kt(t,H)}else k.active&&t.currentTarget===k.targetElement&&H===k.target&&cn(H.getAction(t))===tt&&(lt(k.i),k.active=!1,u&&(H._gesture.target||(H._gesture.target=H._element),gn(t,H._gesture)))}function dn(e,t){var n=H.options.snap,r=n.anchors,i,s,o,u,a,f,l,h,p,d;t=t||R;if(t.useStatusXY)i={x:t.x,y:t.y};else{var v=Ft(H);i=At(e),i.x-=v.x,i.y-=v.y}i.x-=k.resumeDx,i.y-=k.resumeDy,t.realX=i.x,t.realY=i.y,n.range<0&&(n.range=Infinity);if(n.mode==="path"){r=[];for(p=0,d=n.paths.length;p<d;p++){var m=n.paths[p];wt(m)&&(m=m(i.x,i.y)),r.push({x:Et(m.x)?m.x:i.x,y:Et(m.y)?m.y:i.y,range:Et(m.range)?m.range:n.range})}}if(n.mode!=="anchor"&&n.mode!=="path"||!r.length){if(n.mode==="grid"){var y=Math.round((i.x-n.gridOffset.x-N.x)/n.grid.x),b=Math.round((i.y-n.gridOffset.y-N.y)/n.grid.y),w=y*n.grid.x+n.gridOffset.x+N.x,E=b*n.grid.y+n.gridOffset.y+N.y;f=w-i.x,l=E-i.y,h=c(f,l),u=h<n.range,a=w!==t.snappedX||E!==t.snappedY,t.snappedX=w,t.snappedY=E,t.dx=f,t.dy=l,t.range=n.range}}else{s={anchor:null,distance:0,range:0,dx:0,dy:0};for(p=0,d=r.length;p<d;p++){var g=r[p];o=Et(g.range)?g.range:n.range,f=g.x-i.x+N.x,l=g.y-i.y+N.y,h=c(f,l),u=h<o,o===Infinity&&s.inRange&&s.range!==Infinity&&(u=!1);if(!s.anchor||(u?s.inRange&&o!==Infinity?h/o<s.distance/s.range:h<s.distance:!s.inRange&&h<s.distance))o===Infinity&&(u=!0),s.anchor=g,s.distance=h,s.range=o,s.inRange=u,s.dx=f,s.dy=l,t.range=o}u=s.inRange,a=s.anchor.x!==t.x||s.anchor.y!==t.y,t.snappedX=s.anchor.x,t.snappedY=s.anchor.y,t.dx=s.dx,t.dy=s.dy}return t.changed=a||u&&!t.locked,t.locked=u,t}function vn(e,t){var n=H&&H.options.restrict,r=n&&n[tt],i;if(!r)return t;t=t||U,i=t.useStatusXY?i={x:t.x,y:t.y}:i=At(e),t.snap&&t.snap.locked&&(i.x+=t.snap.dx||0,i.y+=t.snap.dy||0),i.x-=k.resumeDx,i.y-=k.resumeDy,t.dx=0,t.dy=0,t.restricted=!1;var s;r==="parent"?r=H._element.parentNode:r==="self"&&(r=H._element),gt(r)?s=_t(r):(wt(r)&&(r=r(i.x,i.y,H._element)),s=r,"x"in r&&"y"in r&&(s={left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height}));var o=Math.max(Math.min(s.right-T.right,i.x),s.left+T.left),u=Math.max(Math.min(s.bottom-T.bottom,i.y),s.top+T.top);return t.dx=o-i.x,t.dy=u-i.y,t.changed=t.restrictedX!==o||t.restrictedY!==u,t.restricted=!!t.dx||!!t.dy,t.restrictedX=o,t.restrictedY=u,t}function mn(t,n){if(!V)return;t instanceof on||Ct(p,t);var r,s;$||(r=p.clientX-d.clientX,s=p.clientY-d.clientY,$=c(r,s)>q.pointerMoveTolerance);if(!tt||t.type==="mousemove"&&b.type==="touchstart")return;if($&&(!k.active||t instanceof on&&/inertiastart/.test(t.type))){if(!(K||G||J)){kt(v,h,p);if(tt==="drag"){var o=Math.abs(r),u=Math.abs(s),a=H.options.dragAxis,f=o>u?"x":o<u?"y":"xy";if(f!=="xy"&&a!=="xy"&&a!==f){tt=null;var l=t.target instanceof i?t.target.correspondingUseElement:t.target,m=l;while(m&&m!==e){var g=A.get(m);if(g&&g!==H&&g.getAction(b)==="drag"&&Qt(f,g)){tt="drag",H=g;break}m=m.parentNode}if(!tt){var y=function(e,t,n){var r=at?n.querySelectorAll(t):undefined;if(e===H)return;e._element=m;if(Vt(e,l)&&!$t(e,l)&&Jt(e,l)&&Rn(m,t,r)&&e.getAction(b)==="drag"&&Qt(f,e))return e};m=l;while(m&&m!==e){var E=A.forEachSelector(y);if(E){tt="drag",H=E;break}m=m.parentNode}}}}}if(tt&&H){var S=Gt(H)&&(!H.options.snap.endOnly||n),C=Yt(H)&&(!H.options.restrict.endOnly||n),L=!(K||G||J),O=L?b:t;if(L){w=b;var M=H.getRect(),_=H.options.snap,D=H.options.restrict;M?(x.left=d.pageX-M.left,x.top=d.pageY-M.top,x.right=M.right-d.pageX,x.bottom=M.bottom-d.pageY):x.left=x.top=x.right=x.bottom=0,M&&_.elementOrigin?(N.x=x.left-M.width*_.elementOrigin.x,N.y=x.top-M.height*_.elementOrigin.y):N.x=N.y=0,M&&D.elementRect?(T.left=x.left-M.width*D.elementRect.left,T.top=x.top-M.height*D.elementRect.top,T.right=x.right-M.width*(1-D.elementRect.right),T.bottom=x.bottom-M.height*(1-D.elementRect.bottom)):T.left=T.top=T.right=T.bottom=0}S?dn(O):R.locked=!1,C?vn(O):U.restricted=!1;var P=(S?R.changed||!R.locked:!0)&&(C?!U.restricted||U.restricted&&U.changed:!0);P&&(L&&(w=Z[tt].start(b),S&&dn(t),C&&vn(t)),w=Z[tt].move(t))}}t instanceof on||(kt(v,h,p),Ct(h,t)),(K||G)&&z.edgeMove(t)}function gn(e,t,n){n=n||e.type;if(/touch/.test(e.type)){var r=/cancel|touchend/.test(n)?e.changedTouches:e.touches;for(var i=0;i<r.length;i++)gn(r[i],t,n);return}if(m.length&&g[0].pointerType!==e.pointerType)return;var s=e.pointerId||e.identifier||0;t&&t.addPointer(s);var o=In(m,s);o===-1?(m.push(s),g[m.length-1]=e):g[o]=e}function yn(e){var t=In(m,e.pointerId||e.identifier||0);if(t===-1)return;m.splice(t,1)}function bn(e,t){var n=In(m,e.pointerId||e.identifier||0);if(n===-1)return;t=t||e.type,/move/i.test(t)?g[n]=e:/up|end|cancel/i.test(t)&&(yn(e),J&&H._gesture&&m.length<2&&H._gesture.stop())}function wn(e){var t=/cancel|touchend/.test(e.type)?e.changedTouches:e.touches;for(var n=0;n<t.length;n++)bn(t[n],e.type);return}function En(e){var t=new on(e,"drag","start");K=!0,H.fire(t),M.dropzones=[],M.elements=[],M.rects=[],Q||nn(H._element);var n=sn(e,t);return n.activate&&en(n.activate),t}function Sn(e){Kt(e,H);var t=new on(e,"drag","move"),n=H._element,r=rn(t,n);B=r.dropzone,j=r.element,H._element=n;var i=sn(e,t);return H.fire(t),i.leave&&F.fire(i.leave),i.enter&&B.fire(i.enter),i.move&&B.fire(i.move),F=B,I=j,t}function xn(e){var t=new on(e,"resize","start");return H.fire(t),H.fire(t),G=!0,t}function Tn(e){Kt(e,H);var t;return t=new on(e,"resize","move"),H.fire(t),t}function Nn(e){var t=new on(e,"gesture","start");return t.ds=0,L.startDistance=L.prevDistance=t.distance,L.startAngle=L.prevAngle=t.angle,L.scale=1,J=!0,H.fire(t),t}function Cn(e){if(!m.length)return w;Kt(e,H);var t;return t=new on(e,"gesture","move"),t.ds=t.scale-L.scale,H.fire(t),L.prevAngle=t.angle,L.prevDistance=t.distance,t.scale!==Infinity&&t.scale!==null&&t.scale!==undefined&&!isNaN(t.scale)&&(L.scale=t.scale),t}function kn(e,t){for(var n=0,r=t.length;n<r;n++){var i=t[n],s=cn(i.getAction(e,i),i);if(s)return H=i,s}}function Ln(e){function u(e,n){e&&Vt(e,r)&&!$t(e,r)&&Jt(e,r)&&Rn(r,n)&&(e._element=r,t.push(e))}if(tt)return;var t=[],n=H&&H._element,r=e.target instanceof i?e.target.correspondingUseElement:e.target;H&&($t(H,r)||!Jt(H,r))&&(H=null,_=[]);var s=A.get(r),o=s&&!$t(s,r)&&Jt(s,r)&&cn(s.getAction(e),s);if(o)H=s,_=[];else{A.forEachSelector(u);if(kn(e,t))_=t,On(e,_),vt.addToElement(r,"mousemove",On);else if(H){var a=n.querySelectorAll("*");if(qn(a,r)){for(var f=0;f<_.length;f++)_[f]._element=n;On(e,_),vt.addToElement(H._element,"mousemove",On)}else H=null,_=[]}}}function An(t){if(tt)return;var n=t.target instanceof i?t.target.correspondingUseElement:t.target;A.get(n)||vt.removeFromElement(n,On),H&&H.options.styleCursor&&!(K||G||J)&&(e.documentElement.style.cursor="")}function On(t,n){if(!tt){var r;n?r=kn(t,n):H&&(r=cn(H.getAction(t))),H&&H.options.styleCursor&&(r?e.documentElement.style.cursor=Z[r].cursor:e.documentElement.style.cursor="")}else tt&&Kt(t,H)}function Mn(e){if(!(e instanceof on||u)&&V&&b&&!(e instanceof b.constructor))return;if(e.touches&&e.touches.length>=2)return;if(a&&e instanceof a&&/inertiastart/i.test(e.type)){e.gestureObject.stop();return}var t,n=H&&H.options,r=n&&n.inertia;if(K||G||J){if(k.active)return;var i=n.deltaSource,s=v[i+"Speed"],o=(new Date).getTime(),f=!1,l=!1,c=!1,h=Gt(H)&&n.snap.endOnly,d=Yt(H)&&n.restrict.endOnly,m=0,g=0,y;f=n.inertiaEnabled&&tt!=="gesture"&&qn(r.actions,tt)&&e!==k.startEvent,l=f&&o-p.timeStamp<50&&s>r.minSpeed&&s>r.endSpeed;if(f&&!l&&(h||d)){var w={};w.snap=w.restrict=w,h&&(dn(e,w),w.locked&&(m+=w.dx,g+=w.dy)),d&&(vn(e,w),w.restricted&&(m+=w.dx,g+=w.dy));if(m||g)c=!0}if(l||c){vt.useAttachEvent?Tt(k.pointerUp,e):k.pointerUp=e,k.startEvent=y=new on(e,tt,"inertiastart"),H.fire(k.startEvent),k.target=H,k.targetElement=H._element,k.t0=o;if(l){k.vx0=v[i+"VX"],k.vy0=v[i+"VY"],k.v0=s,It(k);var E=At(e),S=Ft(H,H._element),x;E.x=E.x+(l?k.xe:0)-S.x,E.y=E.y+(l?k.ye:0)-S.y,x={useStatusXY:!0,x:E.x,y:E.y,dx:0,dy:0,snap:null},x.snap=x,m=g=0;if(h){var T=dn(e,x);T.locked&&(m+=T.dx,g+=T.dy)}if(d){var N=vn(e,x);N.restricted&&(m+=N.dx,g+=N.dy)}k.modifiedXe+=m,k.modifiedYe+=g,k.i=ft(qt)}else k.smoothEnd=!0,k.xe=m,k.ye=g,k.sx=k.sy=0,k.i=ft(Rt);k.active=!0;return}(h||d)&&mn(e,!0)}if(K){t=new on(e,"drag","end");var C,L=H._element,A=rn(t,L);B=A.dropzone,j=A.element,H._element=L;if(B)C=new on(e,"drop",null,j,L),t.dropzone=j;else if(F){var O=new on(e,"drag","leave",j,L);F.fire(O,L),t.dragLeave=I}var M=sn(e,t);H.fire(t),M.leave&&F.fire(M.leave),M.enter&&B.fire(M.enter),M.drop&&B.fire(M.drop),M.deactivate&&en(M.deactivate)}else G?(t=new on(e,"resize","end"),H.fire(t)):J&&(t=new on(e,"gesture","end"),H.fire(t));Hn.stop()}function _n(n,r){var i={},s=P[n.type],o=n.target;r=r?!0:!1;for(var u in n)i[u]=n[u];i.originalEvent=n,i.preventDefault=un;while(o&&o!==e){for(var a=0;a<s.selectors.length;a++){var f=s.selectors[a],l=s.contexts[a];if(Rn(o,f)&&l===n.currentTarget&&Xt(l,o)){var c=s.listeners[a];i.currentTarget=o;for(var h=0;h<c.length;h++){if(c[h][1]!==r)continue;try{c[h][0](i)}catch(p){t.error('Error thrown from delegated listener: "'+f+'" '+n.type+" "+(c[h][0].name?c[h][0].name:"")),t.log(p)}}}}o=o.parentNode}}function Dn(e){return _n.call(this,e,!0)}function Pn(){H&&!H.selector&&(H=null),B=j=F=I=null}function Hn(e,t){return A.get(e,t)||new jn(e,t)}function Bn(e){for(var t in q)e.hasOwnProperty(t)&&typeof e[t]==typeof q[t]&&(this[t]=e[t])}function jn(t,n){this._element=t,this._iEvents=this._iEvents||{},xt(t)?(e.querySelector(t),this.selector=t,this._gesture=D,n&&n.context&&(window.Node?n.context instanceof window.Node:gt(n.context)||n.context===e)&&(this._context=n.context)):gt(t)&&(u?(vt.add(this,f.down,pn),vt.add(this,f.move,On),this._gesture=new o,this._gesture.target=t):(vt.add(this,"mousedown",pn),vt.add(this,"mousemove",On),vt.add(this,"touchstart",pn),vt.add(this,"touchmove",On))),A.push(this),this.set(n)}function In(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function qn(e,t){return In(e,t)!==-1}function Rn(e,t,n){return at?at(e,t,n):e[ut](t)}var e=window.document,t=window.console,n=window.SVGElement||mt,r=window.SVGSVGElement||mt,i=window.SVGElementInstance||mt,s=window.HTMLElement||window.Element,o=window.Gesture||window.MSGesture,u=o&&(window.PointerEvent||window.MSPointerEvent),a=o&&(window.GestureEvent||window.MSGestureEvent),f,l,c=Math.hypot||function(e,t){return Math.sqrt(e*e+t*t)},h={pageX:0,pageY:0,clientX:0,clientY:0,timeStamp:0},p={pageX:0,pageY:0,clientX:0,clientY:0,timeStamp:0},d={pageX:0,pageY:0,clientX:0,clientY:0,timeStamp:0},v={pageX:0,pageY:0,clientX:0,clientY:0,pageSpeed:0,clientSpeed:0,timeStamp:0},m=[],g=[],y=0,b=null,w=null,E=0,S=null,x={left:0,right:0,top:0,bottom:0},T={left:0,right:0,top:0,bottom:0},N={x:0,y:0},C={},k={active:!1,smoothEnd:!1,target:null,targetElement:null,startEvent:null,pointerUp:{},xe:0,ye:0,sx:0,sy:0,t0:0,vx0:0,vys:0,duration:0,resumeDx:0,resumeDy:0,lambda_v0:0,one_ve_v0:0,i:null},L={start:{x:0,y:0},startDistance:0,prevDistance:0,distance:0,scale:1,startAngle:0,prevAngle:0},A=[],O=[],M={dropzones:[],elements:[],rects:[]},_=[],D=null,P={},H=null,B=null,j=null,F=null,I=null,q={draggable:!1,dragAxis:"xy",dropzone:!1,accept:null,resizable:!1,squareResize:!1,resizeAxis:"xy",gesturable:!1,pointerMoveTolerance:1,actionChecker:null,styleCursor:!0,preventDefault:"auto",snap:{mode:"grid",endOnly:!1,actions:["drag"],range:Infinity,grid:{x:100,y:100},gridOffset:{x:0,y:0},anchors:[],paths:[],elementOrigin:null,arrayTypes:/^anchors$|^paths$|^actions$/,objectTypes:/^grid$|^gridOffset$|^elementOrigin$/,stringTypes:/^mode$/,numberTypes:/^range$/,boolTypes:/^endOnly$/},snapEnabled:!1,restrict:{drag:null,resize:null,gesture:null,endOnly:!1},restrictEnabled:!1,autoScroll:{container:window,margin:60,speed:300,numberTypes:/^margin$|^speed$/},autoScrollEnabled:!1,inertia:{resistance:10,minSpeed:100,endSpeed:10,zeroResumeDelta:!1,smoothEndDuration:300,actions:["drag","resize"],numberTypes:/^resistance$|^minSpeed$|^endSpeed$|^smoothEndDuration$/,arrayTypes:/^actions$/,boolTypes:/^zeroResumeDelta$/},inertiaEnabled:!1,origin:{x:0,y:0},deltaSource:"page",context:e},R={x:0,y:0,dx:0,dy:0,realX:0,realY:0,snappedX:0,snappedY:0,anchors:[],paths:[],locked:!1,changed:!1},U={dx:0,dy:0,restrictedX:0,restrictedY:0,snap:R,restricted:!1,changed:!1},z={target:null,i:null,x:0,y:0,scroll:function(){var e=z.target.options.autoScroll,t=e.container,n=(new Date).getTime(),r=(n-z.prevTime)/1e3,i=e.speed*r;i>=1&&(t instanceof window.Window?t.scrollBy(z.x*i,z.y*i):t&&(t.scrollLeft+=z.x*i,t.scrollTop+=z.y*i),z.prevTime=n),z.isScrolling&&(lt(z.i),z.i=ft(z.scroll))},edgeMove:function(e){if(H&&H.options.autoScrollEnabled&&(K||G)){var t,n,r,i,s=H.options.autoScroll;if(s.container instanceof window.Window)i=e.clientX<z.margin,t=e.clientY<z.margin,n=e.clientX>s.container.innerWidth-z.margin,r=e.clientY>s.container.innerHeight-z.margin;else{var o=_t(s.container);i=e.clientX<o.left+z.margin,t=e.clientY<o.top+z.margin,n=e.clientX>o.right-z.margin,r=e.clientY>o.bottom-z.margin}z.x=n?1:i?-1:0,z.y=r?1:t?-1:0,z.isScrolling||(z.margin=s.margin,z.speed=s.speed,z.start(H))}},isScrolling:!1,prevTime:0,start:function(e){z.isScrolling=!0,lt(z.i),z.target=e,z.prevTime=(new Date).getTime(),z.i=ft(z.scroll)},stop:function(){z.isScrolling=!1,lt(z.i)}},W="ontouchstart"in window||window.DocumentTouch&&e instanceof window.DocumentTouch,X=W?20:10,V=!1,$=!1,J=!1,K=!1,Q=!1,G=!1,Y="xy",Z={drag:{cursor:"move",start:En,move:Sn},resizex:{cursor:"e-resize",start:xn,move:Tn},resizey:{cursor:"s-resize",start:xn,move:Tn},resizexy:{cursor:"se-resize",start:xn,move:Tn},gesture:{cursor:"",start:Nn,move:Cn}},et={drag:!0,resize:!0,gesture:!0},tt=null,nt="onmousewheel"in e?"mousewheel":"wheel",rt=["dragstart","dragmove","draginertiastart","dragend","dragenter","dragleave","dropactivate","dropdeactivate","dropmove","drop","resizestart","resizemove","resizeinertiastart","resizeend","gesturestart","gesturemove","gestureinertiastart","gestureend","tap","doubletap"],it={},st={directBind:0,onevent:1,globalBind:2},ot=navigator.appName=="Opera"&&W&&navigator.userAgent.match("Presto"),ut="matchesSelector"in Element.prototype?"matchesSelector":"webkitMatchesSelector"in Element.prototype?"webkitMatchesSelector":"mozMatchesSelector"in Element.prototype?"mozMatchesSelector":"oMatchesSelector"in Element.prototype?"oMatchesSelector":"msMatchesSelector",at,ft=window.requestAnimationFrame,lt=window.cancelAnimationFrame,ct={_element:window,events:{}},ht={_element:e,events:{}},pt={_element:window.parent,events:{}},dt={_element:null,events:{}},vt=function(){function a(r,a,f,p){var d=In(s,r),v=o[d];v||(v={events:{},typeCount:0},d=s.push(r)-1,o.push(v),u.push(t?{supplied:[],wrapped:[],useCount:[]}:null)),v.events[a]||(v.events[a]=[],v.typeCount++);if(!qn(v.events[a],f)){var m;if(t){var g=u[d],y=In(g.supplied,f),b=g.wrapped[y]||function(t){t.immediatePropagationStopped||(t.target=t.srcElement,t.currentTarget=r,t.preventDefault=t.preventDefault||l,t.stopPropagation=t.stopPropagation||c,t.stopImmediatePropagation=t.stopImmediatePropagation||h,/mouse|click/.test(t.type)&&(t.pageX=t.clientX+e.documentElement.scrollLeft,t.pageY=t.clientY+e.documentElement.scrollTop),f(t))};m=r[n](i+a,b,Boolean(p)),y===-1?(g.supplied.push(f),g.wrapped.push(b),g.useCount.push(1)):g.useCount[y]++}else m=r[n](a,f,p||!1);return v.events[a].push(f),m}}function f(e,n,a,l){var c,h=In(s,e),p=o[h],d,v,m=a;if(!p||!p.events)return;t&&(d=u[h],v=In(d.supplied,a),m=d.wrapped[v]);if(n==="all"){for(n in p.events)p.events.hasOwnProperty(n)&&f(e,n,"all");return}if(p.events[n]){var g=p.events[n].length;if(a==="all")for(c=0;c<g;c++)f(e,n,p.events[n][c],Boolean(l));else for(c=0;c<g;c++)if(p.events[n][c]===a){e[r](i+n,m,l||!1),p.events[n].splice(c,1),t&&d&&(d.useCount[v]--,d.useCount[v]===0&&(d.supplied.splice(v,1),d.wrapped.splice(v,1),d.useCount.splice(v,1)));break}p.events[n]&&p.events[n].length===0&&(p.events[n]=null,p.typeCount--)}p.typeCount||(o.splice(h),s.splice(h),u.splice(h))}function l(){this.returnValue=!1}function c(){this.cancelBubble=!0}function h(){this.cancelBubble=!0,this.immediatePropagationStopped=!0}var t="attachEvent"in window&&!("addEventListener"in window),n=t?"attachEvent":"addEventListener",r=t?"detachEvent":"removeEventListener",i=t?"on":"",s=[],o=[],u=[];return{add:function(e,t,n,r){a(e._element,t,n,r)},remove:function(e,t,n,r){f(e._element,t,n,r)},addToElement:a,removeFromElement:f,useAttachEvent:t,indexOf:In}}();on.prototype={preventDefault:mt,stopImmediatePropagation:function(){this.immediatePropagationStopped=this.propagationStopped=!0},stopPropagation:function(){this.propagationStopped=!0}},A.indexOfElement=O.indexOfElement=function(n,r){for(var i=0;i<this.length;i++){var s=this[i];if(s.selector===n&&s._context===(r||e)||!s.selector&&s._element===n)return i}return-1},A.get=O.get=function(t,n){return this[this.indexOfElement(t,n&&n.context)]},A.forEachSelector=function(e){for(var t=0;t<this.length;t++){var n=this[t];if(!n.selector)continue;var r=e(n,n.selector,n._context,t,this);if(r!==undefined)return r}},Bn.prototype=q,jn.prototype={setOnEvents:function(e,t){if(e==="drop"){var n=t.ondrop||t.onDrop||t.drop,r=t.ondropactivate||t.onDropActivate||t.dropactivate,i=t.ondropdeactivate||t.onDropDeactivate||t.dropdeactivate,s=t.ondragenter||t.onDropEnter||t.dragenter,o=t.ondragleave||t.onDropLeave||t.dragleave,u=t.ondropmove||t.onDropMove||t.dropmove;wt(n)&&(this.ondrop=n),wt(r)&&(this.ondropactivate=r),wt(i)&&(this.ondropdeactivate=i),wt(s)&&(this.ondragenter=s),wt(o)&&(this.ondragleave=o),wt(u)&&(this.ondropmove=u)}else{var a=t.onstart||t.onStart||t.start,f=t.onmove||t.onMove||t.move,l=t.onend||t.onEnd||t.end,c=t.oninertiastart||t.onInertiaStart||t.inertiastart;e="on"+e,wt(a)&&(this[e+"start"]=a),wt(f)&&(this[e+"move"]=f),wt(l)&&(this[e+"end"]=l),wt(c)&&(this[e+"inertiastart"]=c)}return this},draggable:function(e){return yt(e)?(this.options.draggable=!0,this.setOnEvents("drag",e),/^x$|^y$|^xy$/.test(e.axis)?this.options.dragAxis=e.axis:e.axis===null&&delete this.options.dragAxis,this):St(e)?(this.options.draggable=e,this):e===null?(delete this.options.draggable,this):this.options.draggable},dropzone:function(e){if(yt(e))return this.options.dropzone=!0,this.setOnEvents("drop",e),this.accept(e.accept),this._dropElements=this.selector?null:[this._element],O.push(this),this;if(St(e)){if(e)this._dropElements=this.selector?null:[this._element],O.push(this);else{var t=In(O,this);t!==-1&&O.splice(t,1)}return this.options.dropzone=e,this}return e===null?(delete this.options.dropzone,this):this.options.dropzone},dropCheck:function(e,t,n,r){if(!(r=r||this.getRect()))return!1;var i=At(e),s=Ft(t,n),o,u;return i.x+=s.x,i.y+=s.y,o=i.x>r.left&&i.x<r.right,u=i.y>r.top&&i.y<r.bottom,o&&u},dropChecker:function(e){return wt(e)?(this.dropCheck=e,this):this.dropCheck},accept:function(t){return gt(t)?(this.options.accept=t,this):xt(t)?(e.querySelector(t),this.options.accept=t,this):t===null?(delete this.options.accept,this):this.options.accept},resizable:function(e){return yt(e)?(this.options.resizable=!0,this.setOnEvents("resize",e),/^x$|^y$|^xy$/.test(e.axis)?this.options.resizeAxis=e.axis:e.axis===null&&(this.options.resizeAxis=q.resizeAxis),this):St(e)?(this.options.resizable=e,this):this.options.resizable},resizeable:mt,squareResize:function(e){return St(e)?(this.options.squareResize=e,this):e===null?(delete this.options.squareResize,this):this.options.squareResize},gesturable:function(e){return yt(e)?(this.options.gesturable=!0,this.setOnEvents("gesture",e),this):St(e)?(this.options.gesturable=e,this):e===null?(delete this.options.gesturable,this):this.options.gesturable},gestureable:mt,autoScroll:function(e){var t=q.autoScroll;if(yt(e)){var n=this.options.autoScroll;return n===t&&(n=this.options.autoScroll={margin:t.margin,distance:t.distance,interval:t.interval,container:t.container}),n.margin=this.validateSetting("autoScroll","margin",e.margin),n.speed=this.validateSetting("autoScroll","speed",e.speed),n.container=gt(e.container)||e.container instanceof window.Window?e.container:t.container,this.options.autoScrollEnabled=!0,this.options.autoScroll=n,this}return St(e)?(this.options.autoScrollEnabled=e,this):e===null?(delete this.options.autoScrollEnabled,delete this.options.autoScroll,this):this.options.autoScrollEnabled?this.options.autoScroll:!1},snap:function(e){var t=q.snap;if(yt(e)){var n=this.options.snap;return n===t&&(n={}),n.mode=this.validateSetting("snap","mode",e.mode),n.endOnly=this.validateSetting("snap","endOnly",e.endOnly),n.actions=this.validateSetting("snap","actions",e.actions),n.range=this.validateSetting("snap","range",e.range),n.paths=this.validateSetting("snap","paths",e.paths),n.grid=this.validateSetting("snap","grid",e.grid),n.gridOffset=this.validateSetting("snap","gridOffset",e.gridOffset),n.anchors=this.validateSetting("snap","anchors",e.anchors),n.elementOrigin=this.validateSetting("snap","elementOrigin",e.elementOrigin),this.options.snapEnabled=!0,this.options.snap=n,this}return St(e)?(this.options.snapEnabled=e,this):e===null?(delete this.options.snapEnabled,delete this.options.snap,this):this.options.snapEnabled?this.options.snap:!1},inertia:function(e){var t=q.inertia;if(yt(e)){var n=this.options.inertia;return n===t&&(n=this.options.inertia={resistance:t.resistance,minSpeed:t.minSpeed,endSpeed:t.endSpeed,actions:t.actions,zeroResumeDelta:t.zeroResumeDelta,smoothEndDuration:t.smoothEndDuration}),n.resistance=this.validateSetting("inertia","resistance",e.resistance),n.minSpeed=this.validateSetting("inertia","minSpeed",e.minSpeed),n.endSpeed=this.validateSetting("inertia","endSpeed",e.endSpeed),n.actions=this.validateSetting("inertia","actions",e.actions),n.zeroResumeDelta=this.validateSetting("inertia","zeroResumeDelta",e.zeroResumeDelta),n.smoothEndDuration=this.validateSetting("inertia","smoothEndDuration",e.smoothEndDuration),this.options.inertiaEnabled=!0,this.options.inertia=n,this}return St(e)?(this.options.inertiaEnabled=e,this):e===null?(delete this.options.inertiaEnabled,delete this.options.inertia,this):this.options.inertiaEnabled?this.options.inertia:!1},getAction:function(e){var t=this.defaultActionChecker(e);return this.options.actionChecker&&(t=this.options.actionChecker(e,t,this)),t},defaultActionChecker:ln,actionChecker:function(e){return wt(e)?(this.options.actionChecker=e,this):e===null?(delete this.options.actionChecker,this):this.options.actionChecker},getRect:function(t){return t=t||this._element,this.selector&&!gt(t)&&(t=this._context.querySelector(this.selector)),_t(t)},rectChecker:function(e){return wt(e)?(this.getRect=e,this):e===null?(delete this.options.getRect,this):this.getRect},styleCursor:function(e){return St(e)?(this.options.styleCursor=e,this):e===null?(delete this.options.styleCursor,this):this.options.styleCursor},preventDefault:function(e){return St(e)||e==="auto"?(this.options.preventDefault=e,this):e===null?(delete this.options.preventDefault,this):this.options.preventDefault},origin:function(e){return yt(e)||/^parent$|^self$/.test(e)?(this.options.origin=e,this):e===null?(delete this.options.origin,this):this.options.origin},deltaSource:function(e){return e==="page"||e==="client"?(this.options.deltaSource=e,this):e===null?(delete this.options.deltaSource,this):this.options.deltaSource},restrict:function(e){if(e===undefined)return this.options.restrict;if(St(e))q.restrictEnabled=e;else if(yt(e)){var t={};if(yt(e.drag)||/^parent$|^self$/.test(e.drag))t.drag=e.drag;if(yt(e.resize)||/^parent$|^self$/.test(e.resize))t.resize=e.resize;if(yt(e.gesture)||/^parent$|^self$/.test(e.gesture))t.gesture=e.gesture;St(e.endOnly)&&(t.endOnly=e.endOnly),yt(e.elementRect)&&(t.elementRect=e.elementRect),this.options.restrictEnabled=!0,this.options.restrict=t}else e===null&&(delete this.options.restrict,delete this.options.restrictEnabled);return this},context:function(){return this._context},_context:e,ignoreFrom:function(t){return xt(t)?(e.querySelector(t),this.options.ignoreFrom=t,this):gt(t)?(this.options.ignoreFrom=t,this):t===null?(delete this.options.ignoreFrom,this):this.options.ignoreFrom},allowFrom:function(t){return xt(t)?(e.querySelector(t),this.options.allowFrom=t,this):gt(t)?(this.options.allowFrom=t,this):t===null?(delete this.options.allowFrom,this):this.options.allowFrom},validateSetting:function(e,t,n){var r=q[e],i=this.options[e];if(r!==undefined&&r[t]!==undefined){if("objectTypes"in r&&r.objectTypes.test(t))return yt(n)?n:t in i&&yt(i[t])?i[t]:r[t];if("arrayTypes"in r&&r.arrayTypes.test(t))return bt(n)?n:t in i&&bt(i[t])?i[t]:r[t];if("stringTypes"in r&&r.stringTypes.test(t))return xt(n)?n:t in i&&xt(i[t])?i[t]:r[t];if("numberTypes"in r&&r.numberTypes.test(t))return Et(n)?n:t in i&&Et(i[t])?i[t]:r[t];if("boolTypes"in r&&r.boolTypes.test(t))return St(n)?n:t in i&&St(i[t])?i[t]:r[t];if("elementTypes"in r&&r.elementTypes.test(t))return gt(n)?n:t in i&&gt(i[t])?i[t]:r[t]}return null},element:function(){return this._element},fire:function(e){if(!e||!e.type||!qn(rt,e.type))return this;var n,r=0,i=0,s,o="on"+e.type;while(r<3)try{switch(r){case st.directBind:if(e.type in this._iEvents){n=this._iEvents[e.type];for(s=n.length;i<s&&!e.immediatePropagationStopped;i++)n[i](e);break}break;case st.onevent:wt(this[o])&&this[o](e);break;case st.globalBind:if(e.type in it&&(n=it[e.type]))for(s=n.length;i<s&&!e.immediatePropagationStopped;i++)n[i](e)}if(e.propagationStopped)break;i=0,r++}catch(u){t.error("Error thrown from "+e.type+" listener"),t.error(u),i++,r===st.onevent&&r++}return this},on:function(e,t,n){e==="wheel"&&(e=nt),n=n?!0:!1;if(qn(rt,e))e in this._iEvents?qn(this._iEvents[e],t)||this._iEvents[e].push(t):this._iEvents[e]=[t];else if(this.selector){P[e]||(P[e]={selectors:[],contexts:[],listeners:[]},vt.addToElement(this._context,e,_n),vt.addToElement(this._context,e,Dn,!0));var r=P[e],i;for(i=r.selectors.length-1;i>=0;i--)if(r.selectors[i]===this.selector&&r.contexts[i]===this._context)break;i===-1&&(i=r.selectors.length,r.selectors.push(this.selector),r.contexts.push(this._context),r.listeners.push([])),r.listeners[i].push([t,n])}else vt.add(this,e,t,n);return this},off:function(e,t,n){var r,i=-1;n=n?!0:!1,e==="wheel"&&(e=nt);if(qn(rt,e))r=this._iEvents[e],r&&(i=In(r,t))!==-1&&this._iEvents[e].splice(i,1);else if(this.selector){var s=P[e],o=!1;if(!s)return this;for(i=s.selectors.length-1;i>=0;i--)if(s.selectors[i]===this.selector&&s.contexts[i]===this._context){var u=s.listeners[i];for(var a=u.length-1;a>=0;a--){var f=u[a][0],l=u[a][1];if(f===t&&l===n){u.splice(a,1),u.length||(s.selectors.splice(i,1),s.contexts.splice(i,1),s.listeners.splice(i,1),vt.removeFromElement(this._context,e,_n),vt.removeFromElement(this._context,e,Dn,!0),s.selectors.length||(P[e]=null)),o=!0;break}}if(o)break}}else vt.remove(this,t,n);return this},set:function(e){if(!e||!yt(e))e={};this.options=new Bn(e),this.draggable("draggable"in e?e.draggable:this.options.draggable),this.dropzone("dropzone"in e?e.dropzone:this.options.dropzone),this.resizable("resizable"in e?e.resizable:this.options.resizable),this.gesturable("gesturable"in e?e.gesturable:this.options.gesturable);var t=["accept","actionChecker","allowFrom","autoScroll","deltaSource","dropChecker","ignoreFrom","inertia","origin","preventDefault","rectChecker","restrict","snap","styleCursor"];for(var n=0,r=t.length;n<r;n++){var i=t[n];i in e&&this[i](e[i])}return this},unset:function(){vt.remove(this,"all");if(!xt(this.selector))vt.remove(this,"all"),this.options.styleCursor&&(this._element.style.cursor=""),this._gesture&&(this._gesture.target=null);else for(var e in P){var t=P[e];for(var n=0;n<t.selectors.length;n++){t.selectors[n]===this.selector&&t.contexts[n]===this._context&&(t.selectors.splice(n,1),t.contexts.splice(n,1),t.listeners.splice(n,1),t.selectors.length||(P[e]=null)),vt.removeFromElement(this._context,e,_n),vt.removeFromElement(this._context,e,Dn,!0);break}}return this.dropzone(!1),A.splice(In(A,this),1),Hn}},jn.prototype.gestureable=jn.prototype.gesturable,jn.prototype.resizeable=jn.prototype.resizable,Hn.isSet=function(e,t){return A.indexOfElement(e,t&&t.context)!==-1},Hn.on=function(e,t,n){return qn(rt,e)?it[e]?qn(it[e],t)||it[e].push(t):it[e]=[t]:vt.add(ht,e,t,n),Hn},Hn.off=function(e,t,n){if(!qn(rt,e))vt.remove(ht,e,t,n);else{var r;e in it&&(r=In(it[e],t))!==-1&&it[e].splice(r,1)}return Hn},Hn.simulate=function(e,t,r){var i={},s;return e==="resize"&&(e="resizexy"),e in Z?(r?Tt(i,r):(s=H._element instanceof n?t.getBoundingClientRect():s=t.getClientRects()[0],e==="drag"?(i.pageX=s.left+s.width/2,i.pageY=s.top+s.height/2):(i.pageX=s.right,i.pageY=s.bottom)),i.target=i.currentTarget=t,i.preventDefault=i.stopPropagation=mt,pn(i,e),Hn):Hn},Hn.enableDragging=function(e){return e!==null&&e!==undefined?(et.drag=e,Hn):et.drag},Hn.enableResizing=function(e){return e!==null&&e!==undefined?(et.resize=e,Hn):et.resize},Hn.enableGesturing=function(e){return e!==null&&e!==undefined?(et.gesture=e,Hn):et.gesture},Hn.eventTypes=rt,Hn.debug=function(){return{target:H,dragging:K,resizing:G,gesturing:J,prepared:tt,matches:_,prevCoords:h,downCoords:d,pointerIds:m,pointerMoves:g,addPointer:gn,removePointer:yn,recordPointers:bn,recordTouches:wn,snap:R,restrict:U,inertia:k,downTime:y,downEvent:b,prevEvent:w,Interactable:jn,IOptions:Bn,interactables:A,dropzones:O,pointerIsDown:V,defaultOptions:q,defaultActionChecker:ln,actions:Z,dragMove:Sn,resizeMove:Tn,gestureMove:Cn,pointerUp:Mn,pointerDown:pn,pointerMove:mn,pointerHover:On,events:vt,globalEvents:it,delegatedEvents:P}},Hn.getTouchAverage=Pt,Hn.getTouchBBox=Ht,Hn.getTouchDistance=Bt,Hn.getTouchAngle=jt,Hn.getElementRect=_t,Hn.margin=function(e){return Et(e)?(X=e,Hn):X},Hn.styleCursor=function(e){return St(e)?(q.styleCursor=e,Hn):q.styleCursor},Hn.autoScroll=function(e){var t=q.autoScroll;return yt(e)?(q.autoScrollEnabled=!0,Et(e.margin)&&(t.margin=e.margin),Et(e.speed)&&(t.speed=e.speed),t.container=gt(e.container)||e.container instanceof window.Window?e.container:t.container,Hn):St(e)?(q.autoScrollEnabled=e,Hn):q.autoScrollEnabled?t:!1},Hn.snap=function(e){var t=q.snap;return yt(e)?(q.snapEnabled=!0,xt(e.mode)&&(t.mode=e.mode),St(e.endOnly)&&(t.endOnly=e.endOnly),Et(e.range)&&(t.range=e.range),bt(e.actions)&&(t.actions=e.actions),bt(e.anchors)&&(t.anchors=e.anchors),yt(e.grid)&&(t.grid=e.grid),yt(e.gridOffset)&&(t.gridOffset=e.gridOffset),yt(e.elementOrigin)&&(t.elementOrigin=e.elementOrigin),Hn):St(e)?(q.snapEnabled=e,Hn):{enabled:q.snapEnabled,mode:t.mode,actions:t.actions,grid:t.grid,gridOffset:t.gridOffset,anchors:t.anchors,paths:t.paths,range:t.range,locked:R.locked,x:R.snappedX,y:R.snappedY,realX:R.realX,realY:R.realY,dx:R.dx,dy:R.dy}},Hn.inertia=function(e){var t=q.inertia;return yt(e)?(q.inertiaEnabled=!0,Et(e.resistance)&&(t.resistance=e.resistance),Et(e.minSpeed)&&(t.minSpeed=e.minSpeed),Et(e.endSpeed)&&(t.endSpeed=e.endSpeed),Et(e.smoothEndDuration)&&(t.smoothEndDuration=e.smoothEndDuration),St(e.zeroResumeDelta)&&(t.zeroResumeDelta=e.zeroResumeDelta),bt(e.actions)&&(t.actions=e.actions),Hn):St(e)?(q.inertiaEnabled=e,Hn):{enabled:q.inertiaEnabled,resistance:t.resistance,minSpeed:t.minSpeed,endSpeed:t.endSpeed,actions:t.actions,zeroResumeDelta:t.zeroResumeDelta}},Hn.supportsTouch=function(){return W},Hn.currentAction=function(){return K&&"drag"||G&&"resize"||J&&"gesture"||null},Hn.stop=function(t){if(K||G||J){z.stop(),_=[],H.options.styleCursor&&(e.documentElement.style.cursor=""),H._gesture&&H._gesture.stop(),t&&wt(t.preventDefault)&&Kt(t,H);if(K){M.dropzones=M.elements=M.rects=null;for(var n=0;n<O.length;n++)O[n].selector&&(O[n]._dropElements=null)}Pn()}return m.splice(0),g.splice(0),V=R.locked=K=G=J=!1,tt=w=null,k.resumeDx=k.resumeDy=0,Hn},Hn.dynamicDrop=function(e){return St(e)?(Q=e,Hn):Q},Hn.deltaSource=function(e){return e==="page"||e==="client"?(q.deltaSource=e,this):q.deltaSource},Hn.restrict=function(e){var t=q.restrict;if(e===undefined)return q.restrict;if(St(e))q.restrictEnabled=e;else if(yt(e)){if(yt(e.drag)||/^parent$|^self$/.test(e.drag))t.drag=e.drag;if(yt(e.resize)||/^parent$|^self$/.test(e.resize))t.resize=e.resize;if(yt(e.gesture)||/^parent$|^self$/.test(e.gesture))t.gesture=e.gesture;St(e.endOnly)&&(t.endOnly=e.endOnly),yt(e.elementRect)&&(t.elementRect=e.elementRect),q.restrictEnabled=!0}else e===null&&(t.drag=t.resize=t.gesture=null,t.endOnly=!1);return this},Hn.pointerMoveTolerance=function(e){return Et(e)?(q.pointerMoveTolerance=e,this):q.pointerMoveTolerance},u?(u===window.MSPointerEvent?f={up:"MSPointerUp",down:"MSPointerDown",over:"MSPointerOver",out:"MSPointerOut",move:"MSPointerMove",cancel:"MSPointerCancel"}:f={up:"pointerup",down:"pointerdown",over:"pointerover",out:"pointerout",move:"pointermove",cancel:"pointercancel"},a===window.MSGestureEvent?l={start:"MSGestureStart",change:"MSGestureChange",inertia:"MSInertiaStart",end:"MSGestureEnd"}:l={start:"gesturestart",change:"gesturechange",inertia:"inertiastart",end:"gestureend"},vt.add(ht,f.up,fn),vt.add(ht,f.down,hn),vt.add(ht,l.change,mn),vt.add(ht,l.end,Mn),vt.add(ht,l.inertia,Mn),vt.add(ht,f.over,Ln),vt.add(ht,f.out,An),vt.add(ht,f.move,bn),vt.add(ht,f.up,bn),vt.add(ht,f.cancel,bn),vt.add(ht,f.up,function(){K||G||J||(V=!1)}),D=new o,D.target=e.documentElement):(vt.add(ht,"mouseup",fn),vt.add(ht,"touchend",fn),vt.add(ht,"mousedown",hn),vt.add(ht,"mousemove",mn),vt.add(ht,"mouseup",Mn),vt.add(ht,"mouseover",Ln),vt.add(ht,"mouseout",An),vt.add(ht,"touchmove",wn),vt.add(ht,"touchend",wn),vt.add(ht,"touchcancel",wn),vt.add(ht,"touchstart",hn),vt.add(ht,"touchmove",mn),vt.add(ht,"touchend",Mn),vt.add(ht,"touchcancel",Mn)),vt.add(ct,"blur",Mn);try{window.frameElement&&(dt._element=window.frameElement.ownerDocument,vt.add(dt,"mouseup",Mn),vt.add(dt,"touchend",Mn),vt.add(dt,"touchcancel",Mn),vt.add(dt,"pointerup",Mn),vt.add(dt,"MSPointerUp",Mn),vt.add(pt,"blur",Mn))}catch(Fn){Hn.windowParentError=Fn}vt.add(ht,"selectstart",function(e){(K||G||J)&&Kt(e,H)});if(!(ut in Element.prototype)||!wt(Element.prototype[ut]))at=function(e,t,n){n=n||e.parentNode.querySelectorAll(t);for(var r=0,i=n.length;r<i;r++)if(n[r]===e)return!0;return!1};(function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)ft=window[t[n]+"RequestAnimationFrame"],lt=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];ft||(ft=function(t){var n=(new Date).getTime(),r=Math.max(0,16-(n-e)),i=window.setTimeout(function(){t(n+r)},r);return e=n+r,i}),lt||(lt=function(e){clearTimeout(e)})})(),typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=Hn),exports.interact=Hn):typeof define=="function"&&define.amd?define("libs/interact",[],function(){return Hn}):window.interact=Hn}(),define("happy/_libs/mout/string/WHITE_SPACES",[],function(){return[" ","\n","\r","	","\f","","","","","","","","","","","","","","","","\u2028","\u2029","","",""]}),define("happy/_libs/mout/string/ltrim",["../lang/toString","./WHITE_SPACES"],function(e,t){function n(n,r){n=e(n),r=r||t;var i=0,s=n.length,o=r.length,u=!0,a,f;while(u&&i<s){u=!1,a=-1,f=n.charAt(i);while(++a<o)if(f===r[a]){u=!0,i++;break}}return i>=s?"":n.substr(i,s)}return n}),define("happy/_libs/mout/string/rtrim",["../lang/toString","./WHITE_SPACES"],function(e,t){function n(n,r){n=e(n),r=r||t;var i=n.length-1,s=r.length,o=!0,u,a;while(o&&i>=0){o=!1,u=-1,a=n.charAt(i);while(++u<s)if(a===r[u]){o=!0,i--;break}}return i>=0?n.substring(0,i+1):""}return n}),define("happy/_libs/mout/string/trim",["../lang/toString","./WHITE_SPACES","./ltrim","./rtrim"],function(e,t,n,r){function i(i,s){return i=e(i),s=s||t,n(r(i,s),s)}return i}),define("happy/_libs/mout/string/slugify",["../lang/toString","./replaceAccents","./removeNonWord","./trim"],function(e,t,n,r){function i(i,s){return i=e(i),s==null&&(s="-"),i=t(i),i=n(i),i=r(i).replace(/ +/g,s).toLowerCase(),i}return i}),define("happy/_libs/mout/string/unCamelCase",["../lang/toString"],function(e){function n(n,r){function i(e,t,n){return t+r+n}return r==null&&(r=" "),n=e(n),n=n.replace(t,i),n=n.toLowerCase(),n}var t=/([a-z\xE0-\xFF])([A-Z\xC0\xDF])/g;return n}),define("happy/_libs/mout/string/hyphenate",["../lang/toString","./slugify","./unCamelCase"],function(e,t,n){function r(r){return r=e(r),r=n(r),t(r,"-")}return r}),function(){var e=window.getComputedStyle||function(e){return this.el=e,this.getPropertyValue=function(t){var n=/(\-([a-z]){1})/g;return n.test(t)&&(t=t.replace(n,function(){return arguments[2].toUpperCase()})),e.currentStyle[t]?e.currentStyle[t]:null},this},t=document.createElement("div");t.id="cssdata",t.style.display="none",document.body.appendChild(t);var n;try{var r=e(t).fontFamily;n=JSON.parse(r.substring(1,r.length-1))}catch(i){n={}}var s=function(){var e=this,t=function(e,t){var r=n[e];return typeof r=="undefined"?t:r};Object.defineProperty(e,"get",{value:t})},o=new s;typeof define!="undefined"?define("CSSData",[],function(){return o}):typeof exports!="undefined"?exports.get=o.get:window.CSSDATA=o}(),define("ui/VisualNodeInput",["require","happy/utils/DOM","libs/interact","CSSData","Tree","Definitions","SVGDrawing","EventsManager"],function(e,t,n,r,i,s,o,u){var a=new t,f=function(e,t,f,l,c){var h=this,p,d,v,m,g,y,b,w,E=new u,S=function(){var u=s.data[i.data[f].type];p=document.createElement("div"),p.classList.add("visual-node-input"),p.classList.add(t),p.classList.add("placeholder"),d=document.createElement("label"),d.classList.add("label"),p.appendChild(d),v=document.createElement("input"),v.type="text",v.classList.add("input"),d.appendChild(v),m=document.createElement("div"),m.classList.add("input-mirror"),d.appendChild(m),m.innerHTML=l,g=document.createElement("div"),g.classList.add("text"),g.innerHTML=e,d.appendChild(g),b=o.two.makeLine(0,0,0,0),b.linewidth=r.get("linkLineWidth",1),b.stroke=r.get("linkLineColor","black"),y=n(m).dropzone(!0).on("drop",function(e){T(e.relatedTarget.dataset.connectionInfo)}),E.addEventListener(v,"focus",function(){v.select()}),E.addEventListener(v,"change",function(){T(v.value)}),E.add(i.connectionRemoved,function(e){if(e.to!=f+"."+t)return;v.value="",m.innerHTML=l,p.classList.add("placeholder"),p.classList.remove("connected-to-output"),w=null,N()}),E.add(i.connectionAdded,function(e){x(e)})},x=function(e){if(e.to!=f+"."+t)return;v.value=e.from;if(!e.from)m.innerHTML=l,p.classList.add("placeholder");else{var n=e.from.split(".");n.length==2&&i.data[n[0]]&&n[1]=="out"&&s.data[i.data[n[0]].type].out?(w=c.editor.nodes[n[0]].outputObjects[n[1]],m.innerHTML=e.from,p.classList.add("connected-to-output")):(w=null,m.innerHTML=e.from,p.classList.remove("connected-to-output")),N(),p.classList.remove("placeholder")}},T=function(e){i.data[f].inputs||(i.data[f].inputs={}),e?i.data[f].inputs[t]=e:delete i.data[f].inputs[t]},N=function(){if(!w)return C(0,0,0,0);var e=a.calculatePosition(c.editor.container),t=a.calculatePosition(p),n=a.measure(p),r=a.calculatePosition(w.container),i=a.measure(w.container),s=t.x-e.x,o=t.y+n.height*.5-e.y,u=r.x-e.x,f=r.y+i.height*.5-e.y;C(u,f,s,o)},C=function(e,t,n,r){b.vertices[0].x=e,b.vertices[0].y=t,b.vertices[1].x=n,b.vertices[1].y=r},k=function(){y.unset(),E.destroy(),b.remove()};Object.defineProperty(h,"container",{get:function(){return p}}),Object.defineProperty(h,"proccessIncomingConnection",{value:x}),Object.defineProperty(h,"destroy",{value:k}),Object.defineProperty(h,"update",{value:N}),S()};return f}),define("ui/VisualNodeOutput",["libs/interact","Tree","Definitions","EventsManager"],function(e,t,n,r){var i=function(i,s,o){var u=this,a,f,l,c=new r,h=function(){var r=n.data[t.data[s].type];a=document.createElement("div"),a.classList.add("visual-node-output"),a.classList.add(i),a.classList.add("placeholder");var u=document.createElement("label");u.classList.add("label"),a.appendChild(u);var h=document.createElement("div");h.classList.add("text"),h.innerHTML=i,u.appendChild(h);var p=document.createElement("div");p.classList.add("input-mirror"),u.appendChild(p),p.innerHTML="&nbsp";var d=document.createElement("div");d.classList.add("input-mirror"),d.classList.add("draggable-input-mirror"),d.dataset.connectionInfo=s+"."+i,u.appendChild(d),d.innerHTML="&nbsp";var v=0,m=0;l=e(d).draggable({onstart:function(e){a.classList.add("dragging")},onmove:function(e){v+=e.dx,m+=e.dy,d.style.webkitTransform=d.style.transform="translate("+v+"px, "+m+"px)"},onend:function(e){a.classList.remove("dragging"),v=0,m=0,d.style.webkitTransform=d.style.transform="translate("+v+"px, "+m+"px)"}}),f={},c.add(t.connectionAdded,function(e){if(e.from!=s+"."+i)return;var t=e.to.split(".");f[e.to]=o.editor.nodes[t[0]].inputObjects[t[1]],a.classList.add("connected-to-input"),a.classList.remove("placeholder")}),c.add(t.connectionRemoved,function(e){if(e.from!=s+"."+i)return;delete f[e.to],Object.keys(f).length||(a.classList.remove("connected-to-input"),a.classList.add("placeholder"))})},p=function(){c.destroy(),l.unset()},d=function(){Object.keys(f).forEach(function(e){f[e].update()})};Object.defineProperty(u,"container",{get:function(){return a}}),Object.defineProperty(u,"destroy",{value:p}),Object.defineProperty(u,"update",{value:d}),h()};return i}),define("ui/VisualNode",["libs/interact","happy/_libs/mout/string/hyphenate","ui/VisualNodeInput","ui/VisualNodeOutput","Definitions","Tree","EventsManager"],function(e,t,n,r,i,s,o){var u=/^items\[([0-9]+)\]$/g,a=function(a,f){var l=this,c,h,p,d,v,m,g=new o,y=function(){var o=s.data[a],u=i.data[o.type];c=document.createElement("div"),c.classList.add("visual-node"),c.classList.add(t(u.name)),u.in&&c.classList.add("in"),u.out&&c.classList.add("out"),u.collection&&c.classList.add("collection");var f=document.createElement("div");f.classList.add("draggable-layer"),c.appendChild(f);var m=document.createElement("button");m.classList.add("delete"),m.innerHTML="",c.appendChild(m),h={};var y=document.createElement("div");y.classList.add("inputs"),c.appendChild(y),u.inputs&&Object.keys(u.inputs).forEach(function(e){var t=new n(e,e,a,u.inputs[e],l);h[e]=t,y.appendChild(t.container)}),p={};if(u.collection){var S=document.createElement("div");S.classList.add("collection-container"),S.classList.add("placeholder"),y.appendChild(S);var N=document.createElement("div");N.classList.add("adder-container"),S.appendChild(N);var C=document.createElement("div");C.classList.add("button"),N.appendChild(C);var k=document.createElement("div");k.classList.add("text"),k.innerHTML="items",N.appendChild(k),g.addEventListener(C,"click",function(){b(S)}),g.add(s.connectionAdded,function(e){var t=e.to.split(".");if(t.length!=2)return;if(t[0]!=a)return;var n=t[1];if(!w(n))return;if(p[n])return;var r=E(n),i=r+1;for(var s=0;s<i;s++){if(p["items["+s+"]"])continue;b(S)}p[n].proccessIncomingConnection(e)},999)}var L=document.createElement("h5");L.classList.add("title"),L.innerHTML=u.name,c.appendChild(L),d={};var A=document.createElement("div");A.classList.add("outputs"),c.appendChild(A);if(u.out){var O="out",M=new r(O,a,l);d[O]=M,A.appendChild(M.container)}g.addEventListener(c,"mouseover",function(){c.classList.add("focus")}),g.addEventListener(c,"mouseout",function(){c.classList.remove("focus")}),g.addEventListener(m,"click",function(){delete s.data[a]}),g.add(s.nodeRemoved,function(e){if(a!=e)return;T(),c.parentNode.removeChild(c)}),o._x||(o._x=0),o._y||(o._y=0),v=e(c).draggable({onstart:function(e){x()},onmove:function(e){var t=e.target;o._x+=e.dx,o._y+=e.dy},onend:function(e){}}).restrict({drag:"parent",endOnly:!0,elementRect:{top:0,left:0,bottom:0,right:0}}),g.add(s.nodePositionUpdated,function(e,t,n){if(a!=e)return;c.style.left=t+"px",c.style.top=n+"px",Object.keys(h).forEach(function(e){h[e].update()}),Object.keys(d).forEach(function(e){d[e].update()})})},b=function(e){var t=Object.keys(p),r=t.length,i=S(r);e.classList.remove("placeholder");var o=new n(r,i,a,0,l);h[i]=o,p[i]=o,e.appendChild(o.container);var u=document.createElement("div");u.classList.add("delete-button"),o.container.appendChild(u),g.addEventListener(u,"click",function(){s.data[a].inputs||(s.data[a].inputs={}),s.data[a].inputs[i]&&delete s.data[a].inputs[i],Object.keys(s.data[a].inputs).forEach(function(e){if(!w(e))return;var t=E(e);if(t<=r)return;var n=S(t-1);s.data[a].inputs[n]=s.data[a].inputs[e],delete s.data[a].inputs[e]});var t=Object.keys(p).length-1,n=S(t);h[n].destroy(),e.removeChild(p[n].container),delete p[n],delete h[n]})},w=function(e){var t=u.exec(e);return u.lastIndex=0,t?t.length!=2?!1:!0:!1},E=function(e){var t=u.exec(e);u.lastIndex=0;var n=parseInt(t[1]);return n},S=function(e){return"items["+e+"]"},x=function(){var e=c.parentNode;e.removeChild(c),e.appendChild(c)},T=function(){g.destroy(),v.unset(),Object.keys(h).forEach(function(e){h[e].destroy()}),h=null,Object.keys(d).forEach(function(e){d[e].destroy()}),d=null},N=function(){Object.keys(h).forEach(function(e){h[e].update()}),Object.keys(d).forEach(function(e){d[e].update()})};Object.defineProperty(l,"update",{value:N}),Object.defineProperty(l,"destroy",{value:T}),Object.defineProperty(l,"container",{get:function(){return c}}),Object.defineProperty(l,"editor",{get:function(){return f}}),Object.defineProperty(l,"inputObjects",{get:function(){return h}}),Object.defineProperty(l,"outputObjects",{get:function(){return d}}),y()};return a}),define("ui/VisualEditor",["ui/VisualNode","Tree"],function(e,t){var n=function(){var n=this,r,i,s=function(){r=document.createElement("div"),r.classList.add("ui-visual-editor"),i={},t.nodeAdded.add(o),t.nodeRemoved.add(u),l()},o=function(t){i[t]=new e(t,n),r.appendChild(i[t].container)},u=function(e){delete i[e]},a=function(){Object.keys(i).forEach(function(e){i[e].update()})},f=function(){r.style.display="block",a()},l=function(){r.style.display="none"};Object.defineProperty(n,"show",{value:f}),Object.defineProperty(n,"hide",{value:l}),Object.defineProperty(n,"update",{value:a}),Object.defineProperty(n,"container",{get:function(){return r}}),Object.defineProperty(n,"nodes",{get:function(){return i}}),s()};return n}),define("ui/CodeEditor",["Tree","Definitions"],function(e,t){var n=function(){var n=this,r,i,s=function(){r=document.createElement("pre"),r.classList.add("ui-code-editor"),C()},o=function(e){var t="";return t+='#include "Quirkbot.h"',t+=h(),t},u=function(e){var n="",r=Object.keys(e);return r.sort(E),r.forEach(function(r){var i=t.data[e[r].type].type;n+=i+" "+r+";",n+=h()}),n},a=function(e){var t="",n=Object.keys(e);return n.sort(E),n.forEach(function(r){var i=f(r,e);i&&(t+=i,n.lastIndexOf(r)!=n.length-1&&(t+=h()))}),t},f=function(e,t){var n="",r=t[e];if(r.inputs){var i=Object.keys(r.inputs);i.sort(S),i.forEach(function(t){var i=r.inputs[t];n+=p(),y(t)?w(i)?n+=m(e,t,i):n+=g(e,t,i):w(i)?n+=d(e,t,i):n+=v(e,t,i),n+=h()})}if(r.outputArray){var s=r.outputArray;s.forEach(function(t){var r="out";n+=p(),w(t)?n+=d(e,r,t):n+=v(e,r,t),n+=h()})}return n},l=function(){var e="";return e+="void start(){",e+=h(),e},c=function(){var e="";return e+="}",e},h=function(){return"\n"},p=function(){return"    "},d=function(e,t,n){return e+"."+t+" = "+n+";"},v=function(e,t,n){return e+"."+t+".connect("+n+");"},m=function(e,t,n){var r=b(t);return e+"["+r+"] = "+n+";"},g=function(e,t,n){var r=b(t);return e+"["+r+"].connect("+n+");"},y=function(e){var t=/^items\[([0-9]+)\]$/g,n=t.exec(e);return n!==null},b=function(e){var t=/^items\[([0-9]+)\]$/g,n=t.exec(e),r=parseInt(n[1]);return r},w=function(e){var t=["A0","A1","A2","A3","A4","A6","A7","A8","A9","A10","A11","BP1","BP2","BP3","BP4","BP5","BP6","WAVE_SINE","WAVE_SQUARE","WAVE_TRIANGLE","WAVE_PULSE","WAVE_RAMP_UP","WAVE_RAMP_DOWN","LM","RM","LE","RE","LL","RL","RA","H","LA","LLF","RLF","RAF","HF","LAF","LLB","RLB","RAB","HB","LAB"];return t.indexOf(e)!=-1?!0:e-parseFloat(e)+1>=0},E=function(e,n){var r=i[e],s=i[n],o=t.data[r.type],u=t.data[s.type];if(o.out&&u.out){if(r.type<s.type)return-1;if(r.type>s.type)return 1}return o.out?-1:u.out?1:0},S=function(e,t){var n=y(e),r=y(t);if(n&&r){var i=b(e),s=b(t);return i<s?-1:i==s?0:1}return n?1:r?-1:0},x=function(e){return Object.keys(e).forEach(function(t){var n=e[t];if(!n.inputs)return;Object.keys(n.inputs).forEach(function(r){var i=n.inputs[r];if(w(i))return;if(y(r))return;var s=i.split(".");if(!s||s.length!=2)return;var o=e[s[0]];o.outputArray||(o.outputArray=[]),o.outputArray.push(t+"."+r),delete n.inputs[r],delete n.inputs[r]})}),e},T=function(){i=JSON.parse(JSON.stringify(e.data)),i=x(i);var t=o(i);t+=h(),t+=u(i),t+=h(),t+=l(),t+=a(i),t+=c(),r.innerHTML=t},N=function(){r.style.display="block",T();if(document.selection){var e=document.body.createTextRange();e.moveToElementText(r),e.select()}else if(window.getSelection){var e=document.createRange();e.selectNode(r),window.getSelection().addRange(e)}},C=function(){r.style.display="none",document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()};Object.defineProperty(n,"show",{value:N}),Object.defineProperty(n,"hide",{value:C}),Object.defineProperty(n,"update",{value:T}),Object.defineProperty(n,"container",{get:function(){return r}}),s()};return n}),define("ui/SerialMonitor",["Tree"],function(e){var t=function(){var e=this,t,n,r=function(){t=document.createElement("div"),t.classList.add("ui-serial-monitor"),t.innerHTML='<iframe allowTransparency="true" src="//codebender.cc/embed/serialmonitor" frameborder="0"></iframe>',o()},i=function(){},s=function(){t.style.display="block"},o=function(){t.style.display="none"};Object.defineProperty(e,"show",{value:s}),Object.defineProperty(e,"hide",{value:o}),Object.defineProperty(e,"update",{value:i}),Object.defineProperty(e,"container",{get:function(){return t}}),r()};return t}),define("UI",["ui/Menu","ui/Authentication","ui/DefinitionList","ui/VisualEditor","ui/CodeEditor","ui/SerialMonitor"],function(e,t,n,r,i,s){var o=function(){var o=this,u,a,f,l,c,h,p=function(o){u=new e,a=new t,f=new n,l=new r,c=new i,h=new s,o.appendChild(u.container),o.appendChild(a.container),o.appendChild(f.container),o.appendChild(l.container),o.appendChild(c.container),o.appendChild(h.container),l.hide(),c.hide(),h.hide();var p;u.tabChanged.add(function(e){p&&p.hide();switch(e){case"visual":p=l;break;case"code":p=c;break;case"serial":p=h}p.show()})};Object.defineProperty(o,"init",{value:p}),Object.defineProperty(o,"menu",{get:function(){return u}}),Object.defineProperty(o,"authentication",{get:function(){return a}}),Object.defineProperty(o,"definitionList",{get:function(){return f}}),Object.defineProperty(o,"visualEditor",{get:function(){return l}}),Object.defineProperty(o,"codeEditor",{get:function(){return c}}),Object.defineProperty(o,"serialMonitor",{get:function(){return h}})},u=new o;return u}),define("App",["happy/app/BaseApp","libs/parse","Tree","Definitions","SVGDrawing","UI","happy/_libs/signals"],function(e,t,n,r,i,s,o){var u=function(){var e=this;e.setup=function(){window.TREE=n,e.container.classList.add("loading"),r.load(e.container.dataset.indexPath||"nodes/index.json").then(function(){e.container.classList.remove("loading"),t(),n.load()}).catch(function(t){e.container.classList.remove("loading"),o(t)})};var t=function(){s.init(e.container),i.init(s.visualEditor.container),s.menu.tabChanged.add(function(t){e.onResize(e.size)})};e.onResize=function(e){i.resize()},e.update=function(){i.update()};var o=function(e){e.stack?console.error(e.stack):console.error(e)}};return u.prototype=new e,u}),define("happy/_libs/mout/object/hasOwn",[],function(){function e(e,t){return Object.prototype.hasOwnProperty.call(e,t)}return e}),define("happy/_libs/mout/lang/kindOf",[],function(){function r(r){return r===null?"Null":r===n?"Undefined":e.exec(t.call(r))[1]}var e=/^\[object (.*)\]$/,t=Object.prototype.toString,n;return r}),define("happy/_libs/mout/lang/isPlainObject",[],function(){function e(e){return!!e&&typeof e=="object"&&e.constructor===Object}return e}),define("happy/_libs/mout/object/forIn",[],function(){function n(){t=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],e=!0;for(var n in{toString:null})e=!1}function r(r,s,o){var u,a=0;e==null&&n();for(u in r)if(i(s,r,u,o)===!1)break;if(e)while(u=t[a++])if(r[u]!==Object.prototype[u]&&i(s,r,u,o)===!1)break}function i(e,t,n,r){return e.call(r,t[n],n,t)}var e,t;return r}),define("happy/_libs/mout/object/forOwn",["./hasOwn","./forIn"],function(e,t){function n(n,r,i){t(n,function(t,s){if(e(n,s))return r.call(i,n[s],s,n)})}return n}),define("happy/_libs/mout/object/mixIn",["./forOwn"],function(e){function t(t,r){var i=0,s=arguments.length,o;while(++i<s)o=arguments[i],o!=null&&e(o,n,t);return t}function n(e,t){this[t]=e}return t}),define("happy/_libs/mout/lang/clone",["./kindOf","./isPlainObject","../object/mixIn"],function(e,t,n){function r(t){switch(e(t)){case"Object":return i(t);case"Array":return u(t);case"RegExp":return s(t);case"Date":return o(t);default:return t}}function i(e){return t(e)?n({},e):e}function s(e){var t="";return t+=e.multiline?"m":"",t+=e.global?"g":"",t+=e.ignorecase?"i":"",new RegExp(e.source,t)}function o(e){return new Date(+e)}function u(e){return e.slice()}return r}),define("happy/_libs/mout/lang/deepClone",["./clone","../object/forOwn","./kindOf","./isPlainObject"],function(e,t,n,r){function i(t,r){switch(n(t)){case"Object":return s(t,r);case"Array":return o(t,r);default:return e(t)}}function s(e,n){if(r(e)){var s={};return t(e,function(e,t){this[t]=i(e,n)},s),s}return n?n(e):e}function o(e,t){var n=[],r=-1,s=e.length,o;while(++r<s)n[r]=i(e[r],t);return n}return i}),define("happy/_libs/mout/lang/isKind",["./kindOf"],function(e){function t(t,n){return e(t)===n}return t}),define("happy/_libs/mout/lang/isObject",["./isKind"],function(e){function t(t){return e(t,"Object")}return t}),define("happy/_libs/mout/object/merge",["./hasOwn","../lang/deepClone","../lang/isObject"],function(e,t,n){function r(){var i=1,s,o,u,a;a=t(arguments[0]);while(u=arguments[i++])for(s in u){if(!e(u,s))continue;o=u[s],n(o)&&n(a[s])?a[s]=r(a[s],o):a[s]=t(o)}return a}return r}),define("happy/app/Runner",["../utils/DOM","../utils/Vendor","../_libs/mout/object/merge"],function(e,t,n){var r=new t,i=new e,s=r.validateMethod("requestAnimationFrame"),o=r.validateConstructor("MutationObserver"),u=function(e){function A(){c(A);var t=N();l=t-a,a=t;var n=t-u;e.update.apply(e,[l,n]),e.draw.apply(e,[l,n])}var t=this,n=e.container,u,a,f,l,c;n.tabIndex="1",n.addEventListener("keyup",function(t){e.onKeyUp.apply(e,[t])},!1),n.addEventListener("keydown",function(t){e.onKeyDown.apply(e,[t])},!1),n.addEventListener("mouseover",function(t){e.onMouseOver.apply(e,[t])},!1),n.addEventListener("mouseout",function(t){e.onMouseOut.apply(e,[t])},!1),n.addEventListener("mousedown",function(t){e.onMouseDown.apply(e,[t])},!1),n.addEventListener("mouseup",function(t){e.onMouseUp.apply(e,[t])},!1),n.addEventListener("mousemove",function(t){e.onMouseMove.apply(e,[t])},!1),n.addEventListener("click",function(t){e.onClick.apply(e,[t])},!1),n.addEventListener("dblclick",function(t){e.onDoubleClick.apply(e,[t])},!1);var h=i.measure(n),p=i.calculatePosition(n),d=function(){var t=i.measure(n),r=i.calculatePosition(n);(t.width!=h.width||t.height!=h.height)&&e.onResize.apply(e,[t,r]),h=t,(r.x!=p.x||r.y!=p.y)&&e.onReposition.apply(e,[r,t]),p=r};window.addEventListener("resize",d,!1),window.addEventListener("scroll",d,!1);if(o){var v=new o(d);v.observe(document.body,{subtree:!0,childList:!0,characterData:!0,attribute:!0})}var m=function(){r.validateMethod("cancelFullScreen",document).apply(document)},g=function(){r.validateMethod("requestFullScreen",n).apply(n,[Element.ALLOW_KEYBOARD_INPUT])},y=!1,b=function(){y=!0,g(),n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.minWidth="100%",n.style.minHeight="100%",n.style.maxWidth="100%",n.style.maxHeight="100%"},w=function(){y=!1,n.removeAttribute("style"),m()},E=function(){y?w():b()},S=function(){return y},x=function(e){e<0&&(e=0);switch(e){case"auto":s?c=s:c=function(e){setTimeout(e,1e3/60)};break;case 0:c=function(e){};break;default:c=function(t){setTimeout(t,1e3/e)}}},T=function(){return 1/l},N;window.performance&&window.performance.now?N=function(){return window.performance.now()*.001}:window.performance&&window.performance.webkitNow?N=function(){return window.performance.webkitNow()*.001}:N=function(){return(new Date).getTime()*.001};var C=function(){return u},k=function(){return N()-u},L=function(){return l};Object.defineProperty(e,"setDesiredFPS",{value:x}),Object.defineProperty(e,"enterFullscreen",{value:b}),Object.defineProperty(e,"exitFullscreen",{value:w}),Object.defineProperty(e,"toggleFullscreen",{value:E}),Object.defineProperty(e,"isFullscreen",{get:S}),Object.defineProperty(e,"time",{get:N}),Object.defineProperty(e,"startTime",{get:C}),Object.defineProperty(e,"runTime",{get:k}),Object.defineProperty(e,"deltaTime",{get:L}),Object.defineProperty(e,"fps",{get:T}),Object.defineProperty(e,"position",{get:function(){return p}}),Object.defineProperty(e,"size",{get:function(){return h}}),x("auto"),u=N(),e.setup.apply(e),e.onReposition.apply(e,[p,h]),e.onResize.apply(e,[h,p]),a=u,f=0,l,A()};return u}),require(["App","happy/app/Runner"],function(e,t){var n=new e;n.container=document.body;var r=new t(n)}),define("main",function(){});